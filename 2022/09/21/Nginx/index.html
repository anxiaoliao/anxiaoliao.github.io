<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Nginx | Ming's Notes</title><meta name="keywords" content="学习"><meta name="author" content="Terry Ming"><meta name="copyright" content="Terry Ming"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Nginx1、Nginx基础Nginx的三个主要应用场景   1.1 yum安装配置yum仓库：   Install the prerequisites: 1sudo yum install yum-utils    To set up the yum repository, create the file named &#x2F;etc&#x2F;yum.repos.d&#x2F;nginx.repo with the fo">
<meta property="og:type" content="article">
<meta property="og:title" content="Nginx">
<meta property="og:url" content="https://anxiaoliao.github.io/2022/09/21/Nginx/index.html">
<meta property="og:site_name" content="Ming&#39;s Notes">
<meta property="og:description" content="Nginx1、Nginx基础Nginx的三个主要应用场景   1.1 yum安装配置yum仓库：   Install the prerequisites: 1sudo yum install yum-utils    To set up the yum repository, create the file named &#x2F;etc&#x2F;yum.repos.d&#x2F;nginx.repo with the fo">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7">
<meta property="article:published_time" content="2022-09-21T09:35:40.000Z">
<meta property="article:modified_time" content="2022-09-21T15:06:53.880Z">
<meta property="article:author" content="Terry Ming">
<meta property="article:tag" content="学习">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://anxiaoliao.github.io/2022/09/21/Nginx/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Nginx',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-09-21 23:06:53'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.2.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.imgtg.com/2022/08/11/AsLOl.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">7</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">1</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 留言板</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Ming's Notes</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 留言板</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Nginx</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-09-21T09:35:40.000Z" title="发表于 2022-09-21 17:35:40">2022-09-21</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-09-21T15:06:53.880Z" title="更新于 2022-09-21 23:06:53">2022-09-21</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Nginx"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h1><h2 id="1、Nginx基础"><a href="#1、Nginx基础" class="headerlink" title="1、Nginx基础"></a>1、Nginx基础</h2><p><strong>Nginx</strong>的三个主要应用场景</p>
<p><img src="/Nginx.assets/1600239087078.png"></p>
<p><img src="/Nginx.assets/1613638505619.png" alt="1613638505619"></p>
<h3 id="1-1-yum安装"><a href="#1-1-yum安装" class="headerlink" title="1.1 yum安装"></a>1.1 yum安装</h3><p>配置yum仓库：  </p>
<p>Install the prerequisites:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install yum-utils</span><br></pre></td></tr></table></figure>



<p>To set up the yum repository, create the file named <code>/etc/yum.repos.d/nginx.repo</code> with the following contents:</p>
<blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[nginx-stable]</span><br><span class="line">name=nginx stable repo</span><br><span class="line">baseurl=http://nginx.org/packages/centos/<span class="variable">$releasever</span>/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=https://nginx.org/keys/nginx_signing.key</span><br><span class="line">module_hotfixes=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[nginx-mainline]</span><br><span class="line">name=nginx mainline repo</span><br><span class="line">baseurl=http://nginx.org/packages/mainline/centos/<span class="variable">$releasever</span>/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=https://nginx.org/keys/nginx_signing.key</span><br><span class="line">module_hotfixes=<span class="literal">true</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>By default, the repository for stable nginx packages is used. If you would like to use mainline nginx packages, run the following command:</p>
<blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum-config-manager --<span class="built_in">enable</span> nginx-mainline</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="1-2-源码安装："><a href="#1-2-源码安装：" class="headerlink" title="1.2  源码安装："></a>1.2  源码安装：</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">1、<span class="comment"># 选择想要下载的版本，直接单击右键复制地址下载：</span></span><br><span class="line">wget http://nginx.org/download/nginx-1.16.0.tar.gz</span><br><span class="line">2、<span class="comment"># 安装依赖</span></span><br><span class="line">yum install gcc gcc-c++ pcre pcre-devel zlib zlib-devel</span><br><span class="line">openssl openssl-devel -y</span><br><span class="line">3、<span class="comment"># 解压包</span></span><br><span class="line">tar xf nginx-1.16.0.tar.gz</span><br><span class="line"><span class="built_in">cd</span> nginx-1.16.0</span><br><span class="line">4、<span class="comment"># 预编译</span></span><br><span class="line">预编译主要是用来检查系统环境是否满足安装软件包的条件，</span><br><span class="line">并生成Makefile文件，该文件为编译、安装、升级nginx指明了相应参数。</span><br><span class="line">./configure --<span class="built_in">help</span> 可以查看预编译参数</span><br><span class="line">--prefix 指定nginx编译安装的目录；</span><br><span class="line">--user=*** 指定nginx的属主</span><br><span class="line">--group=*** 指定nginx的属主与属组</span><br><span class="line">--with-*** 指定编译某模块</span><br><span class="line">--without-** 指定不编译某模块</span><br><span class="line">--add-module 编译第三方模块</span><br><span class="line"></span><br><span class="line">./configure --prefix=/usr/local/nginx</span><br><span class="line"></span><br><span class="line">make clean : 重新预编译时，通常执行这条命令删除上次的编译文件</span><br><span class="line">make build : 编译，默认参数，可省略build参数</span><br><span class="line">make install : 安装</span><br><span class="line">make modules : 编译模块</span><br><span class="line">make upgrade : 在线升级</span><br><span class="line"></span><br><span class="line">5、<span class="comment"># 编译并安装</span></span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">6、<span class="comment"># 查看版本</span></span><br><span class="line">/usr/local/nginx/sbin/nginx -v</span><br><span class="line">7、<span class="comment"># 启动nginx</span></span><br><span class="line">/usr/local/nginx/sbin/nginx</span><br><span class="line">8、<span class="comment"># 检查进程及端口</span></span><br><span class="line">ps -ef|grep nginx</span><br><span class="line">netstat -ntlp|grep 80</span><br></pre></td></tr></table></figure>

<h3 id="1-3-常用命令"><a href="#1-3-常用命令" class="headerlink" title="1.3 常用命令"></a>1.3 常用命令</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">-v 可查看nginx的版本。</span><br><span class="line">-V 可查看nginx的详细信息，包括编译的参数。</span><br><span class="line">`-t 可用来测试nginx的配置文件的语法错误`</span><br><span class="line">-T 可用来测试nginx的配置文件语法错误，同时还可以通过重定向备份</span><br><span class="line">nginx的配置文件。</span><br><span class="line">-q 如果配置文件没有错误信息时，不会有任何提示，如果有错误，则提</span><br><span class="line">示错误信息，与-t配合使用。</span><br><span class="line">`-s 发送信号给master处理：`</span><br><span class="line">stop 立刻停止nginx服务，不管请求是否处理完</span><br><span class="line">quit 优雅的退出服务，处理完当前的请求退出</span><br><span class="line">reopen 重新打开日志文件，原日志文件要提前备份改名。</span><br><span class="line">reload 重载配置文件</span><br><span class="line">-p 设置nginx家目录路径，默认是编译时的安装路径</span><br><span class="line">-c 设置nginx的配置文件，默认是家目录下的配置文件</span><br><span class="line">-g 设置nginx的全局变量，这个变量会覆盖配置文件中的变量。</span><br></pre></td></tr></table></figure>



<p> 实现配置文件语法高亮 </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/www/server/nginx/src/contrib</span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> -a contrib/vim/* /usr/share/vim/vimfiles/</span><br></pre></td></tr></table></figure>

<h3 id="1-4-http指令块"><a href="#1-4-http指令块" class="headerlink" title="1.4  http指令块"></a>1.4  http指令块</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">include mime.types; :定义数据类型</span></span><br><span class="line">如果用户请求lutixia.png，服务器上有lutixia.png这个文件，后缀</span><br><span class="line">名是png；</span><br><span class="line">根据mime.types，这个文件的数据类型应该是image/png；</span><br><span class="line">将Content-Type的值设置为image/png，然后发送给客户端</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">default_type :设定默认类型为二进制流，也就是当文件类型未定义时使用这种方式，</span></span><br><span class="line">例如在没有配置PHP环境时，Nginx是不予解析的，</span><br><span class="line">此时，用浏览器访问PHP文件就会出现下载窗口。</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">charset utf-8; :解决中文字体乱码</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">log_format :定义日志文件格式，并默认取名为main，可以自定义该名字。也可以通过添加，删除变量来自定义日志文件的格式。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">access_log :定义访问日志的存放路径，并且通过引用</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">log_format所定义的main名称设置其输出格式。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">sendfile on :用于开启高效文件传输模式。</span></span><br><span class="line">直接将数据包封装在内核缓冲区，然后返给客户，将tcp_nopush和tcp_nodelay两个指令设置为on用于防止网络阻塞；</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">keepalive_timeout 65 :设置客户端连接保持活动的超时时间。</span></span><br><span class="line">在超过这个时间之后，服务器会关闭该连接。</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">keepalive_requests 100 :设置nginx在保持连接状态最多能处理的请求数</span></span><br><span class="line">到达请求数，即使还在保持连接状态时间内，也需要重新连接。</span><br><span class="line">提示：可以用netstat -ntlpa |grep 80 查看链接状态</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">gzip on :开启压缩功能，减少文件传输大小，节省带宽。</span></span><br><span class="line">gzip_min_length 1k; :最小文件压缩，1k起压。</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">gzip_types text/plain text/xml; :压缩文件类型</span></span><br><span class="line">gzip_comp_level 3; :压缩级别，默认是1。</span><br></pre></td></tr></table></figure>

<h4 id="1-4-1-gzip"><a href="#1-4-1-gzip" class="headerlink" title="1.4.1 gzip"></a>1.4.1 gzip</h4><p>&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;nginx.conf</p>
<p>gzip配置的常用参数</p>
<p>gzip on|off; #是否开启gzip</p>
<p>gzip_buffers 32 4K| 16 8K #缓冲(压缩在内存中缓冲几块? 每块多大?)</p>
<p>gzip_comp_level [1-9] #推荐6 压缩级别(级别越高,压的越小,越浪费CPU计算资源)</p>
<p>gzip_disable #正则匹配UA 什么样的Uri不进行gzip</p>
<p>gzip_min_length 200 # 开始压缩的最小长度(再小就不要压缩了,意义不在)</p>
<p>gzip_http_version 1.0|1.1 # 开始压缩的http协议版本(可以不设置,目前几乎全是1.1协议)</p>
<p>gzip_proxied # 设置请求者代理服务器,该如何缓存内容</p>
<p>gzip_types text&#x2F;plain application&#x2F;xml # 对哪些类型的文件用压缩 如txt,xml,html ,css</p>
<p>gzip_vary on|off # 是否传输gzip压缩标志</p>
<p><strong>注意：</strong></p>
<p><strong>图片&#x2F;mp3这样的二进制文件,不必压缩</strong></p>
<p><strong>因为压缩率比较小, 比如100-&gt;80字节,而且压缩也是耗费CPU资源的.</strong></p>
<h4 id="1-4-2-autoindex"><a href="#1-4-2-autoindex" class="headerlink" title="1.4.2 autoindex"></a>1.4.2 autoindex</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">gzip  on;</span><br><span class="line">gzip_buffers 32 4K;</span><br><span class="line">gzip_comp_level 6;</span><br><span class="line">gzip_min_length 100;</span><br><span class="line">gzip_types application/javascript text/css text/xml;</span><br><span class="line">gzip_disable <span class="string">&quot;MSIE [1-6]\.&quot;</span>; <span class="comment"># 配置禁用gzip条件，支持正则。此处表示ie6及以下不启用gzip（因为ie低版本不支持）</span></span><br><span class="line">gzip_vary on;</span><br><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  localhost;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#charset koi8-r;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#access_log  logs/host.access.log  main;</span></span><br><span class="line"></span><br><span class="line">    location /SRE &#123;</span><br><span class="line">       <span class="built_in">alias</span> /usr/local/nginx/SRE/;</span><br><span class="line">       autoindex on;</span><br><span class="line">       autoindex_format html;</span><br><span class="line">       autoindex_exact_size off;</span><br><span class="line">       autoindex_localtime on;</span><br><span class="line">       charset utf-8,gbk;</span><br><span class="line">       <span class="comment">#root   html;</span></span><br><span class="line">       <span class="comment">#index  index.html index.htm;</span></span><br><span class="line">       </span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">autoindex on; <span class="comment">#开启目录浏览</span></span><br><span class="line">autoindex_format html; <span class="comment">#以html风格将目录展示在浏览器中</span></span><br><span class="line">autoindex_exact_size off; <span class="comment">#切换为 off 后，以可读的方式显示文件大小，单位为 KB、MB 或者 GB</span></span><br><span class="line">autoindex_localtime on; <span class="comment">#以服务器的文件时间作为显示的时间</span></span><br><span class="line">charset utf-8,gbk; <span class="comment">#展示中文文件名</span></span><br></pre></td></tr></table></figure>

<h4 id="1-4-3-upstream"><a href="#1-4-3-upstream" class="headerlink" title="1.4.3 upstream"></a>1.4.3 upstream</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">upstream cszhi.com &#123;</span><br><span class="line">    ip_hash;</span><br><span class="line">    server 192.168.8.11:80;</span><br><span class="line">    server 192.168.8.12:80 down;</span><br><span class="line">    server 192.168.8.13:8009 max_fails=3 fail_timeout=20s;</span><br><span class="line">    server 192.168.8.146:8080;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>upstream指令指定了一个负载均衡器的名称cszhi.com</p>
</blockquote>
<ul>
<li>轮询（默认）：每个请求按时间顺序逐一分配到不同的后端服务器，如果后端某台服务器宕机，故障系统被自动剔除，使用户访问不受影响；</li>
<li>Weight：指定轮询权值，<strong>Weight值越大</strong>，分配到的访问机率越高，主要用于后端每个服务器性能不均的情况下；</li>
<li>ip_hash：每个请求按访问IP的hash结果分配，这样<strong>来自同一个IP的访客固定访问一个后端服务器</strong>，有效解决了动态网页存在的session共享问题；</li>
<li>fair：比上面两个更加智能的负载均衡算法。此种算法可以依据页面大小和加载时间长短智能地进行负载均衡，也就是<strong>根据后端服务器的响应时间来分配请求，响应时间短的优先分配</strong>。Nginx本身是不支持fair的，如果需要使用这种调度算法，必须下载Nginx的upstream_fair模块；</li>
<li>url_hash：按访问url的hash结果来分配请求，使<strong>每个url定向到同一个后端服务器</strong>，可以进一步提高后端缓存服务器的效率。Nginx本身是不支持url_hash的，如果需要使用这种调度算法，安装Nginx的hash软件包。</li>
</ul>
<blockquote>
<p>通过server指令指定后端服务器的IP地址和端口，同时还可以设定每个后端服务器在负载均衡调度中的状态 </p>
</blockquote>
<ul>
<li>down：表示当前的server暂时不参与负载均衡；</li>
<li>backup：预留的备份机器。当其他所有的非backup机器出现故障或者忙的时候，才会请求backup机器，因此这台机器的压力最轻；</li>
<li>max_fails：允许请求失败的次数，默认为1。当超过最大次数时，返回proxy_next_upstream 模块定义的错误；</li>
<li>fail_timeout：在经历了max_fails次失败后，暂停服务的时间。max_fails可以和fail_timeout一起使用。</li>
</ul>
<p>&#x3D;&#x3D;当负载调度算法为ip_hash时，后端服务器在负载均衡调度中的状态不能是weight和backup&#x3D;&#x3D;</p>
<h3 id="1-5-server指令块："><a href="#1-5-server指令块：" class="headerlink" title="1.5 server指令块："></a>1.5 server指令块：</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">server :		用来定义虚拟主机。</span><br><span class="line">listen :		设置监听端口，默认为80端口</span><br><span class="line">server_name :	域名，多个域名通过逗号或者空格隔开</span><br><span class="line">Charset :		设置网页的默认编码格式</span><br><span class="line">access_log :	指定该虚拟主机的独立访问日志，会覆盖前面的全局配置。</span><br><span class="line">index :			设置默认的索引文件</span><br><span class="line">location :		定义请求匹配规则。</span><br><span class="line">error_page :	定义访问错误返回的页面，凡是状态码是500 502 503 504都会返回这个页面。</span><br></pre></td></tr></table></figure>

<h3 id="1-6-location指令块："><a href="#1-6-location指令块：" class="headerlink" title="1.6 location指令块："></a>1.6 location指令块：</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location ~ \.php$ :	凡是以php结尾文件，都会匹配到这条规则。</span><br><span class="line">root :				php文件存放的目录</span><br><span class="line">fastcgi_pass :		指定php-fpm进程管理的ip端口或者unix套接字</span><br><span class="line">fastcgi_index :		指定php脚本目录下的索引文件</span><br><span class="line">fastcgi_param :		指定传递给FastCGI服务器的参数</span><br><span class="line">location ~ /\.ht :	凡是请求类似.ht资源，都拒绝。</span><br></pre></td></tr></table></figure>

<p> 配置Location指令块，来决定客户端发过来的请求URI如何处理。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Syntax: location [ = | ~ | ~* | ^~ ] uri &#123; ... &#125;</span><br><span class="line">location @name &#123; ... &#125;</span><br><span class="line">Default: —</span><br><span class="line">Context: server, location</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修饰符</span></span><br><span class="line">= ：精确匹配（必须全部相等）</span><br><span class="line">~ ：大小写敏感（正则表达式）</span><br><span class="line">~* ：忽略大小写（正则表达式），这里要注意忽略大小写的意思是请求的字符大小写都可以，</span><br><span class="line">但是不会进行大小转换，请求的大小写对应的文件必须存在。</span><br><span class="line">^~ ：只需匹配uri部分</span><br><span class="line">@ ：内部服务跳转</span><br></pre></td></tr></table></figure>

<blockquote>
<p>优先级参考</p>
<p>&#x3D;    ^~     <del>|</del>*  </p>
</blockquote>
<h3 id="1-7-热部署"><a href="#1-7-热部署" class="headerlink" title="1.7 热部署"></a>1.7 热部署</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">1、<span class="comment"># 升级一般是添加新的模块，或者升级版本，所以要参考以前编译的模块，如果不添加，那么以前的模块就不能使用了</span></span><br><span class="line">[root@node3 ~]<span class="comment"># /usr/local/nginx/sbin/nginx -V</span></span><br><span class="line">2、<span class="comment"># 预编译/编译/安装：</span></span><br><span class="line">./configure --prefix=/usr/local/nginx</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">3、<span class="comment"># 直接升级：</span></span><br><span class="line">make upgrade</span><br><span class="line"><span class="comment"># 查看相关指令</span></span><br><span class="line">[root@cbe121551be1 nginx-1.18.0]<span class="comment"># cat /usr/local/src/nginx-1.18.0/Makefile </span></span><br><span class="line"></span><br><span class="line">default:	build</span><br><span class="line">clean:</span><br><span class="line">	<span class="built_in">rm</span> -rf Makefile objs</span><br><span class="line">build:</span><br><span class="line">	$(MAKE) -f objs/Makefile</span><br><span class="line">install:</span><br><span class="line">	$(MAKE) -f objs/Makefile install</span><br><span class="line">modules:</span><br><span class="line">	$(MAKE) -f objs/Makefile modules</span><br><span class="line">upgrade:</span><br><span class="line">	/usr/local/nginx/sbin/nginx -t</span><br><span class="line"></span><br><span class="line">	<span class="built_in">kill</span> -USR2 `<span class="built_in">cat</span> /usr/local/nginx/logs/nginx.pid`</span><br><span class="line">	<span class="built_in">sleep</span> 1</span><br><span class="line">	<span class="built_in">test</span> -f /usr/local/nginx/logs/nginx.pid.oldbin</span><br><span class="line"></span><br><span class="line">	<span class="built_in">kill</span> -QUIT `<span class="built_in">cat</span> /usr/local/nginx/logs/nginx.pid.oldbin`</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="1-8-rewrite"><a href="#1-8-rewrite" class="headerlink" title="1.8  rewrite"></a>1.8  rewrite</h3><p>rewrite是实现URL重写的关键指令，根据regex（正则表达式）部分内容， 重定向到replacement，结尾是flag标记。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">rewrite &lt;regex&gt; &lt;replacement&gt; [flag];</span><br><span class="line">		  正则 	  替代内容     flag标记</span><br><span class="line">正则：		perl兼容正则表达式语句进行规则匹配</span><br><span class="line">替代内容：  将正则匹配的内容替换成replacement</span><br><span class="line">flag标记： rewrite支持的flag标记</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag标记说明：</span></span><br><span class="line">last <span class="comment">#本条规则匹配完成终止当前location的规则，继续向下匹配新的location URI规则</span></span><br><span class="line"><span class="built_in">break</span> <span class="comment">#本条规则匹配完成即终止，不再匹配后面的任何规则</span></span><br><span class="line">redirect <span class="comment">#返回302临时重定向，浏览器地址会显示跳转后的URL地址，关闭服务，无法重定向。</span></span><br><span class="line">permanent <span class="comment">#返回301永久重定向，浏览器地址栏会显示跳转后的URL地址，</span></span><br><span class="line">关闭服务，依然可以重定向，清除缓存失效。</span><br></pre></td></tr></table></figure>

<h4 id="1-8-1-实现域名跳转"><a href="#1-8-1-实现域名跳转" class="headerlink" title="1.8.1  实现域名跳转"></a>1.8.1  实现域名跳转</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">方案一：</span><br><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name lutixia.com;</span><br><span class="line">	rewrite ^/(.*)$ http://www.lutixia.com/<span class="variable">$1</span> permanent;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name www.lutixia.com;</span><br><span class="line">	location / &#123;</span><br><span class="line">		root /data/www/;</span><br><span class="line">		index index.html index.htm;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">方案二：</span><br><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name www.lutixia.com lutixia.com;</span><br><span class="line">	<span class="keyword">if</span> ( <span class="variable">$host</span> != <span class="string">&#x27;www.lutixia.com&#x27;</span> ) &#123;</span><br><span class="line">		rewrite ^/(.*)$ http://www.lutixia.com/<span class="variable">$1</span> permanent;</span><br><span class="line">	&#125;</span><br><span class="line">	location / &#123;</span><br><span class="line">		root /data/www/;</span><br><span class="line">		index index.html index.htm;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">方案三：</span><br><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name lutixia.com;</span><br><span class="line">	<span class="built_in">return</span> 302 http://www.lutixia.com/<span class="variable">$request_uri</span></span><br><span class="line">	permanent;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name www.lutixia.com;</span><br><span class="line">	location / &#123;</span><br><span class="line">		root /data/www/;</span><br><span class="line">		index index.html index.htm;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">ps：本地需要做hosts解析</span><br><span class="line">192.168.75.130 www.lutixia.com lutixia.com</span><br></pre></td></tr></table></figure>

<h4 id="1-8-2-实现不同终端跳转"><a href="#1-8-2-实现不同终端跳转" class="headerlink" title="1.8.2 实现不同终端跳转"></a>1.8.2 实现不同终端跳转</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name lutixia.com www.lutixia.com;</span><br><span class="line">	root /usr/share/nginx/html/test;</span><br><span class="line">	<span class="keyword">if</span> ( <span class="variable">$http_user_agent</span> ~* <span class="string">&quot;iphone|android&quot;</span>) &#123;</span><br><span class="line">		rewrite ^/(.*)$	 http://m.lutixia.com/<span class="variable">$1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	index index.html;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name m.lutixia.com;</span><br><span class="line">	root /data/www/m;</span><br><span class="line">	index index.html;</span><br><span class="line">	location / &#123;</span><br><span class="line">		default_type text/html;</span><br><span class="line">		<span class="built_in">return</span> 200 <span class="string">&quot;this is iphone|android html&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-8-3-实现浏览器的语言跳转"><a href="#1-8-3-实现浏览器的语言跳转" class="headerlink" title="1.8.3 实现浏览器的语言跳转"></a>1.8.3 实现浏览器的语言跳转</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 根据浏览器的语言跳转到指定url:</span></span><br><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name lutixia.com www.lutixia.com;</span><br><span class="line">	root /usr/share/nginx/html/test;</span><br><span class="line">	index index.html;</span><br><span class="line">	location / &#123;</span><br><span class="line">		<span class="keyword">if</span> ( <span class="variable">$http_accept_language</span> ~ <span class="string">&quot;^zh-CN&quot;</span> ) &#123;</span><br><span class="line">			rewrite ^/(.*) /zh/<span class="variable">$1</span> ;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> ( <span class="variable">$http_accept_language</span> ~ <span class="string">&quot;^en&quot;</span> ) &#123;</span><br><span class="line">			rewrite ^/(.*) /en/<span class="variable">$1</span> ;</span><br><span class="line">		&#125;</span><br><span class="line">		root html;</span><br><span class="line">		index index.html index.htm;</span><br><span class="line">	&#125;</span><br><span class="line">	location ^~ /zh/ &#123;</span><br><span class="line">		root html/;</span><br><span class="line">		index index.html;</span><br><span class="line">	&#125;</span><br><span class="line">	location ^~ /en/ &#123;</span><br><span class="line">		root html/;</span><br><span class="line">		index index.html;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">mkdir</span> -p /usr/share/nginx/html/test/zh</span><br><span class="line"><span class="built_in">mkdir</span> -p /usr/share/nginx/html/test/en</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;this is 中文 &quot;</span> &gt; /usr/share/nginx/html/test/zh/index.html</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;this is English &quot;</span> &gt; /usr/share/nginx/html/test/en/index.html</span><br></pre></td></tr></table></figure>





<h2 id="2、-常用模块"><a href="#2、-常用模块" class="headerlink" title="2、 常用模块"></a>2、 常用模块</h2><h3 id="2-1-access模块"><a href="#2-1-access模块" class="headerlink" title="2.1 access模块"></a>2.1 access模块</h3><p>访问控制模块 ，该模块可以实现简单的防火墙功能，过滤特定的主机。这 个模块在我们编译nginx时会默认编译进nginx的二进制文件中。 </p>
<p><strong>语法:</strong> </p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Syntax: allow address | CIDR | unix: | all;</span><br><span class="line">Default: —</span><br><span class="line">Context: http, server, location, limit_except</span><br><span class="line"></span><br><span class="line">Syntax: deny address | CIDR | unix: | all;</span><br><span class="line">Default: —</span><br><span class="line">Context: http, server, location, limit_except</span><br></pre></td></tr></table></figure>

<ul>
<li>allow: 允许访问的IP或者网段。 </li>
<li>deny: 拒绝访问的ip或者网段。</li>
</ul>
<p>从语法上看，它允许配置在http指令块中，server指令块中还有locatio指 令块中，这三者的作用域有所不同。 </p>
<p>如果配置在http指令段中，将对所有server(虚拟主机)生效； </p>
<p>配置在server指令段中，对当前虚拟主机生效； </p>
<p>配置在location指令块中，对匹配到的目录生效。 </p>
<p>ps: 如果server指令块，location指令块没有配置限制指令，那么将会继承 http的限制指令，但是一旦配置了会覆盖http的限制指令。 或者说作用域小的配置会覆盖作用域大的配置。  </p>
<h3 id="2-2-auth-basic模块"><a href="#2-2-auth-basic模块" class="headerlink" title="2.2  auth_basic模块"></a>2.2  auth_basic模块</h3><p>用户认证模块，对访问目录进行加密，需要用户权限认证 </p>
<p>这个功能特性是由ngx_http_auth_basic_module提供的，默认编译nginx 时会编译好，主要有以下两个指令。  </p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Syntax: auth_basic string | off;</span><br><span class="line">Default: auth_basic off;</span><br><span class="line">Context: http, server, location, limit_except</span><br><span class="line"></span><br><span class="line">Syntax: auth_basic_user_file file;</span><br><span class="line">Default: —</span><br><span class="line">Context: http, server, location, limit_except</span><br></pre></td></tr></table></figure>

<p>认证的配置可以在http指令块，server指令块，location指令块配置。 </p>
<ul>
<li>auth_basic string ：定义认证的字符串，会通过响应报文返给客户端，也可以通过这个指令关闭认证。 </li>
<li>auth_basic_user_file file ：定义认证文件。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对匹配目录加密：</span></span><br><span class="line">location /img &#123;</span><br><span class="line">auth_basic <span class="string">&quot;User Auth&quot;</span>;</span><br><span class="line">auth_basic_user_file /usr/local/nginx/conf/auth.passwd;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">auth_basic <span class="comment"># 设置名字</span></span><br><span class="line">auth_basic_user_file <span class="comment"># 用户认证文件放置路径</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成认证文件：</span></span><br><span class="line">yum install httpd-tools -y</span><br><span class="line">htpasswd -c /usr/local/nginx/conf/auth.passwd admin</span><br><span class="line">输入两次密码确定。</span><br><span class="line"><span class="comment"># 重启服务后，访问验证</span></span><br><span class="line"></span><br><span class="line">htpasswd(选项)(参数)</span><br><span class="line">选项</span><br><span class="line">-c：创建一个加密文件；</span><br><span class="line">-m：默认采用MD5算法对密码进行加密；</span><br><span class="line">-d：采用CRYPT算法对密码进行加密；</span><br><span class="line">-p：不对密码进行进行加密，即明文密码；</span><br><span class="line">-s：采用SHA算法对密码进行加密；</span><br><span class="line">-b：在命令行中一并输入用户名和密码而不是根据提示输入密码；</span><br><span class="line">-D：删除指定的用户。</span><br><span class="line"><span class="comment"># 添加用户名及密码：</span></span><br><span class="line">htpasswd -b /usr/local/nginx/conf/auth.passwd lutixia lutixia666</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2-3-stub-status-模块"><a href="#2-3-stub-status-模块" class="headerlink" title="2.3 stub_status 模块"></a>2.3 stub_status 模块</h3><p> 状态查看模块 ，该模块可以 输出nginx的基本状态信息 。 需要源码编译。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Syntax: stub_status;</span><br><span class="line">Default: —</span><br><span class="line">Context: server, location</span><br><span class="line"></span><br><span class="line">location = /status &#123;</span><br><span class="line">stub_status;</span><br><span class="line">allow 192.168.75.130;</span><br><span class="line">deny all;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Active connections:当前活动状态的连接数</span><br><span class="line">accepts：统计总值，已经接受的客户端请求的总数</span><br><span class="line">handled：统计总值，已经处理完成的客户端请求的总数</span><br><span class="line">requests：统计总值，客户端发来的总的请求数</span><br><span class="line">Reading：当前状态，正在读取客户端请求报文首部的连接的连接数</span><br><span class="line">Writing：当前状态，正在向客户端发送响应报文过程中的连接数</span><br><span class="line">Waiting：当前状态，正在等待客户端发出请求的空闲连接数</span><br></pre></td></tr></table></figure>

<h3 id="2-4-referer-模块"><a href="#2-4-referer-模块" class="headerlink" title="2.4 referer 模块"></a>2.4 referer 模块</h3><p>该模块可以进行防盗链设置。 盗链的含义是网站内容本身不在自己公司的服务器上，而通过技术手段， 直接调用其他公司的服务器网站数据，而向最终用户提供此内容。 </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Syntax: valid_referers none | blocked | server_names |</span><br><span class="line">string ...;</span><br><span class="line">Default: —</span><br><span class="line">Context: server, location</span><br><span class="line"></span><br><span class="line">location ~* \.(gif|jpg|png|swf|flv)$ &#123;</span><br><span class="line">	valid_referers none blocked lutixia.net *.jfedu.net;</span><br><span class="line">	root /usr/share/nginx/html;</span><br><span class="line">	<span class="keyword">if</span> (<span class="variable">$invalid_referer</span>) &#123;</span><br><span class="line">		<span class="built_in">return</span> 403;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">valid_referers 表示合法的referers设置</span><br><span class="line">none： 表示没有referers，直接通过浏览器或者其他工具访问。</span><br><span class="line">blocked： 表示有referers，但是被代理服务器或者防火墙隐藏；</span><br><span class="line">lutixia.net： 表示通过lutixia.net访问的referers；</span><br><span class="line">*.jfedu.net: 表示通过*.jfedu.net访问的referers，*表示任意host主机。</span><br></pre></td></tr></table></figure>

<h2 id="3、虚拟主机"><a href="#3、虚拟主机" class="headerlink" title="3、虚拟主机"></a>3、虚拟主机</h2><p> 虚拟主机的三种模式: </p>
<ul>
<li>基于多域名方式配置虚拟主机 </li>
<li>基于多端口配置虚拟主机 </li>
<li>基于多ip配置虚拟主机</li>
</ul>
<h3 id="3-1-多域名方式"><a href="#3-1-多域名方式" class="headerlink" title="3.1 多域名方式"></a>3.1 多域名方式</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">1、<span class="comment"># 配置hosts文件</span></span><br><span class="line"><span class="comment"># Windows 本地hosts文件</span></span><br><span class="line">C:\Windows\System32\drivers\etc\hosts</span><br><span class="line"><span class="comment"># Linux 本地hosts 文件</span></span><br><span class="line">vim /etc/hosts</span><br><span class="line"></span><br><span class="line">2、<span class="comment"># 创建虚拟主机配置文件</span></span><br><span class="line"><span class="comment">#在http指定块中添加：</span></span><br><span class="line">include /usr/local/nginx/conf/vhost/*.conf;</span><br><span class="line"><span class="comment">#创建配置主机配置文件</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /usr/local/nginx/conf/vhost</span><br><span class="line">vim /usr/local/nginx/conf/vhost/www.jfedu.com.conf</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name www.jfedu.com;</span><br><span class="line">	location / &#123;</span><br><span class="line">		root /usr/local/nginx/html/jfedu;</span><br><span class="line">		index index.html index.htm;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vim /usr/local/nginx/conf/vhost/www.jf.com.conf</span><br><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name www.jf.com;</span><br><span class="line">	location / &#123;</span><br><span class="line">		root /usr/local/nginx/html/jf;</span><br><span class="line">		index index.html index.htm;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-多端口方式"><a href="#3-2-多端口方式" class="headerlink" title="3.2  多端口方式"></a>3.2  多端口方式</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">	listen 8080;</span><br><span class="line">	server_name www.jfedu.com;</span><br><span class="line">	location / &#123;</span><br><span class="line">		root /usr/share/nginx/html/jfedu;</span><br><span class="line">		index index.html;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-3-多IP方式"><a href="#3-3-多IP方式" class="headerlink" title="3.3 多IP方式"></a>3.3 多IP方式</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> /etc/sysconfig/network-scripts/ifcfg-ens32&#123;,:1&#125;</span><br><span class="line">vim /etc/sysconfig/network-scripts/ifcfg-ens32:1</span><br><span class="line">修改以下信息:</span><br><span class="line">NAME=<span class="string">&quot;ens32:1&quot;</span></span><br><span class="line">DEVICE=<span class="string">&quot;ens32:1&quot;</span></span><br><span class="line">IPADDR=192.168.75.188</span><br><span class="line"><span class="comment"># 重启服务：</span></span><br><span class="line">systemctl restart network</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">	listen 192.168.75.188:80;</span><br><span class="line">	server_name www.jfedu.com;</span><br><span class="line">	location / &#123;</span><br><span class="line">		root /usr/share/nginx/html/jfedu;</span><br><span class="line">	index index.html;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">重启nginx服务：</span><br><span class="line">systemctl restart nginx</span><br></pre></td></tr></table></figure>

<h2 id="4、反向代理"><a href="#4、反向代理" class="headerlink" title="4、反向代理"></a>4、反向代理</h2><h3 id="4-1-反向代理作用"><a href="#4-1-反向代理作用" class="headerlink" title="4.1 反向代理作用"></a>4.1 反向代理作用</h3><p>与正向代理（正向代理主要是代理客户端的请求）相反，反向代理主要是 代理服务器返回的数据</p>
<ul>
<li><ol>
<li>可以防止内部服务器被恶意攻击（内部服务器对客户端不可见）。</li>
</ol>
</li>
<li><ol start="2">
<li>为负载均衡和动静分离提供技术支持。</li>
</ol>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Syntax: proxy_pass URL;</span><br><span class="line">Default: —</span><br><span class="line">Context: location, <span class="keyword">if</span> <span class="keyword">in</span> location, limit_except</span><br><span class="line"></span><br><span class="line"><span class="comment"># 代理服务器的协议，可支持http与https。地址可以指定为域名或IP地址，以及可选端口</span></span><br><span class="line">proxy_pass http://192.168.0.188;</span><br><span class="line">proxy_pass http://192.168.0.188:8080;</span><br><span class="line">proxy_pass http://localhost:9000/uri/;</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># location和proxy_pass都不带uri路径</span></span><br><span class="line"><span class="comment"># 代理服务器的简单配置：</span></span><br><span class="line">location / &#123;</span><br><span class="line">	proxy_pass http://192.168.0.114;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># proxy_pass 转发请求给后端服务器</span></span><br><span class="line"><span class="comment"># 后端服务器的配置：</span></span><br><span class="line">location / &#123;</span><br><span class="line">	<span class="built_in">echo</span> <span class="variable">$host</span>;</span><br><span class="line">	root html;</span><br><span class="line">	index index.html index.htm;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># echo $host 这个主要是来看下后端接收到的Host是什么。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># proxy_pass没有设置uri路径，但是代理服务器的location 有uri，那么代理服务器将把客户端请求的地址传递给后端服务器</span></span><br><span class="line"><span class="comment"># 代理服务器的配置：</span></span><br><span class="line">location /document/data/ &#123;</span><br><span class="line">	proxy_pass http://192.168.0.114;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 后端服务器的配置：</span></span><br><span class="line">location / &#123;</span><br><span class="line">	<span class="comment"># echo $host;</span></span><br><span class="line">	root html/uri;</span><br><span class="line">	index index.html index.htm;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果proxy_pass设置了uri路径，则需要注意，此时，proxy_pass指令所指定的uri会覆盖location的uri。</span></span><br><span class="line"><span class="comment"># 代理服务器的配置：</span></span><br><span class="line">location / &#123;</span><br><span class="line">	proxy_pass http://192.168.0.114/data/;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 后端服务器的配置：</span></span><br><span class="line">location / &#123;</span><br><span class="line">	root html;</span><br><span class="line">	index index.html index.htm;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="4-2-获取远程客户端真实ip地址"><a href="#4-2-获取远程客户端真实ip地址" class="headerlink" title="4.2  获取远程客户端真实ip地址"></a>4.2  获取远程客户端真实ip地址</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 代理服务器配置：</span></span><br><span class="line">location / &#123;</span><br><span class="line">	proxy_pass http://192.168.0.114;</span><br><span class="line">	proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">	proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">	proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 后端服务器配置：</span></span><br><span class="line">log_format main <span class="string">&#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span></span><br><span class="line"><span class="string">&#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span></span><br><span class="line"><span class="string">&#x27;&quot;$http_user_agent&quot; &quot;$http_x_real_ip&quot; &quot;$http_x_forwarded_for&quot;&#x27;</span>;</span><br><span class="line">access_log logs/access.log main;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="4-3-缓存代理服务器"><a href="#4-3-缓存代理服务器" class="headerlink" title="4.3  缓存代理服务器"></a>4.3  缓存代理服务器</h3><p>浏览器上的缓存配置，一般来说是用来减少本地IO的，请求目标的内容 会存放在浏览器本地 </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 代理服务器配置：</span></span><br><span class="line">proxy_cache_path /data/nginx/cache max_size=10g levels=1:2 keys_zone=nginx_cache:10m inactive=10m use_temp_path=off;</span><br><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name localhost;</span><br><span class="line">	location / &#123;</span><br><span class="line">		root html;</span><br><span class="line">		index index.html index.htm;</span><br><span class="line">		proxy_pass http://192.168.0.114;</span><br><span class="line">		proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">		proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">		proxy_cache nginx_cache;</span><br><span class="line">		proxy_cache_key $host$uri$is_args<span class="variable">$args</span>;</span><br><span class="line">		proxy_cache_valid 200 304 302 1d;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">/data/nginx/cache <span class="comment">#缓存资源存放路径</span></span><br><span class="line"></span><br><span class="line">levels <span class="comment">#设置缓存资源的递归级别，默认为levels=1:2，表示Nginx为将要缓存的资源生成的key从后依次设置两级保存。</span></span><br><span class="line"></span><br><span class="line">key_zone <span class="comment">#在共享内存中设置一块存储区域来存放缓存的key和metadata，这样nginx可以快速判断一个request是否命中或者未命中缓存，1m可以存储8000个key，10m可以存储80000个key</span></span><br><span class="line"></span><br><span class="line">max_size <span class="comment">#最大cache空间，如果不指定，会使用掉所有disk space，当达到配额后，会删除不活跃的cache文件</span></span><br><span class="line"></span><br><span class="line">inactive <span class="comment">#未被访问文件在缓存中保留时间，本配置中如果60分钟未被访问则不论状态是否为expired，缓存控制程序会删掉文件。inactive默认是10分钟。需要注意的是，inactive和expired配置项的含义是不同的，</span></span><br><span class="line"><span class="comment">#expired只是缓存过期，但不会被删除，inactive是删除指定时间内未被访问的缓存文件</span></span><br><span class="line"></span><br><span class="line">use_temp_path <span class="comment">#如果为off，则nginx会将缓存文件直接写入指定的cache文件中，而不是使用temp_path存储，official建议为off，避免文件在不同文件系统中不必要的拷贝proxy_cache #启用proxy cache，并指定key_zone。如果proxy_cache off表示关闭掉缓存。</span></span><br></pre></td></tr></table></figure>

<h2 id="5、负载均衡"><a href="#5、负载均衡" class="headerlink" title="5、负载均衡"></a>5、负载均衡</h2><h3 id="5-1-工作原理"><a href="#5-1-工作原理" class="headerlink" title="5.1  工作原理"></a>5.1  工作原理</h3><p>负载均衡分为四层负载均衡和七层负载均衡。 </p>
<p><strong>四层负载均衡</strong>是工作在七层协议的第四层-传输层，主要工作是<strong>转发</strong>。 它在接收到客户端的流量以后通过修改数据包的地址信息（目标地址和端 口和源地址）将流量转发到应用服务器。 </p>
<p><strong>七层负载均衡</strong>是工作在七层协议的第七层-应用层，主要工作是<strong>代理</strong>。 它首先会与客户端建立一条完整的连接并将应用层的请求流量解析出来， 再按照调度算法选择一个应用服务器，并与应用服务器建立另外一条连接 将请求发送过去。  </p>
<p><img src="/Nginx.assets/1607148644045.png" alt="1607148644045"></p>
<h3 id="5-2-配置七层均衡"><a href="#5-2-配置七层均衡" class="headerlink" title="5.2  配置七层均衡"></a>5.2  配置七层均衡</h3><p>前端服务器主要配置upstream和proxy_pass： </p>
<ul>
<li>upstream 主要是配置均衡池和调度方法。 </li>
<li>proxy_pass 主要是配置代理服务器ip或服务器组的名字。 </li>
<li>proxy_set_header 主要是配置转发给后端服务器的Host和前端客户端真实 ip。</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 代理服务器配置</span></span><br><span class="line"><span class="comment"># 在http指令块下配置upstream指令块</span></span><br><span class="line">upstream web &#123;</span><br><span class="line">	server 192.168.1.5;</span><br><span class="line">	server 192.168.1.7;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 在location指令块配置proxy_pass</span></span><br><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name localhost;</span><br><span class="line">	location / &#123;</span><br><span class="line">		proxy_pass http://web;</span><br><span class="line">		proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">		proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># proxy_set_header Host $host;</span></span><br><span class="line">通过这个指令，把客户端请求的host，转发给后端。</span><br><span class="line"><span class="comment"># proxy_set_header X-Real-IP $remote_addr</span></span><br><span class="line">通过这个指令，把客户端的IP转发给后端服务器，在后端服务器的日志格式中，</span><br><span class="line">添加<span class="variable">$http_x_real_ip</span>即可获取原始客户端的IP了。</span><br></pre></td></tr></table></figure>

<h4 id="5-2-1-最大错误连接次数"><a href="#5-2-1-最大错误连接次数" class="headerlink" title="5.2.1 最大错误连接次数"></a>5.2.1 最大错误连接次数</h4><p>错误的连接由proxy_next_upstream， fastcgi_next_upstream等指令决 定 </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">upstream web &#123;</span><br><span class="line">	server 192.168.1.5 weight=1 max_fails=3 fail_timeout=9s;</span><br><span class="line">	<span class="comment">#先将1.5这台nginx关了。</span></span><br><span class="line">	server 192.168.1.7 weight=1;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name localhost;</span><br><span class="line">	location / &#123;</span><br><span class="line">		proxy_pass http://web;</span><br><span class="line">		<span class="comment">#proxy_next_upstream error http_404 http_502;</span></span><br><span class="line">		proxy_next_upstream off;</span><br><span class="line">		proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">		proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># proxy_next_upstream error http_404 http_502;</span></span><br><span class="line">通过这个指令，可以处理当后端服务返回404等报错时，直接将请求转发给其他服务器，而不是把报错信息返回客户端。</span><br><span class="line"><span class="comment"># 在这里，我们将超时时间设置为9s，最多尝试3次，</span></span><br><span class="line">这里要注意，尝试3次，依然遵循轮询的规则，并不是一个请求，连接3次，而是轮询三次，有3次处理请求的机会。</span><br></pre></td></tr></table></figure>

<h4 id="5-2-2-ip-hash"><a href="#5-2-2-ip-hash" class="headerlink" title="5.2.2 ip_hash"></a>5.2.2 ip_hash</h4><p>通过客户端ip进行hash，再通过hash值选择后端server .</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream web &#123;</span><br><span class="line">	ip_hash;</span><br><span class="line">	server 192.168.1.5 weight=1 max_fails=3 fail_timeout=9s;</span><br><span class="line">	server 192.168.1.7 weight=1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在使用负载均衡的时候会遇到会话保持的问题,常用的方法有: </p>
<ul>
<li>ip hash，根据客户端的IP，将请求分配到不同的服务器上; </li>
<li>cookie，服务器给客户端下发一个cookie，具有特定cookie的请求会分 配给它的发布者。</li>
</ul>
<h4 id="5-2-3-url-hash"><a href="#5-2-3-url-hash" class="headerlink" title="5.2.3 url_hash"></a>5.2.3 url_hash</h4><p>通过请求url进行hash，再通过hash值选择后端server </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">upstream nginx_web &#123;</span><br><span class="line">	<span class="built_in">hash</span> <span class="variable">$request_uri</span> consistent;</span><br><span class="line">	server 192.168.75.128;</span><br><span class="line">	server 192.168.75.135;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 第一次请求的uri分配给后端服务器后，后面相同的uri请求都是这台服务器处理</span></span><br></pre></td></tr></table></figure>

<h4 id="5-2-4-根据响应时间均衡"><a href="#5-2-4-根据响应时间均衡" class="headerlink" title="5.2.4 根据响应时间均衡"></a>5.2.4 根据响应时间均衡</h4><p>fair算法会根据后端节点服务器的响应时间来分配请求，时间短的优先分配 </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载模块：</span></span><br><span class="line">wget https://github.com/gnosek/nginx-upstreamfair/archive/master.zip</span><br><span class="line"><span class="comment"># 解压：</span></span><br><span class="line">unzip master.zip</span><br><span class="line"><span class="comment"># 修改源码bug：</span></span><br><span class="line">sed -i <span class="string">&#x27;s/default_port/no_port/g&#x27;</span> ngx_http_upstream_fair_module.c</span><br><span class="line"><span class="comment"># 预编译：</span></span><br><span class="line">./configure --prefix=/usr/local/nginx --addmodule=../echo-nginx-module --with-http_stub_status_module</span><br><span class="line">--add-module=../nginx-upstream-fair-master</span><br><span class="line"><span class="comment"># 编译/安装：</span></span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"><span class="comment"># 配置：</span></span><br><span class="line">upstream web &#123;</span><br><span class="line">	fair;</span><br><span class="line">	server 192.168.1.5 weight=1 max_fails=3 fail_timeout=9s;</span><br><span class="line">	server 192.168.1.7 weight=1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-2-5-备用服务器"><a href="#5-2-5-备用服务器" class="headerlink" title="5.2.5 备用服务器"></a>5.2.5 备用服务器</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream web &#123;</span><br><span class="line">	server 192.168.1.5 weight=1 max_fails=3 fail_timeout=9s;</span><br><span class="line">	server 192.168.1.7 weight=1 backup;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 1.7的服务器做备用服务器，只有在1.5得服务器不能提供服务时，才会自动顶上,否则，默认是不提供服务的。</span></span><br></pre></td></tr></table></figure>

<h3 id="5-3-配置四层均衡"><a href="#5-3-配置四层均衡" class="headerlink" title="5.3 配置四层均衡"></a>5.3 配置四层均衡</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">前端服务器：192.168.75.130</span><br><span class="line"></span><br><span class="line">后端服务器1：192.168.75.128</span><br><span class="line">后端服务器2：192.168.75.135</span><br></pre></td></tr></table></figure>

<p>前端服务器主要配置stream和upstream，注意该模块需要在预编译时指 定，没有被默认编译进nginx </p>
<h4 id="5-3-1-配置前端服务器"><a href="#5-3-1-配置前端服务器" class="headerlink" title="5.3.1 配置前端服务器"></a>5.3.1 配置前端服务器</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 预编译：</span></span><br><span class="line">./configure --prefix=/usr/local/nginx --addmodule=../echo-nginx-module --with-http_stub_status_module --with-stream</span><br><span class="line"><span class="comment"># 编译/安装：</span></span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"><span class="comment"># 在main全局配置stream：</span></span><br><span class="line">events &#123;</span><br><span class="line">	worker_connections 1024;</span><br><span class="line">&#125;</span><br><span class="line">stream &#123;</span><br><span class="line">	upstream web &#123;</span><br><span class="line">		<span class="comment"># 必须要指定ip加port</span></span><br><span class="line">		server 192.168.75.128:80;</span><br><span class="line">		server 192.168.75.135:80;</span><br><span class="line">	&#125;</span><br><span class="line">	server &#123;</span><br><span class="line">		listen 80;</span><br><span class="line">		<span class="comment"># 连接上游服务器超时间，超过则选择另外一个服务器</span></span><br><span class="line">		proxy_connect_timeout 3s;</span><br><span class="line">		<span class="comment"># tcp连接闲置时间，超过则关闭</span></span><br><span class="line">		proxy_timeout 10s;</span><br><span class="line">		proxy_pass web;</span><br><span class="line">	&#125;</span><br><span class="line">	log_format proxy <span class="string">&#x27;$remote_addr $remote_port $protocol $status [$time_iso8601] &#x27;</span> <span class="string">&#x27;&quot;$upstream_addr&quot; &quot;$upstream_bytes_sent&quot; &quot;$upstream_connect_time&quot;&#x27;</span> ;</span><br><span class="line">	access_log /usr/local/nginx/logs/proxy.log proxy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-3-2-端口转发"><a href="#5-3-2-端口转发" class="headerlink" title="5.3.2  端口转发"></a>5.3.2  端口转发</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 前端130上配置如下：</span></span><br><span class="line">stream &#123;</span><br><span class="line">	upstream web &#123;</span><br><span class="line">		server 192.168.75.128:22;</span><br><span class="line">	&#125;</span><br><span class="line">	server &#123;</span><br><span class="line">		listen 2222;</span><br><span class="line">		proxy_connect_timeout 3s;</span><br><span class="line">		proxy_timeout 10s;</span><br><span class="line">		proxy_pass web;</span><br><span class="line">		<span class="comment">#proxy_set_header X-Real-IP $remote_addr;</span></span><br><span class="line">	&#125;</span><br><span class="line">	log_format proxy <span class="string">&#x27;$remote_addr $remote_port $protocol $status [$time_iso8601] &#x27;</span> <span class="string">&#x27;&quot;$upstream_addr&quot; &quot;$upstream_bytes_sent&quot; &quot;$upstream_connect_time&quot;&#x27;</span> ;</span><br><span class="line">	access_log /usr/local/nginx/logs/proxy.log proxy;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 在另外一台服务器ssh连接：</span></span><br><span class="line">[root@node5 ~]<span class="comment"># ssh 192.168.75.130 -p 2222</span></span><br><span class="line">root@192.168.75.130<span class="string">&#x27;s password:</span></span><br><span class="line"><span class="string">Last login: Wed Dec 18 15:50:37 2019 from 192.168.75.130</span></span><br><span class="line"><span class="string">[root@node2 ~]#</span></span><br><span class="line"><span class="string">[root@node2 ~]#</span></span><br><span class="line"><span class="string"># 可以看到，已经登录到了128服务器上。</span></span><br></pre></td></tr></table></figure>

<h3 id="5-4-后端服务器数据同步"><a href="#5-4-后端服务器数据同步" class="headerlink" title="5.4  后端服务器数据同步"></a>5.4  后端服务器数据同步</h3><h4 id="5-4-1-部署rsync"><a href="#5-4-1-部署rsync" class="headerlink" title="5.4.1 部署rsync"></a>5.4.1 部署rsync</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">yum install rsync -y</span><br><span class="line"><span class="comment"># 修改配置文件：</span></span><br><span class="line">vim /etc/rsyncd.conf</span><br><span class="line"><span class="comment"># /etc/rsyncd: configuration file for rsync daemon mode</span></span><br><span class="line"><span class="comment"># See rsyncd.conf man page for more options.</span></span><br><span class="line"><span class="comment"># rsync进程管理用户：</span></span><br><span class="line">uid = root</span><br><span class="line">gid = root</span><br><span class="line"><span class="comment"># rsync服务端口，默认是873，可以省略不写</span></span><br><span class="line">port = 873</span><br><span class="line"><span class="comment"># 安全设置，限制软连接，如果设置为no，则文件同步到远程服务器后，会在链接文件前面增加一个目录，使链接文件失效，设置为yes则表示不加目录。</span></span><br><span class="line">use <span class="built_in">chroot</span> = <span class="built_in">yes</span></span><br><span class="line"><span class="comment"># 最大链接数</span></span><br><span class="line">max connections = 100</span><br><span class="line"><span class="comment"># 进程pid文件</span></span><br><span class="line">pid file = /var/run/rsyncd.pid</span><br><span class="line"><span class="comment"># 排除指定目录</span></span><br><span class="line">exclude = lost+found/</span><br><span class="line"><span class="comment"># 开启日志，默认在系统日志中记录</span></span><br><span class="line">transfer logging = <span class="built_in">yes</span></span><br><span class="line"><span class="comment"># 超时时间</span></span><br><span class="line"><span class="built_in">timeout</span> = 900</span><br><span class="line"><span class="comment"># 忽略不可读的错误</span></span><br><span class="line">ignore nonreadable = <span class="built_in">yes</span></span><br><span class="line"><span class="comment"># 不压缩指定文件</span></span><br><span class="line">dont compress = *.gz *.tgz *.zip *.z *.Z *.rpm *.deb</span><br><span class="line">*.bz2</span><br><span class="line"><span class="comment"># 允许同步的服务器</span></span><br><span class="line">hosts allow = 192.168.75.124</span><br><span class="line"><span class="comment"># 不允许同步的服务器</span></span><br><span class="line">hosts deny = *</span><br><span class="line"><span class="comment"># 关闭只读权限（默认只能将本机文件同步至远程服务器，关闭后可以拉取远程</span></span><br><span class="line">服务器内容到本机）</span><br><span class="line"><span class="built_in">read</span> only = <span class="literal">false</span></span><br><span class="line"><span class="comment"># 模块</span></span><br><span class="line">[web]</span><br><span class="line">	<span class="comment"># 本机存放同步文件目录</span></span><br><span class="line">	path = /data/web</span><br><span class="line">	<span class="comment"># 注释目录作用</span></span><br><span class="line">	comment = nginx web data</span><br><span class="line">	<span class="comment"># 用于同步的用户（虚拟用户）</span></span><br><span class="line">	auth <span class="built_in">users</span> = rsync</span><br><span class="line">	<span class="comment"># 用户认证文件</span></span><br><span class="line">	secrets file = /etc/rsync.passwd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建目录：</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /data/web</span><br><span class="line"><span class="comment"># 创建认证文件：</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;rsync:123456&quot;</span> &gt; /etc/rsync.passwd</span><br><span class="line"><span class="comment"># 设置文件权限：</span></span><br><span class="line"><span class="built_in">chmod</span> 600 /etc/rsync.passwd</span><br><span class="line"><span class="comment"># 启动服务：</span></span><br><span class="line">systemctl start rsyncd</span><br></pre></td></tr></table></figure>

<h4 id="5-4-2-部署sersync"><a href="#5-4-2-部署sersync" class="headerlink" title="5.4.2 部署sersync"></a>5.4.2 部署sersync</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 解压包：</span></span><br><span class="line">tar xf sersync2.5.4_64bit_binary_stable_final.tar.gz</span><br><span class="line"><span class="comment"># 移到/usr/local/目录下：</span></span><br><span class="line"><span class="built_in">mv</span> GNU-Linux-x86/ /usr/local/sersync</span><br><span class="line"><span class="comment"># 备份配置文件：</span></span><br><span class="line">[root@node6 src]<span class="comment"># cd /usr/local/sersync/</span></span><br><span class="line">[root@node6 sersync]<span class="comment"># cp confxml.xml confxml.xml.ba</span></span><br></pre></td></tr></table></figure>

<h2 id="6、nginx-配置文件"><a href="#6、nginx-配置文件" class="headerlink" title="6、nginx 配置文件"></a>6、nginx 配置文件</h2><p><img src="/Nginx.assets/1608101373042.png" alt="1608101373042"></p>
<p>main（全局设置）、server（主机设置）、upstream（负载均衡服务器设置）和 location（URL匹配特定位置的设置）。</p>
<ul>
<li>main块设置的指令将影响其他所有设置；</li>
<li>server块的指令主要用于指定主机和端口；</li>
<li>upstream指令主要用于负载均衡，设置一系列的后端服务器；</li>
<li>location块用于匹配网页位置。</li>
</ul>
<p>server继承main，location继承server，upstream既不会继承其他设置也不会被继承 </p>
<h3 id="6-1-全局配置"><a href="#6-1-全局配置" class="headerlink" title="6.1 全局配置"></a>6.1 全局配置</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">user  www www;</span><br><span class="line">worker_processes auto;</span><br><span class="line">error_log  /www/wwwlogs/nginx_error.log  crit;</span><br><span class="line">pid        /www/server/nginx/logs/nginx.pid;</span><br><span class="line">worker_rlimit_nofile 51200;</span><br><span class="line"></span><br><span class="line">events</span><br><span class="line">    &#123;</span><br><span class="line">        use epoll;</span><br><span class="line">        worker_connections 51200;</span><br><span class="line">        multi_accept on;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>user是个主模块指令，指定Nginx Worker进程运行用户以及用户组，默认由nobody账号运行。</li>
<li>worker_processes是个主模块指令，指定了Nginx要开启的进程数。每个Nginx进程平均耗费10M~12M内存。建议指定和CPU的数量一致即可。</li>
<li>error_log是个主模块指令，用来定义全局错误日志文件。日志输出级别有debug、info、notice、warn、error、crit可供选择，其中，<strong>debug输出日志最为最详细，而crit输出日志最少</strong>。</li>
<li>pid是个主模块指令，用来指定进程pid的存储文件位置。</li>
<li>worker_rlimit_nofile用于绑定worker进程和CPU， Linux内核2.4以上可用。</li>
</ul>
<p> <strong>events事件指令</strong>是设定Nginx的工作模式及连接数上限 。</p>
<h3 id="6-2-HTTP服务器配置"><a href="#6-2-HTTP服务器配置" class="headerlink" title="6.2  HTTP服务器配置"></a>6.2  <strong>HTTP服务器配置</strong></h3><blockquote>
<p>参考 1.4  http指令块</p>
</blockquote>
<p><strong>log_format</strong></p>
<p>有很多可选的参数用于标示服务器的活动状态，默认的是：‘$remote_addr – $remote_user [$time_local] “$request” ‘ ‘$status $body_bytes_sent “$http_referer” ‘ ‘”$http_user_agent” “$http_x_forwarded_for”‘; </p>
<table>
<thead>
<tr>
<th><strong>参数</strong></th>
<th><strong>说明</strong></th>
<th><strong>示例</strong></th>
</tr>
</thead>
<tbody><tr>
<td>$remote_addr</td>
<td>客户端地址</td>
<td>219.227.111.255</td>
</tr>
<tr>
<td>$remote_user</td>
<td>客户端用户名称</td>
<td>—</td>
</tr>
<tr>
<td>$time_local</td>
<td>访问时间和时区</td>
<td>18&#x2F;Jul&#x2F;2014:17:00:01 +0800</td>
</tr>
<tr>
<td>$request</td>
<td>请求的URI和HTTP协议</td>
<td>“GET &#x2F;article-10000.html HTTP&#x2F;1.1”</td>
</tr>
<tr>
<td>$http_host</td>
<td>请求地址，即浏览器中你输入的地址（IP或域名）</td>
<td><a target="_blank" rel="noopener" href="http://www.ha97.com/">www.ha97.com</a> 198.98.120.87</td>
</tr>
<tr>
<td>$status</td>
<td>HTTP请求状态</td>
<td>200</td>
</tr>
<tr>
<td>$upstream_status</td>
<td>upstream状态</td>
<td>200</td>
</tr>
<tr>
<td>$body_bytes_sent</td>
<td>发送给客户端文件内容大小</td>
<td>1547</td>
</tr>
<tr>
<td>$http_referer</td>
<td>url跳转来源</td>
<td><a target="_blank" rel="noopener" href="http://www.ha97.com/tag/https">https</a>:&#x2F;&#x2F;www.<a target="_blank" rel="noopener" href="http://www.ha97.com/category/google">google</a>.com&#x2F;</td>
</tr>
<tr>
<td>$http_user_agent</td>
<td>用户终端浏览器等信息</td>
<td>“Mozilla&#x2F;4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident&#x2F;4.0; SV1; GTB7.0; .NET4.0C;</td>
</tr>
<tr>
<td>$ssl_protocol</td>
<td>SSL协议版本</td>
<td>TLSv1</td>
</tr>
<tr>
<td>$ssl_cipher</td>
<td>交换数据中的算法</td>
<td>RC4-SHA</td>
</tr>
<tr>
<td>$upstream_addr</td>
<td>后台upstream的地址，即真正提供服务的主机地址</td>
<td>10.36.10.80:80</td>
</tr>
<tr>
<td>$request_time</td>
<td>整个请求的总时间</td>
<td>0.165</td>
</tr>
<tr>
<td>$upstream_response_time</td>
<td>请求过程中，upstream响应时间</td>
<td>0.002</td>
</tr>
</tbody></table>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">server_names_hash_bucket_size 512;</span><br><span class="line">      client_header_buffer_size 32k;</span><br><span class="line">      large_client_header_buffers 4 32k;</span><br><span class="line">      client_max_body_size 50m;</span><br></pre></td></tr></table></figure>

<ul>
<li>client_max_body_size用来设置允许客户端请求的最大的单个文件字节数；</li>
<li>client_header_buffer_size用于指定来自客户端请求头的headerbuffer大小。对于大多数请求，1K的缓冲区大小已经足够，如果自定义了消息头或有更大的Cookie，可以增加缓冲区大小。这里设置为32K；</li>
<li>large_client_header_buffers用来指定客户端请求中较大的消息头的缓存最大数量和大小， “4”为个数，“128K”为大小，最大缓存量为4个128K；</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://anxiaoliao.github.io">Terry Ming</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://anxiaoliao.github.io/2022/09/21/Nginx/">https://anxiaoliao.github.io/2022/09/21/Nginx/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://anxiaoliao.github.io" target="_blank">Ming's Notes</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%AD%A6%E4%B9%A0/">学习</a></div><div class="post_share"><div class="social-share" data-image="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/09/21/%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BALNMP%E7%8E%AF%E5%A2%83/"><img class="prev-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">快速搭建LNMP环境</div></div></a></div><div class="next-post pull-right"><a href="/2022/08/31/Git%E6%8F%90%E4%BA%A4%E4%B8%89%E9%83%A8%E6%9B%B2/"><img class="next-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Git提交三部曲</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/08/31/Git%E6%8F%90%E4%BA%A4%E4%B8%89%E9%83%A8%E6%9B%B2/" title="Git提交三部曲"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-31</div><div class="title">Git提交三部曲</div></div></a></div><div><a href="/2022/09/21/Python%20%E7%88%AC%E8%99%AB/" title="Python 爬虫"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-21</div><div class="title">Python 爬虫</div></div></a></div><div><a href="/2022/09/21/%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BALNMP%E7%8E%AF%E5%A2%83/" title="快速搭建LNMP环境"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-21</div><div class="title">快速搭建LNMP环境</div></div></a></div><div><a href="/2022/09/21/Docker/" title="Docker"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-21</div><div class="title">Docker</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.imgtg.com/2022/08/11/AsLOl.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Terry Ming</div><div class="author-info__description">人到无求品自高</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">7</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">1</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Nginx"><span class="toc-number">1.</span> <span class="toc-text">Nginx</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81Nginx%E5%9F%BA%E7%A1%80"><span class="toc-number">1.1.</span> <span class="toc-text">1、Nginx基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-yum%E5%AE%89%E8%A3%85"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1 yum安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E6%BA%90%E7%A0%81%E5%AE%89%E8%A3%85%EF%BC%9A"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.2  源码安装：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.1.3.</span> <span class="toc-text">1.3 常用命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-http%E6%8C%87%E4%BB%A4%E5%9D%97"><span class="toc-number">1.1.4.</span> <span class="toc-text">1.4  http指令块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-1-gzip"><span class="toc-number">1.1.4.1.</span> <span class="toc-text">1.4.1 gzip</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-2-autoindex"><span class="toc-number">1.1.4.2.</span> <span class="toc-text">1.4.2 autoindex</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-3-upstream"><span class="toc-number">1.1.4.3.</span> <span class="toc-text">1.4.3 upstream</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-server%E6%8C%87%E4%BB%A4%E5%9D%97%EF%BC%9A"><span class="toc-number">1.1.5.</span> <span class="toc-text">1.5 server指令块：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-location%E6%8C%87%E4%BB%A4%E5%9D%97%EF%BC%9A"><span class="toc-number">1.1.6.</span> <span class="toc-text">1.6 location指令块：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-7-%E7%83%AD%E9%83%A8%E7%BD%B2"><span class="toc-number">1.1.7.</span> <span class="toc-text">1.7 热部署</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-8-rewrite"><span class="toc-number">1.1.8.</span> <span class="toc-text">1.8  rewrite</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-8-1-%E5%AE%9E%E7%8E%B0%E5%9F%9F%E5%90%8D%E8%B7%B3%E8%BD%AC"><span class="toc-number">1.1.8.1.</span> <span class="toc-text">1.8.1  实现域名跳转</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-8-2-%E5%AE%9E%E7%8E%B0%E4%B8%8D%E5%90%8C%E7%BB%88%E7%AB%AF%E8%B7%B3%E8%BD%AC"><span class="toc-number">1.1.8.2.</span> <span class="toc-text">1.8.2 实现不同终端跳转</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-8-3-%E5%AE%9E%E7%8E%B0%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9A%84%E8%AF%AD%E8%A8%80%E8%B7%B3%E8%BD%AC"><span class="toc-number">1.1.8.3.</span> <span class="toc-text">1.8.3 实现浏览器的语言跳转</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81-%E5%B8%B8%E7%94%A8%E6%A8%A1%E5%9D%97"><span class="toc-number">1.2.</span> <span class="toc-text">2、 常用模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-access%E6%A8%A1%E5%9D%97"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1 access模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-auth-basic%E6%A8%A1%E5%9D%97"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2  auth_basic模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-stub-status-%E6%A8%A1%E5%9D%97"><span class="toc-number">1.2.3.</span> <span class="toc-text">2.3 stub_status 模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-referer-%E6%A8%A1%E5%9D%97"><span class="toc-number">1.2.4.</span> <span class="toc-text">2.4 referer 模块</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA"><span class="toc-number">1.3.</span> <span class="toc-text">3、虚拟主机</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%A4%9A%E5%9F%9F%E5%90%8D%E6%96%B9%E5%BC%8F"><span class="toc-number">1.3.1.</span> <span class="toc-text">3.1 多域名方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E5%A4%9A%E7%AB%AF%E5%8F%A3%E6%96%B9%E5%BC%8F"><span class="toc-number">1.3.2.</span> <span class="toc-text">3.2  多端口方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E5%A4%9AIP%E6%96%B9%E5%BC%8F"><span class="toc-number">1.3.3.</span> <span class="toc-text">3.3 多IP方式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"><span class="toc-number">1.4.</span> <span class="toc-text">4、反向代理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E4%BD%9C%E7%94%A8"><span class="toc-number">1.4.1.</span> <span class="toc-text">4.1 反向代理作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E8%8E%B7%E5%8F%96%E8%BF%9C%E7%A8%8B%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9C%9F%E5%AE%9Eip%E5%9C%B0%E5%9D%80"><span class="toc-number">1.4.2.</span> <span class="toc-text">4.2  获取远程客户端真实ip地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E7%BC%93%E5%AD%98%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">1.4.3.</span> <span class="toc-text">4.3  缓存代理服务器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-number">1.5.</span> <span class="toc-text">5、负载均衡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">1.5.1.</span> <span class="toc-text">5.1  工作原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E9%85%8D%E7%BD%AE%E4%B8%83%E5%B1%82%E5%9D%87%E8%A1%A1"><span class="toc-number">1.5.2.</span> <span class="toc-text">5.2  配置七层均衡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-1-%E6%9C%80%E5%A4%A7%E9%94%99%E8%AF%AF%E8%BF%9E%E6%8E%A5%E6%AC%A1%E6%95%B0"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">5.2.1 最大错误连接次数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-2-ip-hash"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">5.2.2 ip_hash</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-3-url-hash"><span class="toc-number">1.5.2.3.</span> <span class="toc-text">5.2.3 url_hash</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-4-%E6%A0%B9%E6%8D%AE%E5%93%8D%E5%BA%94%E6%97%B6%E9%97%B4%E5%9D%87%E8%A1%A1"><span class="toc-number">1.5.2.4.</span> <span class="toc-text">5.2.4 根据响应时间均衡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-5-%E5%A4%87%E7%94%A8%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">1.5.2.5.</span> <span class="toc-text">5.2.5 备用服务器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E9%85%8D%E7%BD%AE%E5%9B%9B%E5%B1%82%E5%9D%87%E8%A1%A1"><span class="toc-number">1.5.3.</span> <span class="toc-text">5.3 配置四层均衡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-1-%E9%85%8D%E7%BD%AE%E5%89%8D%E7%AB%AF%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">1.5.3.1.</span> <span class="toc-text">5.3.1 配置前端服务器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-2-%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91"><span class="toc-number">1.5.3.2.</span> <span class="toc-text">5.3.2  端口转发</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-%E5%90%8E%E7%AB%AF%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5"><span class="toc-number">1.5.4.</span> <span class="toc-text">5.4  后端服务器数据同步</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-1-%E9%83%A8%E7%BD%B2rsync"><span class="toc-number">1.5.4.1.</span> <span class="toc-text">5.4.1 部署rsync</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-2-%E9%83%A8%E7%BD%B2sersync"><span class="toc-number">1.5.4.2.</span> <span class="toc-text">5.4.2 部署sersync</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81nginx-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.6.</span> <span class="toc-text">6、nginx 配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE"><span class="toc-number">1.6.1.</span> <span class="toc-text">6.1 全局配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-HTTP%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">1.6.2.</span> <span class="toc-text">6.2  HTTP服务器配置</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/09/21/Docker/" title="Docker"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Docker"/></a><div class="content"><a class="title" href="/2022/09/21/Docker/" title="Docker">Docker</a><time datetime="2022-09-21T15:35:40.000Z" title="发表于 2022-09-21 23:35:40">2022-09-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/09/21/Python%20%E7%88%AC%E8%99%AB/" title="Python 爬虫"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Python 爬虫"/></a><div class="content"><a class="title" href="/2022/09/21/Python%20%E7%88%AC%E8%99%AB/" title="Python 爬虫">Python 爬虫</a><time datetime="2022-09-21T09:35:40.000Z" title="发表于 2022-09-21 17:35:40">2022-09-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/09/21/%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BALNMP%E7%8E%AF%E5%A2%83/" title="快速搭建LNMP环境"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="快速搭建LNMP环境"/></a><div class="content"><a class="title" href="/2022/09/21/%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BALNMP%E7%8E%AF%E5%A2%83/" title="快速搭建LNMP环境">快速搭建LNMP环境</a><time datetime="2022-09-21T09:35:40.000Z" title="发表于 2022-09-21 17:35:40">2022-09-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/09/21/Nginx/" title="Nginx"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Nginx"/></a><div class="content"><a class="title" href="/2022/09/21/Nginx/" title="Nginx">Nginx</a><time datetime="2022-09-21T09:35:40.000Z" title="发表于 2022-09-21 17:35:40">2022-09-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/08/31/Git%E6%8F%90%E4%BA%A4%E4%B8%89%E9%83%A8%E6%9B%B2/" title="Git提交三部曲"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Git提交三部曲"/></a><div class="content"><a class="title" href="/2022/08/31/Git%E6%8F%90%E4%BA%A4%E4%B8%89%E9%83%A8%E6%9B%B2/" title="Git提交三部曲">Git提交三部曲</a><time datetime="2022-08-31T02:53:46.000Z" title="发表于 2022-08-31 10:53:46">2022-08-31</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Terry Ming</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"></div><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>