<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Docker | Ming's Notes</title><meta name="keywords" content="学习"><meta name="author" content="Terry Ming"><meta name="copyright" content="Terry Ming"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Dockerdocker的主要目标是”Build,Ship and Run any App,Angwhere”,构建，运输，处处运行 构建：做一个docker镜像 运输：docker pull 运行：启动一个容器 每一个容器，他都有自己的文件系统rootfs. Docker 技术使用 Linux 内核和内核功能（例如 Cgroups 和 namespaces）来分隔进程，以便各进程相互独立运行">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker">
<meta property="og:url" content="https://anxiaoliao.github.io/2022/09/21/Docker/index.html">
<meta property="og:site_name" content="Ming&#39;s Notes">
<meta property="og:description" content="Dockerdocker的主要目标是”Build,Ship and Run any App,Angwhere”,构建，运输，处处运行 构建：做一个docker镜像 运输：docker pull 运行：启动一个容器 每一个容器，他都有自己的文件系统rootfs. Docker 技术使用 Linux 内核和内核功能（例如 Cgroups 和 namespaces）来分隔进程，以便各进程相互独立运行">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg">
<meta property="article:published_time" content="2022-09-21T15:35:40.000Z">
<meta property="article:modified_time" content="2022-09-21T15:16:32.670Z">
<meta property="article:author" content="Terry Ming">
<meta property="article:tag" content="学习">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://anxiaoliao.github.io/2022/09/21/Docker/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Docker',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-09-21 23:16:32'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.2.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.imgtg.com/2022/08/11/AsLOl.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">7</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">1</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 留言板</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Ming's Notes</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 留言板</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Docker</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-09-21T15:35:40.000Z" title="发表于 2022-09-21 23:35:40">2022-09-21</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-09-21T15:16:32.670Z" title="更新于 2022-09-21 23:16:32">2022-09-21</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Docker"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><p>docker的主要目标是”Build,Ship and Run any App,Angwhere”,构建，运输，处处运行</p>
<p><strong>构建</strong>：做一个docker镜像</p>
<p><strong>运输</strong>：docker pull</p>
<p><strong>运行</strong>：启动一个容器</p>
<p>每一个容器，他都有自己的文件系统rootfs.</p>
<p>Docker 技术使用 Linux 内核和内核功能（例如 <em>Cgroups</em> <em>和 namespaces</em>）来分隔进程，以便各进程相互独立运行 </p>
<h2 id="1、Docker安装"><a href="#1、Docker安装" class="headerlink" title="1、Docker安装"></a>1、Docker安装</h2><h3 id="1-1-Docker的基本组成"><a href="#1-1-Docker的基本组成" class="headerlink" title="1.1 Docker的基本组成"></a>1.1 Docker的基本组成</h3><p><strong>镜像（image）：</strong><br>docker镜像就好比是一个模板，可以通过这个模板来创建容器服务，tomcat&#x3D;&#x3D;&#x3D;&gt;run&#x3D;&#x3D;&#x3D;&gt;tomcat01容器（提供服务），<br>通过这个镜像可以创建多个容器（最终服务运行或者项目运行就是在容器中的）。</p>
<p><strong>容器（container）：</strong></p>
<p>docker利用容器技术，独立运行一个或者一个组应用，通过镜像来创建的。</p>
<p>启动、停止、删除，基本命令。</p>
<p>目前就可以把这个容器理解为一个简易的linux系统</p>
<p><strong>仓库（repository &#x2F;rɪˈpɒzətri&#x2F;）：</strong></p>
<p>仓库就是存放镜像的地方，分为公有仓库和私有仓库。</p>
<h3 id="1-2-安装Docker"><a href="#1-2-安装Docker" class="headerlink" title="1.2 安装Docker"></a>1.2 安装Docker</h3><blockquote>
<p>环境准备</p>
</blockquote>
<p>Centos7</p>
<p>SecureCRT 8.1</p>
<blockquote>
<p>查看环境</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">系统内核</span></span><br><span class="line">[root@hchost ~]# uname -r</span><br><span class="line">3.10.0-957.21.3.el7.x86_64</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">系统版本</span></span><br><span class="line">[root@hchost ~]# cat /etc/os-release </span><br><span class="line">NAME=&quot;CentOS Linux&quot;</span><br><span class="line">VERSION=&quot;7 (Core)&quot;</span><br><span class="line">ID=&quot;centos&quot;</span><br><span class="line">ID_LIKE=&quot;rhel fedora&quot;</span><br><span class="line">VERSION_ID=&quot;7&quot;</span><br><span class="line">PRETTY_NAME=&quot;CentOS Linux 7 (Core)&quot;</span><br><span class="line">ANSI_COLOR=&quot;0;31&quot;</span><br><span class="line">CPE_NAME=&quot;cpe:/o:centos:centos:7&quot;</span><br><span class="line">HOME_URL=&quot;https://www.centos.org/&quot;</span><br><span class="line">BUG_REPORT_URL=&quot;https://bugs.centos.org/&quot;</span><br><span class="line"></span><br><span class="line">CENTOS_MANTISBT_PROJECT=&quot;CentOS-7&quot;</span><br><span class="line">CENTOS_MANTISBT_PROJECT_VERSION=&quot;7&quot;</span><br><span class="line">REDHAT_SUPPORT_PRODUCT=&quot;centos&quot;</span><br><span class="line">REDHAT_SUPPORT_PRODUCT_VERSION=&quot;7&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>安装</p>
</blockquote>
<p>帮助文档</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、卸载旧版本docker</span></span><br><span class="line"> yum remove docker \</span><br><span class="line">            docker-client \</span><br><span class="line">            docker-client-latest \</span><br><span class="line">            docker-common \</span><br><span class="line">            docker-latest \</span><br><span class="line">            docker-latest-logrotate \</span><br><span class="line">            docker-logrotate \</span><br><span class="line">            docker-engine</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、安装Docker的依赖库</span></span><br><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、设置镜像仓库</span></span><br><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo <span class="comment"># 国外的</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 国内阿里的    </span></span><br><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"><span class="comment"># 国内腾讯的</span></span><br><span class="line">yum-config-manager --add-repo https://mirrors.cloud.tencent.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新软件包索引  生成缓存</span></span><br><span class="line">yum makecache fast</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4、安装docker相关内容  docker-ce 社区  ee 企业版</span></span><br><span class="line">yum install docker-ce docker-ce-cli containerd.io</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5、启动docke</span></span><br><span class="line">systemctl start docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6、查看docker是否安装成功</span></span><br><span class="line">docker version</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7、测试hello-world</span></span><br><span class="line">docker run hello-world</span><br><span class="line"></span><br><span class="line"><span class="comment"># 8、查看下载的镜像image</span></span><br><span class="line">docker images</span><br><span class="line"></span><br><span class="line"><span class="comment"># 卸载docker</span></span><br><span class="line">sudo yum remove docker-ce docker-ce-cli containerd.io</span><br><span class="line">sudo <span class="built_in">rm</span> -rf /var/lib/docker</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="1-3-启动Docker服务"><a href="#1-3-启动Docker服务" class="headerlink" title="1.3  启动Docker服务"></a>1.3  启动Docker服务</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">启动服务命令：		systemctl start docker</span><br><span class="line"></span><br><span class="line">停止服务命令：		systemctl stop docker</span><br><span class="line"></span><br><span class="line">检查运行状态命令：  systemctl status docker</span><br><span class="line"></span><br><span class="line">重启服务命令：		 systemctl restart docker</span><br><span class="line"></span><br><span class="line">开机启动命令：		 systemctl <span class="built_in">enable</span> docker</span><br><span class="line"></span><br><span class="line">开机不启动命令：	systemctl <span class="built_in">disable</span> docker</span><br><span class="line"></span><br><span class="line">检查开机状态命令：	systemctl is-enabled docker</span><br></pre></td></tr></table></figure>



<h3 id="1-4-镜像加速"><a href="#1-4-镜像加速" class="headerlink" title="1.4 镜像加速"></a>1.4 镜像加速</h3><ul>
<li>配置Docker的自定义镜像仓库地址 <a target="_blank" rel="noopener" href="https://cr.console.aliyun.com/cn-shanghai/instances/mirrors">https://cr.console.aliyun.com/cn-shanghai/instances/mirrors</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /etc/docker</span><br><span class="line"><span class="built_in">tee</span> /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://a5dwl7z9.mirror.aliyuncs.com&quot;</span>,<span class="string">&quot;https://mirror.ccs.tencentyun.com&quot;</span>,<span class="string">&quot;https://0bb905ba3400f35a0f83c01a53c2aec0.mirror.swr.myhuaweicloud.com&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">service docker restart</span><br><span class="line">docker info</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p /etc/docker</span><br><span class="line"><span class="built_in">tee</span> /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://a5dwl7z9.mirror.aliyuncs.com&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># 腾讯的</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /etc/docker</span><br><span class="line"><span class="built_in">tee</span> /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://mirror.ccs.tencentyun.com&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">service docker restart</span><br><span class="line">docker info</span><br><span class="line"></span><br><span class="line"><span class="comment"># 华为云</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /etc/docker</span><br><span class="line"><span class="built_in">tee</span> /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://0bb905ba3400f35a0f83c01a53c2aec0.mirror.swr.myhuaweicloud.com&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">service docker restart</span><br><span class="line">docker info</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 国内镜像源加速站点</span></span><br><span class="line"></span><br><span class="line">https://registry.docker-cn.com</span><br><span class="line"></span><br><span class="line">http://hub-mirror.c.163.com</span><br><span class="line"></span><br><span class="line">https://3laho3y3.mirror.aliyuncs.com</span><br><span class="line"></span><br><span class="line">http://f1361db2.m.daocloud.io</span><br><span class="line"></span><br><span class="line">https://mirror.ccs.tencentyun.com</span><br></pre></td></tr></table></figure>

<ul>
<li>重新加载服务配置文件。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br></pre></td></tr></table></figure>

<ul>
<li>重启Docker服务。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>

<h3 id="1-5-底层原理"><a href="#1-5-底层原理" class="headerlink" title="1.5 底层原理"></a>1.5 底层原理</h3><p><strong>Docker是怎么工作的？</strong></p>
<p>Docker是一个Client - Server 结构的系统，Docker的守护进程运行在主机上。通过Socket从客户端访问！DockerServer 接收到Docker-Client的指令，就会执行命令。</p>
<p><img src="/Docker.assets/1609148470793.png" alt="1609148470793"></p>
<h2 id="2、Docker的常用命令"><a href="#2、Docker的常用命令" class="headerlink" title="2、Docker的常用命令"></a>2、Docker的常用命令</h2><ul>
<li>Docker环境信息 — <code>docker [info|version]</code></li>
<li>容器生命周期管理 — <code>docker [create|exec|run|start|stop|restart|kill|rm|pause|unpause]</code></li>
<li>容器操作运维 — <code>docker [ps|inspect|top|attach|wait|export|port|rename|stat]</code></li>
<li>容器rootfs命令 — <code>docker [commit|cp|diff]</code></li>
<li>镜像仓库 — <code>docker [login|pull|push|search]</code></li>
<li>本地镜像管理 — <code>docker [build|images|rmi|tag|save|import|load]</code></li>
<li>容器资源管理 — <code>docker [volume|network]</code></li>
<li>系统日志信息 — <code>docker [events|history|logs]</code></li>
</ul>
<h3 id="2-1-帮助命令"><a href="#2-1-帮助命令" class="headerlink" title="2.1 帮助命令"></a>2.1 帮助命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker version		# 显示docker的版本信息</span><br><span class="line">docker info			# 显示docker的系统信息 显示镜像和容器</span><br><span class="line">docker 命令 --help   # 帮助命令</span><br></pre></td></tr></table></figure>

<p>帮助文档： <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/">https://docs.docker.com/engine/reference/commandline/</a> </p>
<h3 id="2-2-镜像命令"><a href="#2-2-镜像命令" class="headerlink" title="2.2 镜像命令"></a>2.2 镜像命令</h3><blockquote>
<p><strong>docker images</strong>		查看本地所有镜像</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@hchost ~]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">hello-world         latest              bf756fb1ae65        6 months ago        13.3kB</span><br><span class="line"></span><br><span class="line">REPOSITORY		# 镜像的仓库源</span><br><span class="line">TAG				# 镜像的标签</span><br><span class="line">IMAGE ID		# 镜像的ID</span><br><span class="line"></span><br><span class="line">Usage:  docker images [OPTIONS] [REPOSITORY[:TAG]]</span><br><span class="line">Options:</span><br><span class="line">  -a, --all             Show all images (default hides intermediate images)</span><br><span class="line">  -q, --quiet           Only show numeric IDs</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>docker search</strong>		搜索镜像</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">docker search [OPTIONS] TERM</span><br><span class="line"></span><br><span class="line">--automated :只列出 automated build类型的镜像；</span><br><span class="line"></span><br><span class="line">--no-trunc :显示完整的镜像描述；</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">搜索收藏大于3000以上的信息</span></span><br><span class="line">[root@hchost ~]# docker search mysql --filter=STARS=3000</span><br><span class="line">NAME                DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED</span><br><span class="line">mysql               MySQL is a widely used, open-source relation…   9755                [OK]                </span><br><span class="line">mariadb             MariaDB is a community-developed fork of MyS…   3562                [OK]   </span><br><span class="line">[root@hchost local]# docker search -f STARS=130 nginx</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><strong>参数</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>NAME</strong></td>
<td>镜像名称</td>
</tr>
<tr>
<td><strong>DESCRIPTION</strong></td>
<td>镜像说明</td>
</tr>
<tr>
<td><strong>STARS</strong></td>
<td>点赞数量</td>
</tr>
<tr>
<td><strong>OFFICIAL</strong></td>
<td>是否是官方的</td>
</tr>
<tr>
<td><strong>AUTOMATED</strong></td>
<td>是否是自动构建的</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>docker pull</strong>		下载镜像</p>
</blockquote>
<ul>
<li><p><input disabled="" type="checkbox"> 
&#96;&#96;&#96;shell</p>
<h1 id="docker-pull-镜像名-tag"><a href="#docker-pull-镜像名-tag" class="headerlink" title="docker pull 镜像名[:tag]"></a>docker pull 镜像名[:tag]</h1><p>[root@hchost ~]# docker pull mysql<br>Using default tag: latest			# tag: latest 默认是下载最新版<br>latest: Pulling from library&#x2F;mysql<br>8559a31e96f4: Pull complete 		# 分层下载 docker images的核心 联合文件系统<br>d51ce1c2e575: Pull complete<br>c2344adc4858: Pull complete<br>fcf3ceff18fc: Pull complete<br>16da0c38dc5b: Pull complete<br>b905d1797e97: Pull complete<br>4b50d1c6b05c: Pull complete<br>571e8a282156: Pull complete<br>e7cc823c6090: Pull complete<br>89f6364a8689: Pull complete<br>55e5b10f33a4: Pull complete<br>68129e7a0316: Pull complete<br>Digest: sha256:c455bbcaa8b9c5c636c45f6184f970caeb3d8b545a0390e1b72a253e07aef8fd	# 签名<br>Status: Downloaded newer image for mysql:latest<br>docker.io&#x2F;library&#x2F;mysql:latest		# 真实地址</p>
<h1 id="等价于"><a href="#等价于" class="headerlink" title="等价于"></a>等价于</h1><p>[root@hchost ~]# docker pull mysql<br>[root@hchost ~]# docker pull docker.io&#x2F;library&#x2F;mysql:latest	</p>
<h1 id="指定版本下载"><a href="#指定版本下载" class="headerlink" title="指定版本下载"></a>指定版本下载</h1><p>[root@hchost ~]# docker pull mysql:5.7<br>5.7: Pulling from library&#x2F;mysql<br>8559a31e96f4: Already exists 		#linux核心，联合文件系统共用之前的镜像，不用重复下载<br>d51ce1c2e575: Already exists </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt; **docker rmi**  删除镜像</span><br><span class="line"></span><br><span class="line">```shell</span><br><span class="line"># 指定镜像ID删除，-f强制删除</span><br><span class="line">[root@hchost ~]# docker rmi -f 5ac22cccc3ae</span><br><span class="line"></span><br><span class="line"># 删除所有镜像</span><br><span class="line">[root@hchost ~]# docker rmi -f $(docker images -aq)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p>导入导出镜像</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导出  centos是REPOSITORY</span></span><br><span class="line">[root@hchost ~]<span class="comment"># docker image save centos &gt; docker-centos.tar.gz</span></span><br><span class="line"><span class="comment"># 导入</span></span><br><span class="line">[root@hchost ~]<span class="comment"># docker image load -i docker-centos.tar.gz  </span></span><br><span class="line"></span><br><span class="line">docker save &lt;myimage&gt;:&lt;tag&gt; | gzip &gt; &lt;myimage&gt;_&lt;tag&gt;.tar.gz</span><br><span class="line"></span><br><span class="line">gunzip -c &lt;myimage&gt;_&lt;tag&gt;.tar.gz | docker load</span><br></pre></td></tr></table></figure>

<blockquote>
<p>查看镜像详细信息</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@hchost <span class="built_in">local</span>]<span class="comment"># docker image inspect 509ff2fb81dd</span></span><br></pre></td></tr></table></figure>



<h3 id="2-3-容器命令"><a href="#2-3-容器命令" class="headerlink" title="2.3 容器命令"></a>2.3 容器命令</h3><p>说明：有了镜像才可以创建容器</p>
<p><strong>新建容器并启动</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">docker run [可选参数] image</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">参数说明</span></span><br><span class="line">--name=&quot;Name&quot;		容器名字 tomcat 用来区分容器</span><br><span class="line">-d					后台方式运行</span><br><span class="line">-it					使用交互式方式运行，进入容器查看内容</span><br><span class="line">-p					指定容器的端口 如:-p 8080:8080</span><br><span class="line">		-p ip:主机端口:容器端口</span><br><span class="line">		-p 主机端口:容器端口  (常用)</span><br><span class="line">		-p 容器端口</span><br><span class="line">		容器端口</span><br><span class="line">-P					随机指定端口</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试 启动并进入容器</span></span><br><span class="line">[root@hchost ~]# docker run -it centos /bin/bash</span><br><span class="line">[root@87b5af922b79 /]# </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">从容器退出主机</span></span><br><span class="line">[root@87b5af922b79 /]# exit</span><br><span class="line">exit</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">后台运行，不进交互</span></span><br><span class="line">[root@hchost ~]# docker run -itd centos /bin/bash</span><br></pre></td></tr></table></figure>

<p><strong>列出所有运行中的容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker ps 命令</span></span><br><span class="line">		列出当前正在运行的容器</span><br><span class="line">-a		列出当前正在运行的容器+顺带出历史运行过的容器</span><br><span class="line">-n=?	显示最近创建的容器</span><br><span class="line">-q		显示容器编号</span><br><span class="line"></span><br><span class="line">[root@hchost ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">[root@hchost ~]# docker ps -a</span><br><span class="line"></span><br><span class="line">[root@hchost ~]# docker ps -a -n=1</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                     PORTS               NAMES</span><br><span class="line">87b5af922b79        centos              &quot;/bin/bash&quot;         9 minutes ago       Exited (0) 7 minutes ago                       quirky_sanderson</span><br><span class="line">[root@hchost ~]# docker ps -aq</span><br><span class="line">87b5af922b79</span><br><span class="line">163f9e63c8c8</span><br></pre></td></tr></table></figure>

<p><strong>容器退出</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">exit		# 容器停止并退出</span><br><span class="line">Ctrl+p+q	# 容器不停止退出</span><br><span class="line"></span><br><span class="line">[root@hchost ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">[root@hchost ~]# docker run -it centos /bin/bash</span><br><span class="line">[root@e28a3bb96b93 /]#       # 这个地方操作了Ctrl+p+q，退回到主机，查看发现容器还在运行</span><br><span class="line">[root@hchost ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">e28a3bb96b93        centos              &quot;/bin/bash&quot;         22 seconds ago      Up 21 seconds                           loving_haslett</span><br></pre></td></tr></table></figure>

<p><strong>删除容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker rm 容器ID					   # 删除指定容器，不能删除正在运行的容器</span><br><span class="line">docker rm -f $(docker ps -aq)		# 删除所有容器</span><br><span class="line">docker ps -a -q|xargs docker rm 	# 删除所有容器</span><br><span class="line"></span><br><span class="line">[root@hchost ~]# docker rm 87b5af922b79</span><br><span class="line">87b5af922b79</span><br><span class="line">[root@hchost ~]# docker rm -f $(docker ps -aq)</span><br><span class="line">e28a3bb96b93</span><br><span class="line">54fad9a1d452</span><br><span class="line">163f9e63c8c8</span><br></pre></td></tr></table></figure>

<p>启动和停止容器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker start 容器ID</span><br><span class="line">docker restart 容器ID</span><br><span class="line">docker stop  容器ID</span><br><span class="line">docker kill 容器ID</span><br></pre></td></tr></table></figure>

<h3 id="2-4-常用的其他命令"><a href="#2-4-常用的其他命令" class="headerlink" title="2.4 常用的其他命令"></a>2.4 常用的其他命令</h3><h4 id="2-4-1-后台启动容器"><a href="#2-4-1-后台启动容器" class="headerlink" title="2.4.1 后台启动容器"></a>2.4.1 <strong>后台启动容器</strong></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@hchost ~]# docker run -d centos</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">问题 docker ps 发现centos停止了</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">常见的坑，docker容器使用后台运行，就必须要有一个前台进程，docker发现没有应用，就会自动停止</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Nginx 容器启动后，发现自己没有提供服务，就会立刻停止，就是没有程序了</span></span><br></pre></td></tr></table></figure>

<h4 id="2-4-2-查看日志"><a href="#2-4-2-查看日志" class="headerlink" title="2.4.2 查看日志"></a><strong>2.4.2 查看日志</strong></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示日志最新的10行</span></span><br><span class="line">[root@hchost ~]# docker logs -t -f --tail 10 cc158905e404</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">shell脚本模拟写日志信息</span></span><br><span class="line">[root@hchost ~]# docker run -d centos /bin/bash -c &quot;while true;do echo hc;sleep 1;done&quot;</span><br></pre></td></tr></table></figure>

<h4 id="2-4-3-查看容器中进程信息-ps"><a href="#2-4-3-查看容器中进程信息-ps" class="headerlink" title="2.4.3 查看容器中进程信息  ps"></a><strong>2.4.3 查看容器中进程信息</strong>  ps</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">命令 docker top 容器ID</span></span><br><span class="line">[root@hchost ~]# docker top ee00c0e571a5</span><br><span class="line">UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD</span><br><span class="line">root                19070               19054               0                   16:08               pts/0               00:00:00            /bin/bash</span><br></pre></td></tr></table></figure>

<h4 id="2-4-4-查看镜像的元数据"><a href="#2-4-4-查看镜像的元数据" class="headerlink" title="2.4.4 查看镜像的元数据"></a><strong>2.4.4 查看镜像的元数据</strong></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker inspect 容器ID</span></span><br><span class="line">[root@hchost ~]# docker inspect ee00c0e571a5</span><br></pre></td></tr></table></figure>

<p><img src="/Docker.assets%5C1595494235801.png"></p>
<h4 id="2-4-5-进入当前正在运行的容器"><a href="#2-4-5-进入当前正在运行的容器" class="headerlink" title="2.4.5 进入当前正在运行的容器"></a><strong>2.4.5 进入当前正在运行的容器</strong></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">通常容器都是使用后台方式进行的，需要进入容器，修改一些配置</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">命令1</span></span><br><span class="line">docker exec -it 容器id /bin/bash</span><br><span class="line">[root@hchost ~]# docker exec -it ee00c0e571a5 /bin/bash</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">exit</span>退出后，容器还在运行</span></span><br><span class="line">[root@ee00c0e571a5 /]# exit</span><br><span class="line">exit</span><br><span class="line">[root@hchost ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">ee00c0e571a5        centos              &quot;/bin/bash&quot;         About an hour ago   Up About an hour                        crazy_pasteur</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">命令2</span></span><br><span class="line">docker attach 容器id</span><br><span class="line">[root@hchost ~]# docker attach $(docker ps -q)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">exit</span>退出后，容器退出结束</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker <span class="built_in">exec</span>		进入容器后开启一个新的终端，可以在里面操作（常用）</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker attach     进入容器正在执行的终端，不会启动新的进程</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="2-4-6-从容器内拷贝文件到主机上"><a href="#2-4-6-从容器内拷贝文件到主机上" class="headerlink" title="2.4.6 从容器内拷贝文件到主机上"></a><strong>2.4.6 从容器内拷贝文件到主机上</strong></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker cp 容器id:容器内路径	目的的主机路径</span><br><span class="line">[root@hchost ~]# docker cp 28ba1b1dbd31:/home/123.log /hc</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">即使容器没有运行，是停止的，也可以拷贝</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">未来使用 -v 卷的技术，可以实现自动拷贝</span></span><br></pre></td></tr></table></figure>

<h4 id="2-4-7-提高权限"><a href="#2-4-7-提高权限" class="headerlink" title="2.4.7 提高权限"></a>2.4.7 提高权限</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name hc_centos -p 8023:80 -v /data/:/data/ --privileged=<span class="literal">true</span> hc_centos:7.9 /usr/sbin/init</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="2-4-8-查询容器IP"><a href="#2-4-8-查询容器IP" class="headerlink" title="2.4.8 查询容器IP"></a>2.4.8 查询容器IP</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@hchost ~]<span class="comment"># docker inspect c873644486fc|grep -ai ipaddr|tail -1|grep -oE &quot;([0-9]&#123;1,3&#125;\.)&#123;3&#125;[0-9]&#123;1,3&#125;&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="2-4-8-查询指定配置信息"><a href="#2-4-8-查询指定配置信息" class="headerlink" title="2.4.8 查询指定配置信息"></a>2.4.8 查询指定配置信息</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -i 不区分大小写   -A 指定显示行数</span></span><br><span class="line">[root@hchost _data]<span class="comment"># docker inspect c873644486fc3c5|grep -ai mounts -A 10</span></span><br></pre></td></tr></table></figure>



<p><img src="/Docker.assets%5C1595562555728.png"></p>
<h3 id="2-5-Docker命令集"><a href="#2-5-Docker命令集" class="headerlink" title="2.5 Docker命令集"></a>2.5 Docker命令集</h3><table class="table table-bordered table-striped table-condensed">
   <tr>
      <td>命令</td>
      <td>说明</td>
   </tr>
   <tr>
      <td>容器生命周期管理</td>
      <td></td>
   </tr>
   <tr>
      <td>run</td>
      <td>创建一个新容器并运行</td>
   </tr>
   <tr>
      <td>start</td>
      <td>开启一个容器并使其在后台运行</td>
   </tr>
   <tr>
      <td>stop</td>
      <td>停止一个容器</td>
   </tr>
   <tr>
      <td>restart</td>
      <td>重启一个容器</td>
   </tr>
   <tr>
      <td>kill</td>
      <td>杀掉一个容器进程</td>
   </tr>
   <tr>
      <td>rm</td>
      <td>删除容器</td>
   </tr>
   <tr>
      <td>pause</td>
      <td>暂停容器</td>
   </tr>
   <tr>
      <td>unpause</td>
      <td>恢复暂停容器</td>
   </tr>
   <tr>
      <td>create</td>
      <td>从镜像中创建一个容器</td>
   </tr>
   <tr>
      <td>exec</td>
      <td>对一个容器执行shell命令</td>
   </tr>
   <tr>
      <td>容器操作</td>
      <td></td>
   </tr>
   <tr>
      <td>ps</td>
      <td>列出容器</td>
   </tr>
   <tr>
      <td>inspect</td>
      <td>获取容器或镜像的元数据</td>
   </tr>
   <tr>
      <td>top</td>
      <td>查看正在运行中的容器进程信息</td>
   </tr>
   <tr>
      <td>attach</td>
      <td>链接正在运行的容器</td>
   </tr>
   <tr>
      <td>events</td>
      <td>从docker服务器获取事件</td>
   </tr>
   <tr>
      <td>logs</td>
      <td>获取docker日志</td>
   </tr>
   <tr>
      <td>wait</td>
      <td>让一个容器进入等待，使其进入阻塞状态</td>
   </tr>
   <tr>
      <td>export</td>
      <td>讲一个容器的文件系统打包至tar</td>
   </tr>
   <tr>
      <td>port</td>
      <td>列出一个容器的端口映射情况</td>
   </tr>
   <tr>
      <td>container</td>
      <td>管理已经运行的容器的</td>
   </tr>
   <tr>
      <td>deploy</td>
      <td>部署新的堆栈或更新已有堆栈的</td>
   </tr>
   <tr>
      <td>update</td>
      <td>更新容器</td>
   </tr>
   <tr>
      <td>rename</td>
      <td>重命名容器</td>
   </tr>
   <tr>
      <td>volume</td>
      <td>卷管理</td>
   </tr>
   <tr>
      <td>容器文件系统操作</td>
      <td></td>
   </tr>
   <tr>
      <td>commit</td>
      <td>提交一个容器的文件系统，使之生成一个新的镜像</td>
   </tr>
   <tr>
      <td>cp</td>
      <td>向一个正在运行的容器复制文件，或将容器中的文件复制出来</td>
   </tr>
   <tr>
      <td>diff</td>
      <td>检查一个容器文件系统更改情况</td>
   </tr>
   <tr>
      <td>镜像仓库操作</td>
      <td></td>
   </tr>
   <tr>
      <td>login</td>
      <td>docker登入</td>
   </tr>
   <tr>
      <td>logout</td>
      <td>docker登出</td>
   </tr>
   <tr>
      <td>pull</td>
      <td>拉取镜像</td>
   </tr>
   <tr>
      <td>push</td>
      <td>推送镜像至服务器</td>
   </tr>
   <tr>
      <td>search</td>
      <td>在docker hub上查询镜像</td>
   </tr>
   <tr>
      <td>镜像管理</td>
      <td></td>
   </tr>
   <tr>
      <td>images</td>
      <td>列出镜像</td>
   </tr>
   <tr>
      <td>rmi</td>
      <td>删除镜像</td>
   </tr>
   <tr>
      <td>tag</td>
      <td>修改本地某一镜像的标记，使其镜像属于某一仓库</td>
   </tr>
   <tr>
      <td>build</td>
      <td>通过指定Dockerfile文件编译镜像</td>
   </tr>
   <tr>
      <td>history</td>
      <td>查看镜像历史</td>
   </tr>
   <tr>
      <td>save</td>
      <td>将制定镜像保存成tar文件</td>
   </tr>
   <tr>
      <td>load</td>
      <td>从tar中恢复镜像</td>
   </tr>
   <tr>
      <td>import</td>
      <td>从tar中创建一个新镜像</td>
   </tr>
   <tr>
      <td>checkpoint</td>
      <td>设置checkpoint，类似于恢复点，可以让镜像撤销到曾经设置的某一个checkpoint上</td>
   </tr>
   <tr>
      <td>image</td>
      <td>docker镜像管理</td>
   </tr>
   <tr>
      <td>manifest</td>
      <td>docker镜像清单管理</td>
   </tr>
   <tr>
      <td>trust</td>
      <td>docker可信镜像管理</td>
   </tr>
   <tr>
      <td>集群管理</td>
      <td></td>
   </tr>
   <tr>
      <td>swarm</td>
      <td>docker集群管理工具</td>
   </tr>
   <tr>
      <td>node</td>
      <td>docker集群节点控制</td>
   </tr>
   <tr>
      <td>stack</td>
      <td>docker集群堆栈管理</td>
   </tr>
   <tr>
      <td>其他命令</td>
      <td></td>
   </tr>
   <tr>
      <td>info</td>
      <td>查询docker信息</td>
   </tr>
   <tr>
      <td>version</td>
      <td>查询docker版本</td>
   </tr>
   <tr>
      <td>system</td>
      <td>docker系统管理</td>
   </tr>
   <tr>
      <td>stats</td>
      <td>docker容器资源使用统计</td>
   </tr>
   <tr>
      <td>config</td>
      <td>管理docker配置</td>
   </tr>
   <tr>
      <td>network</td>
      <td>docker网络管理</td>
   </tr>
   <tr>
      <td>plugin</td>
      <td>docker插件管理</td>
   </tr>
   <tr>
      <td>secret</td>
      <td>docker敏感信息管理</td>
   </tr>
   <tr>
      <td>service</td>
      <td>docker服务管理</td>
   </tr>
   <tr>
      <td></td>
   </tr>
</table>

<p> 能将EXCEL表格转化成HTML格式的在线网址：<a target="_blank" rel="noopener" href="http://pressbin.com/tools/excel_to_html_table/index.html">http://pressbin.com/tools/excel_to_html_table/index.html</a> </p>
<p> Markdown之表格的处理:<a target="_blank" rel="noopener" href="https://www.ituring.com.cn/article/3452">https://www.ituring.com.cn/article/3452</a> </p>
<p>将第一个 <table>变成<table class="table table-bordered table-striped table-condensed"></p>
<h3 id="2-6-作业练习"><a href="#2-6-作业练习" class="headerlink" title="2.6 作业练习"></a>2.6 作业练习</h3><blockquote>
<p>安装Nginx</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1、搜索镜像</span></span><br><span class="line">[root@hchost ~]# docker search nginx</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2、下载镜像</span></span><br><span class="line">[root@hchost ~]# docker pull nginx</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3、新建并运行容器  -d后台运行		-p 指定端口 公网端口：容器内端口</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">运行测试</span></span><br><span class="line">[root@hchost ~]# docker run -d --name nginx01 -p 3344:80 nginx</span><br><span class="line">[root@hchost ~]# curl localhost:3344</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入容器 查询nginx配置</span></span><br><span class="line">[root@hchost ~]# docker exec -it nginx01 /bin/bash</span><br><span class="line">root@bced0d015071:/# whereis nginx</span><br><span class="line">nginx: /usr/sbin/nginx /usr/lib/nginx /etc/nginx /usr/share/nginx</span><br><span class="line">root@bced0d015071:/# cd /etc/nginx/</span><br><span class="line">root@bced0d015071:/etc/nginx# ls</span><br><span class="line">conf.d  fastcgi_params  koi-utf  koi-win  mime.types  modules  nginx.conf  scgi_params  uwsgi_params  win-utf</span><br></pre></td></tr></table></figure>

<p>端口暴露的概念</p>
<p><img src="/Docker.assets%5C1595577116865.png"></p>
<blockquote>
<p>安装Tomcat</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">官方版本</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker run -it --<span class="built_in">rm</span> tomcat:9.0</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">我们之前的启动都是后台，停止了容器之后，docker ps -a 容器还是可以查到</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker run -it --<span class="built_in">rm</span>  一般是用来测试，用完及删除</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建镜像，启动容器</span></span><br><span class="line">[root@hchost ~]# docker run -it -p 8080:8080 tomcat:9.0</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">发现问题</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1.linux命令少了</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2.webapps下没有内容，阿里云镜像默认是最小的镜像，不必要的都删除了</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2的解决方法</span></span><br><span class="line">root@369f96c23d9e:/usr/local/tomcat# cp -r webapps.dist/* webapps</span><br></pre></td></tr></table></figure>

<blockquote>
<p>部署 es + kibana</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">es 暴露的端口很多</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">es 十分的耗内存</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">es 的数据一般需要放置到安全目录！挂载</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">--net somenetwork		网络配置</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动</span></span><br><span class="line">docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; elasticsearch:7.6.2</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看容器CPU、内存使用状态</span></span><br><span class="line">docker stats</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试es是否安装好了</span></span><br><span class="line">[root@hchost ~]# curl localhost:9200</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">增加内存的限制，修改配置文件 -e 环境配置修改</span></span><br><span class="line">docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; -e ES_JAVA_OPTS=&quot;-Xms64m -Xmx512m&quot; elasticsearch:7.6.2</span><br></pre></td></tr></table></figure>

<h3 id="2-7-可视化"><a href="#2-7-可视化" class="headerlink" title="2.7 可视化"></a>2.7 可视化</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">portainer  docker图形化界面管理工具 提供一个后台面板供我们操作</span></span><br><span class="line">docker run -d -p 8088:9000 --restart always -v /var/run/docker.sock:/var/run/docker.sock --privileged=true portainer/portainer</span><br></pre></td></tr></table></figure>

<p>Rancher （CI&#x2F;CD再用）</p>
<p>访问测试： <a target="_blank" rel="noopener" href="http://139.224.133.172:8088/">http://139.224.133.172:8088</a> </p>
<p>username:admin</p>
<p>passwd:123qweasd</p>
<p><img src="/Docker.assets%5C1595745991391.png" alt="1595745991391"></p>
<p>选择本地的</p>
<p><img src="/Docker.assets%5C1595746108060.png" alt="1595746108060"></p>
<p>进入之后的面板</p>
<p><img src="/Docker.assets%5C1595746180549.png" alt="1595746180549"></p>
<h2 id="3、Docker镜像讲解"><a href="#3、Docker镜像讲解" class="headerlink" title="3、Docker镜像讲解"></a>3、Docker镜像讲解</h2><h3 id="3-1-镜像是什么"><a href="#3-1-镜像是什么" class="headerlink" title="3.1 镜像是什么"></a>3.1 镜像是什么</h3><p>镜像是一种轻量级、可执行的独立软件包，用来打包软件运行环境和基于运行环境开发的软件，它包含运行某个软件所需的所有内容，包括代码、运行时、库、环境变量和配置文件。</p>
<p>所有的应用，直接打包docker镜像，就可以直接跑起来。</p>
<p>如何得到镜像：</p>
<ul>
<li>从远处仓库下载</li>
<li>朋友拷贝给你</li>
<li>自己制作一个镜像 DockerFile</li>
</ul>
<h3 id="3-2-Docker镜像加载原理"><a href="#3-2-Docker镜像加载原理" class="headerlink" title="3.2 Docker镜像加载原理"></a>3.2 Docker镜像加载原理</h3><blockquote>
<p>UninoFS（联合文件系统）</p>
</blockquote>
<p>我们下载的时候看到的一层层就是这个！</p>
<p>UninoFS（联合文件系统）：Union文件系统（UninoFS）是一种分层、轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下(unite several directories into a single virtual file system)。Union文件系统是Docker镜像的基础。镜像可以通过分层来进行继承，基于基础镜像（没有父镜像），可以制作个各种具体的应用镜像。</p>
<p>特性：一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录。</p>
<blockquote>
<p>Docker镜像加载原理</p>
</blockquote>
<p>docker的镜像实际上由一层一层的文件系统组成，这种层级的文件系统UnionFS。</p>
<p><strong>bootfs</strong>(boot file system)主要包含 bootloader和kernel，bootloader主要是引导加载kernel， Linux刚启动的时会加载bootfs文件系统，在Docker镜像的最底层是bootfs。这一层与我们典型的Linux&#x2F;Unix系统是一样的，包含boot加载器和内核。当boot加载完成之后整个内核就都在内存中了，此时内存的使用权已有bootfs转交给内核，此时系统也会卸载bootfs。</p>
<p><strong>rootfs</strong> (root file system) ，再bootfs之上。包含的就是典型 Linux 系统中的&#x2F;dev，&#x2F;proc，&#x2F;bin，&#x2F;etc等标准目录和文件。rootfs就是各种不同的操作系统发行版，比如Ubuntu，Centos等等。</p>
<p><img src="/Docker.assets%5C1595749696333.png" alt="1595749696333">平时我们安装进虚拟机的Centos都是好几个G，为什么docker这里才200M？</p>
<p><img src="/Docker.assets%5C1595749785452.png" alt="1595749785452">对于一个精简的OS，rootfs可以很小，只需要包含最基本的命令，工具和程序就可以了，因为底层直接用Host的kernel，自己只需要提供rootfs就可以了。由此可见对于不同的linux发行版，bootfs基本是一致的，rootfs会有差别，因此不同的发行版可以共用bootfs。</p>
<h3 id="3-3-分层理解"><a href="#3-3-分层理解" class="headerlink" title="3.3 分层理解"></a>3.3 分层理解</h3><blockquote>
<p>分层的镜像</p>
</blockquote>
<p>我们可以去下载一个镜像，观察下载的日志输出，可以看到一层一层的在下载。</p>
<p>思考：为什么Docker镜像要采用这种分层的结构呢？</p>
<p>最大的好处，我觉得莫过于是<strong>资源共享</strong>了。比如有多个镜像都从相同的Base镜像构建而来，那么宿主机只需要在磁盘上保留一份base镜像，同时内存中也只需要加载一份base镜像，这样就可以为所有的容器服务了，而且镜像的每一层都可以 被共享。</p>
<p>查看镜像分层的方式也以通过 docker image inspect 命令。</p>
<p><strong>理解：</strong></p>
<p>所有的Docker镜像都起始于一个基础镜像层，当进行修改或增加新的内容时，就会在当前镜像层之上，创建新的镜像层。</p>
<p>举一个简单的例子，假如基于Ubuntu Linux 16.04 创建一个新的镜像，就是新镜像的第一层；如果在该镜像中添加Python包，就会在基础镜像层之上创建第二个镜像层；如果继续添加一个安全补丁，就会创建第三个镜像层。</p>
<p><img src="/Docker.assets%5C1595751353783.png" alt="1595751353783"></p>
<p>在添加额外的镜像层的同时，镜像始终保持是当前所有镜像的组合，理解这一点非常重要。下图中举了一个简单的例子，每个镜像层包含3个文件，而镜像包含了来自两个镜像层的6个文件。</p>
<p><img src="/Docker.assets%5C1595752028860.png" alt="1595752028860"></p>
<p>上图中的镜像层跟之前图中的略有区别，主要目的是便于展示文件。</p>
<p>下图中展示了一个稍微复杂的三层镜像，在外部看来整个镜像只有6个文件，这是因为最上层中的文件7是文件5的一个更新版本。</p>
<p><img src="/Docker.assets%5C1595752193454.png" alt="1595752193454"></p>
<p>这种情况下，上层镜像层中的文件覆盖了底层镜像层中的文件。这样就使得文件的更新版本作为一个新镜像层添加到镜像当中。</p>
<p>Docker 通过存储引擎（新版本采用快照机制）的方式来实现镜像层堆栈，并保证多镜像层对外展示位统一的文件系统。</p>
<p>Linux 上可用的存储引擎有 AUFS、Overlay2、Device Mapper、Btrfs 以及ZFS。顾名思义，每种存储引擎都基于Linux中对应的文件系统或者块设备技术，并且每种存储引擎都有其独有的性能特点。</p>
<p>Docker 在Windows 上仅支持windowsfilter一种存储引擎，该引擎基于NTFS文件系统上实现了分层和CoW。</p>
<p>下图展示了与系统显示相同的三层镜像。所有镜像层堆叠并合并，对外提供统一的视图。</p>
<p><img src="/Docker.assets%5C1595753158798.png" alt="1595753158798"></p>
<blockquote>
<p>特点</p>
</blockquote>
<p>Docker镜像都是只读的，当容器启动时，一个新的可写层别加载到镜像的顶部！</p>
<p>这一层就是我们通常说的容器层，容器之下的都叫镜像层。</p>
<h3 id="3-4-commit-镜像"><a href="#3-4-commit-镜像" class="headerlink" title="3.4 commit 镜像"></a>3.4 commit 镜像</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">docker commit 提交容器成为一个新的副本</span><br><span class="line">docker commit -m=&quot;提交的描述信息&quot; -a=&quot;作者&quot; 容器id 目标镜像名：[TAG]</span><br><span class="line"></span><br><span class="line">[root@hchost ~]# docker commit -m=&quot;add webapps&quot; -a=&quot;hc&quot; 369f96c23d9e tomcat_hc:1.0</span><br><span class="line">sha256:581b5c37a65f77fdef30fccf6ab254f17a976096dfc1af5b034c9c21f5511188</span><br><span class="line"></span><br><span class="line">[root@hchost ~]# docker images</span><br><span class="line">REPOSITORY            TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">tomcat_hc             1.0                 581b5c37a65f        5 seconds ago       652MB</span><br><span class="line">tomcat                9.0                 b4f6a90c69a4        3 days ago          647MB</span><br><span class="line">portainer/portainer   latest              62771b0b9b09        3 days ago          79.1MB</span><br><span class="line">nginx                 latest              8cf1bfb43ff5        4 days ago          132MB</span><br><span class="line">elasticsearch         7.6.2               f29a1ee41030        4 months ago        791MB</span><br><span class="line">centos                7.2.1511            9aec5c5fe4ba        16 months ago       195MB</span><br></pre></td></tr></table></figure>

<p>学习方式：理解概念，但是一定要实践，最后实践和理论想结合一次搞定这个知识</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">如果你想保存当前容器的状态，就可以通过commit提交，获得一个镜像。</span><br><span class="line">就好比我们以前学习VM的时候，快照。</span><br></pre></td></tr></table></figure>

<h2 id="4、容器数据卷"><a href="#4、容器数据卷" class="headerlink" title="4、容器数据卷"></a>4、容器数据卷</h2><h3 id="4-1-什么是容器数据卷"><a href="#4-1-什么是容器数据卷" class="headerlink" title="4.1 什么是容器数据卷"></a>4.1 什么是容器数据卷</h3><p><strong>docker的理念回顾</strong></p>
<p>将应用和环境打包成一个镜像</p>
<p>如果数据都在容器中，那么我们容器删除，数据就会丢失！&#x3D;&#x3D;需求：数据可以持久化&#x3D;&#x3D;</p>
<p>容器之间可以有个数据共享的技术！Docker容器中产生的数据，同步到本地！</p>
<p>这就是卷技术！目录的挂载，将我们容器内的目录，挂载到Linux上面。</p>
<p>总结：容器的持久化和同步操作！容器间也是可以数据共享的！</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看卷列表</span></span><br><span class="line">[root@hchost nginx]<span class="comment"># docker volume ls</span></span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个卷</span></span><br><span class="line">[root@hchost nginx]<span class="comment"># docker volume create hc_nginx</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看卷路径</span></span><br><span class="line">[root@hchost nginx]<span class="comment"># docker volume inspect hc_nginx</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用卷</span></span><br><span class="line">[root@docker01 ~]<span class="comment"># docker run -d -p 9000:80 -v clsn:/usr/share/nginx/html nginx:latest </span></span><br><span class="line">[root@docker01 ~]<span class="comment"># docker run  -d  -P  --volumes-from 079786c1e297 nginx:latest</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除卷</span></span><br><span class="line"><span class="comment"># 删除未被任何容器使用的本地卷</span></span><br><span class="line">docker volume prune [OPTIONS]</span><br><span class="line"></span><br><span class="line">docker volume <span class="built_in">rm</span> [OPTIONS] VOLUME [VOLUME...]</span><br></pre></td></tr></table></figure>



<h3 id="4-2-使用数据卷"><a href="#4-2-使用数据卷" class="headerlink" title="4.2 使用数据卷"></a>4.2 使用数据卷</h3><blockquote>
<p>方式一：直接使用命令来挂载 -v</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -v 主机目录:容器目录</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试</span></span><br><span class="line">[root@hchost ~]# docker run -it -v /home/test:/home centos /bin/bash</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动起来可以通过 docker inspect 容器<span class="built_in">id</span>  查看是否挂载成功</span></span><br></pre></td></tr></table></figure>

<p><img src="/Docker.assets/1596094279788.png" alt="1596094279788"></p>
<h3 id="4-3-实战：安装Mysql"><a href="#4-3-实战：安装Mysql" class="headerlink" title="4.3 实战：安装Mysql"></a>4.3 实战：安装Mysql</h3><p>思考：Mysql的数据持久化</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取镜像</span></span><br><span class="line">[root@hchost ~]# docker pull mysql:5.7</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">注意：安装启动mysql是需要配置密码的 官方的命令如下（参考） -e配置环境</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">运行容器，做数据挂载</span>  </span><br><span class="line">-d 后台运行</span><br><span class="line">-p 端口映射</span><br><span class="line">-v 卷挂载</span><br><span class="line">-e 环境配置</span><br><span class="line">--name 容器命名</span><br><span class="line">[root@hchost ~]# docker run -d -p 3310:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name=mysql mysql:5.7</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Navicat---连接到服务器的3310---3310和容器内的3306映射，这个时候我们就可以连接上了。</span></span><br></pre></td></tr></table></figure>

<h3 id="4-4-具名挂载和匿名挂载"><a href="#4-4-具名挂载和匿名挂载" class="headerlink" title="4.4 具名挂载和匿名挂载"></a>4.4 具名挂载和匿名挂载</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">匿名挂载</span></span><br><span class="line">-v 容器内路径</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-P 随机映射端口</span></span><br><span class="line">docker run -d -P --name nginx01 -v /etc/nginx nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看所有的卷的情况</span></span><br><span class="line">[root@hchost ~]# docker volume ls</span><br><span class="line">DRIVER              VOLUME NAME</span><br><span class="line">local               4f6867a257a8c5062f439f4705d05f35451395817c14169392ece8dd4742f318</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">这种就是匿名挂载，我们在 -v 只写了容器内的路径，没有写容器外的路径</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">具名挂载</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">通过 -v 卷名:容器内路径</span></span><br><span class="line">[root@hchost ~]# docker run -d -P --name nginx02 -v juming-nginx:/etc/nginx nginx</span><br><span class="line">b86bf3aa54eb32f72b2eb3ff72af0b7637bba24e6ffde7eb57b502964d28cd1a</span><br><span class="line">[root@hchost ~]# docker volume ls</span><br><span class="line">DRIVER              VOLUME NAME</span><br><span class="line">local               juming-nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看卷的位置</span></span><br><span class="line">[root@hchost ~]# docker volume inspect juming-nginx</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;CreatedAt&quot;: &quot;2020-07-31T14:57:42+08:00&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Labels&quot;: null,</span><br><span class="line">        &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/juming-nginx/_data&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;juming-nginx&quot;,</span><br><span class="line">        &quot;Options&quot;: null,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">&quot;Mountpoint&quot;</span>: <span class="string">&quot;/var/lib/docker/volumes/juming-nginx/_data&quot;</span>就是宿主机上此容器/etc/nginx卷映射的位置</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>所有的docker容器内的卷，没有指定目录的情况下都是在&#x3D;&#x3D;&#x2F;var&#x2F;lib&#x2F;docker&#x2F;volumes&#x2F;***&#x2F;_data&#x3D;&#x3D;下</p>
<p>通过具名挂载可以方便的找到我们的一个卷，大多数情况在使用的都是<code>具名挂载</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如何确定是具名挂载还是匿名挂载，还是指定路径挂载</span></span><br><span class="line">-v 容器内路径			  # 匿名挂载</span><br><span class="line">-v 卷名：容器内路径	  		# 具名挂载</span><br><span class="line">-v /宿主机路径：容器内路径   #	指定路径挂载	</span><br></pre></td></tr></table></figure>

<p>拓展：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">通过 -v 容器内路径：ro rw 改变读写权限</span></span><br><span class="line">ro	readonly	# 只读</span><br><span class="line">rw	readwrite	# 可读可写</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">一旦设定了容器权限，容器对我们挂载出来的内容就有限定了</span></span><br><span class="line">docker run -d -P --name nginx02 -v juming-nginx:ro nginx</span><br><span class="line">docker run -d -P --name nginx02 -v juming-nginx:rw nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ro 只要看到ro就说明这个路径只能通过宿主机来操作，容器内部是无法操作的</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="4-5-初识DockerFile"><a href="#4-5-初识DockerFile" class="headerlink" title="4.5 初识DockerFile"></a>4.5 初识DockerFile</h3><p>Dockerfile 就是用来构建docker镜像的构建文件夹！命令脚本！</p>
<p>通过这个脚本可以生成镜像，镜像是一层一层的，脚本一个一个的命令，每个命令都是一层！</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建一个dockerfile文件，名字可以随机，建议使用dockerfile</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">文件中的内容  指令（大写） 参数</span></span><br><span class="line">[root@hchost dockefile_test]# cat dockerfile1 </span><br><span class="line">FROM centos</span><br><span class="line"></span><br><span class="line">VOLUME [&quot;volume01&quot;,&quot;volume02&quot;]</span><br><span class="line"></span><br><span class="line">CMD echo &quot;------end-----&quot;</span><br><span class="line">CMD /bin/bash</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">这个每一个命令就是一层镜像</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">生成镜像</span></span><br><span class="line">-f dockerfile1的路径</span><br><span class="line">-t 生成镜像名称</span><br><span class="line">.  当前路径			# 切记不要丢失</span><br><span class="line">[root@hchost dockefile_test]# docker build -f dockerfile1 -t hc/centos:1.0 .</span><br><span class="line">[root@hchost dockefile_test]# docker images</span><br><span class="line">REPOSITORY            TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">hc/centos             1.0                 dec9e0704eb2        8 seconds ago       215MB</span><br></pre></td></tr></table></figure>

<p>启动自己写的容器</p>
<p><img src="/Docker.assets/1596187179164.png" alt="1596187179164"></p>
<p>这个卷和外部一定有一个同步的目录</p>
<p><img src="/Docker.assets/1596187301530.png" alt="1596187301530"></p>
<p>查看卷挂载的路径</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker inspect 容器ID</span></span><br></pre></td></tr></table></figure>

<p><img src="/Docker.assets/1596187844173.png" alt="1596187844173"></p>
<p>这种方式我们未来使用的十分多，因为我们通常会构建自己的镜像！</p>
<p>假设构建镜像时候没有挂载卷，要手动镜像挂载 -v 卷名:容器内路径</p>
<h3 id="4-6-数据卷容器"><a href="#4-6-数据卷容器" class="headerlink" title="4.6 数据卷容器"></a>4.6 数据卷容器</h3><p>–volumes-from</p>
<p>多个mysql数据同步</p>
<p><img src="/Docker.assets/1596208925725.png" alt="1596208925725"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建两个容器实现数据同步</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建docker01</span></span><br><span class="line">docker run -it --name=docker01 centos</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建docker02</span></span><br><span class="line">docker run -it --name=docker02 --volumes-from docker01 centos</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker01 和docker02 的数据是同步的,docker01就是数据卷容器（父类），docker02是子类</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">还可以创建多个容器挂载docker01或docker02，删除了docker01，其余挂载的容器数据不会丢失</span></span><br></pre></td></tr></table></figure>

<p>结论：</p>
<p>容器之间配置信息的传递，数据卷容器的生命周期一直持续到没有容器使用。</p>
<p>但是一旦持久化到了本地，这个时候，本地数据是不会删除的</p>
<h2 id="5、DockerFile"><a href="#5、DockerFile" class="headerlink" title="5、DockerFile"></a>5、DockerFile</h2><h3 id="5-1-DockerFile介绍"><a href="#5-1-DockerFile介绍" class="headerlink" title="5.1 DockerFile介绍"></a>5.1 DockerFile介绍</h3><p>Dockerfile 就是用来构建docker镜像的构建文件夹！命令参数脚本！</p>
<p><strong>构建步骤：</strong></p>
<ol>
<li>编写一个dockerfile 文件</li>
<li>docker build 构建成为一个镜像</li>
<li>docker run 运行镜像</li>
<li>docker push 发布镜像（DockerHub、阿里云镜像仓库）</li>
</ol>
<h3 id="5-2-DockerFile构建过程"><a href="#5-2-DockerFile构建过程" class="headerlink" title="5.2 DockerFile构建过程"></a>5.2 DockerFile构建过程</h3><p><strong>基础知识：</strong></p>
<ol>
<li>每个保留关键字（指令）都必须是大写字母</li>
<li>执行从上到下顺序执行</li>
<li>#表示注释</li>
<li>每一个指令都会创建提交一个新的镜像层，并提交！</li>
</ol>
<p><img src="/Docker.assets/1596265123101.png" alt="1596265123101"></p>
<p>dockerfile是面向开发的，我们以后要发布项目，做镜像，就需要编写dockerfile文件，这个文件十分简单！</p>
<p>Docker 镜像逐渐成为企业交付的标准，必须掌握！</p>
<p><strong>步骤：开发，部署，运维</strong></p>
<p>DockerFile：构建文件，定义了一切的步骤，相当于源代码</p>
<p>DockerImages：通过DockerFile 构建生成的镜像，最终发布和运行的产品！</p>
<p>Docker容器：容器就是镜像运行起来提供服务器</p>
<p><strong>构建容器前先开启内核路由转发,否则创建的容器无法连接网络</strong> </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;net.ipv4.ip_forward = 1\nnet.ipv4.conf.default.rp_filter = 0 \nnet.ipv4.conf.all.rp_filter = 0&quot;</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure>



<h3 id="5-3-Dockerfile的命令"><a href="#5-3-Dockerfile的命令" class="headerlink" title="5.3 Dockerfile的命令"></a>5.3 Dockerfile的命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">FROM		# 基础镜像，一切从这里开始构建</span><br><span class="line">MAINTAINER	# 镜像是谁写的，姓名+邮箱</span><br><span class="line">RUN			# 镜像构建的时候需要运行的命令</span><br><span class="line">ADD			# 添加内容，如基础镜像只是centos，添加个tomcat镜像 ,会解压</span><br><span class="line">WORKDIR		# 镜像的工作目录</span><br><span class="line">VOLUME		# 挂载的目录</span><br><span class="line">EXPOSE		# 暴露端口配置</span><br><span class="line">RUN			# 指定容器启动后要干的时间</span><br><span class="line">CMD			# 指定这个容器启动的时候要运行的命令,只有最后一个会生效，可被替代 ls -a , ls -l 最后的生效，-l会替换-a</span><br><span class="line">ENTRYPOINT	# 指定这个容器启动的时候要运行的命令，可以追加命令  ls -a , ls -l  追加到后面，最后执行的是  ls -a -l</span><br><span class="line">ONBUILD		# 当构建一个被继承的 DockerFile 这个时候回运行ONBUILD 的指令，触发指令。</span><br><span class="line">COPY		# 类似ADD，将我们的文件拷贝到镜像中</span><br><span class="line">ENV			# 构建的时候设置环境变量</span><br></pre></td></tr></table></figure>

<p><img src="/Docker.assets/1596265803313.png" alt="1596265803313"></p>
<h3 id="5-4-实战测试"><a href="#5-4-实战测试" class="headerlink" title="5.4 实战测试"></a>5.4 实战测试</h3><p>Docker Hub 中 99% 镜像都是从这个基础镜像过来的，FROM scratch，然后配置需要的软件和配置来构建的。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">FROM centos:7.2.1511 </span><br><span class="line">MAINTAINER hc&lt;zzrfhc@163.com&gt; </span><br><span class="line">ENV MYPATH /usr/local </span><br><span class="line">WORKDIR $MYPATH </span><br><span class="line">RUN yum -y install vim </span><br><span class="line">RUN yum -y install net-tools </span><br><span class="line">EXPOSE 80 </span><br><span class="line">CMD echo $MYPATH</span><br><span class="line">CMD echo &quot;----end----&quot;</span><br><span class="line">CMD /bin/bash</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker history 镜像ID		# 查看镜像的构建记录</span><br></pre></td></tr></table></figure>

<blockquote>
<p>CMD 和 ENTRYPOINT 区别</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">CMD			# （覆盖）指定容器启动的时候要运行的命令，只有最后一个会生效，可被替代，只执行一次</span><br><span class="line">ENTRYPOINT 	# （追加）指定容器启动的时候要运行的命令，可以追加命令</span><br><span class="line"></span><br><span class="line">编写dockerfile1</span><br><span class="line">FROM centos</span><br><span class="line">CMD [&quot;ls&quot;,&quot;-a&quot;]</span><br><span class="line"></span><br><span class="line">docker build -f dockerfile1 -t centosCMD .</span><br><span class="line">docker run 镜像ID -l # 会报错，因为-l会替代CMD 的 ls -a</span><br><span class="line"></span><br><span class="line">编写dockerfile2</span><br><span class="line">FROM centos</span><br><span class="line">ENTRYPOINT  [&quot;ls&quot;,&quot;-a&quot;]</span><br><span class="line"></span><br><span class="line">docker build -f dockerfile2 -t centosENTRYPOINT .</span><br><span class="line">docker run 镜像ID -l # 可以执行，相当于执行 ls -a -l</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="5-4-1-实战：Tomcat镜像"><a href="#5-4-1-实战：Tomcat镜像" class="headerlink" title="5.4.1 实战：Tomcat镜像"></a>5.4.1 实战：Tomcat镜像</h4><ol>
<li>准备镜像文件，tomcat压缩包，JDK压缩包</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载tomcat压缩包</span></span><br><span class="line">wget  https://downloads.apache.org/tomcat/tomcat-9/v9.0.36/bin/apache-tomcat-9.0.37.tar.gz </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载jdk</span></span><br><span class="line">wget --no-check-certificate --no-cookies --header &quot;Cookie: oraclelicense=accept-securebackup-cookie&quot; https://download.oracle.com/otn/java/jdk/8u261-b12/a4634525489241b9a9e1aa73d9e118e6/jdk-8u261-linux-x64.tar.gz</span><br></pre></td></tr></table></figure>

<p><img src="/Docker.assets/1596611138652.png" alt="1596611138652"></p>
<ol start="2">
<li><p>编写Dockerfile文件，官方命名 &#x3D;&#x3D;Dockerfile&#x3D;&#x3D; ，build会自动寻找这个文件，不需要 -f 指定了！</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">FROM centos:7.2.1511</span><br><span class="line">MAINTAINER hc&lt;zzrfhc@163.com&gt; </span><br><span class="line">COPY readme.txt /usr/local/readme.txt </span><br><span class="line">ADD jdk-8u261-linux-x64.tar.gz /usr/local/ </span><br><span class="line">ADD apache-tomcat-9.0.37.tar.gz /usr/local/ </span><br><span class="line">RUN yum -y install vim</span><br><span class="line">RUN yum -y install net-tools </span><br><span class="line">ENV MYPATH /usr/local </span><br><span class="line">WORKDIR $MYPATH </span><br><span class="line">ENV JAVA_HOME /usr/local/jdk1.8.0_261 </span><br><span class="line">ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar </span><br><span class="line">ENV CATALINA_HOME /usr/local/apache-tomcat-9.0.37 </span><br><span class="line">ENV CATALINABASH /usr/local/apache-tomcat-9.0.37 </span><br><span class="line">ENV PATH $PATH:$JAVA_HOME/bin:$CATALINA_HOME/lib:$CATALINA_HOME/bin </span><br><span class="line">EXPOSE 8080 </span><br><span class="line">CMD /usr/local/apache-tomcat-9.0.37/bin/startup.sh &amp;&amp; tail -F /usr/local/apache-tomcat-9.0.37/bin/logs/catalina.out</span><br></pre></td></tr></table></figure>
</li>
<li><p>构建镜像，启动容器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">构建镜像</span></span><br><span class="line">[root@hchost home]# docker build -t tomcat_jdk .</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动容器</span></span><br><span class="line">[root@hchost home]# docker run -d -p 8080:8080 --name tomcat_hc -v /home/tomcat/webapps:/usr/local/apache-tomcat-9.0.37/webapps -v /home/tomcat/logs:/usr/local/apache-tomcat-9.0.37/logs 93052c402a3e</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="5-4-2-实战：Nginx镜像"><a href="#5-4-2-实战：Nginx镜像" class="headerlink" title="5.4.2 实战：Nginx镜像"></a>5.4.2 实战：Nginx镜像</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建容器部署方式</span></span><br><span class="line"></span><br><span class="line">docker run -it --name my_nginx -p 8023:80 -v /opt/:/opt/ -v /usr/local/nginx/:/usr/local/nginx/ centos:7.6.1810 /bin/bash</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">yum install -y gcc gcc-c++ glibc make autoconf openssl openssl-devel libxslt-devel gd gd-devel GeoIP GeoIP-devel pcre pcre-devel</span><br><span class="line"></span><br><span class="line">useradd -r serviceop -M -s /sbin/nologin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将这句注释掉 取消Debug编译模式，在179行</span></span><br><span class="line">vim auto/cc/gcc</span><br><span class="line"><span class="comment"># CFLAGS=&quot;$CFLAGS -g&quot;</span></span><br><span class="line"></span><br><span class="line">./configure --prefix=/usr/local/nginx --user=serviceop --group=serviceop --with-http_stub_status_module --with-http_ssl_module</span><br><span class="line"></span><br><span class="line">make</span><br><span class="line"></span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /usr/local/nginx/sbin</span><br><span class="line"></span><br><span class="line">./nginx</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment"># /home/docker_file/nginx_dockerfile</span></span><br><span class="line"><span class="comment"># 第一步 vim Dockerfile</span></span><br><span class="line">FROM centos:7.6.1810</span><br><span class="line">MAINTAINER hc&lt;zzrfhc@163.com&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ADD https://nginx.org/download/nginx-1.18.0.tar.gz .</span></span><br><span class="line">ADD nginx-1.18.0.tar.gz /usr/local/src/</span><br><span class="line"></span><br><span class="line">WORKDIR /usr/local/src/nginx-1.18.0</span><br><span class="line"></span><br><span class="line">RUN yum install -y gcc gcc-c++ glibc make autoconf openssl openssl-devel</span><br><span class="line">RUN yum install -y libxslt-devel gd gd-devel GeoIP GeoIP-devel pcre pcre-devel</span><br><span class="line">RUN useradd -M -s /sbin/nologin -r serviceop</span><br><span class="line"></span><br><span class="line">RUN ./configure --user=serviceop --group=serviceop --prefix=/usr/local/nginx --with-file-aio --with-http_ssl_module --with-http_realip_module --with-http_addition_module --with-http_xslt_module --with-http_image_filter_module --with-http_geoip_module --with-http_sub_module --with-http_dav_module --with-http_flv_module --with-http_mp4_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_auth_request_module --with-http_random_index_module --with-http_secure_link_module --with-http_degradation_module --with-http_stub_status_module</span><br><span class="line">RUN make &amp;&amp; make install</span><br><span class="line">RUN <span class="built_in">ln</span> -s /usr/local/nginx/sbin/* /usr/local/sbin/</span><br><span class="line">EXPOSE 80</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二步 构建镜像</span></span><br><span class="line">[root@hchost nginx_dockerfile]<span class="comment"># docker build -t centos_nginx:v1 .</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第三步 创建容器</span></span><br><span class="line">[root@hchost nginx_dockerfile]<span class="comment"># docker run -it --name nginx -v /usr/local/nginx/:/usr/local/nginx/ centos_nginx:1.18.0 /bin/bash</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="5-5-发布自己的镜像"><a href="#5-5-发布自己的镜像" class="headerlink" title="5.5 发布自己的镜像"></a>5.5 发布自己的镜像</h3><blockquote>
<h3 id="DockerHub"><a href="#DockerHub" class="headerlink" title="DockerHub"></a>DockerHub</h3></blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">登陆</span></span><br><span class="line">[root@hchost tomcat]# docker login --help</span><br><span class="line"></span><br><span class="line">Usage:  docker login [OPTIONS] [SERVER]</span><br><span class="line"></span><br><span class="line">Log in to a Docker registry.</span><br><span class="line">If no server is specified, the default is defined by the daemon.</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -p, --password string   Password</span><br><span class="line">      --password-stdin    Take the password from stdin</span><br><span class="line">  -u, --username string   Username</span><br><span class="line">  </span><br><span class="line">[root@hchost tomcat]# docker login -u zzrfhc</span><br><span class="line">Password: </span><br><span class="line">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br></pre></td></tr></table></figure>

<p>提交镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker push 镜像<span class="built_in">id</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">一般的格式是  docker push 作者/镜像<span class="built_in">id</span>：版本号</span></span><br><span class="line">[root@hchost tomcat]# docker push hc/tomcat_jdk:1.0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">提交不成功是因为本地没有1.0这个tag</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">增加一个tag</span></span><br><span class="line">docker tag 镜像ID 镜像名称：版本号</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1、登陆docker hub</span></span><br><span class="line">[root@hchost tomcat]# docker login -u zzrfhc</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2、命名tag</span></span><br><span class="line">[root@hchost tomcat]# docker tag 93052c402a3e zzrfhc/tomcat_jdk:1.0</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">注意：给自己镜像命名的时候格式应该是: docker注册用户名/镜像名,比如我的docker用户名为 zzrfhc,那么我的镜像tag就为 zzrfhc/镜像名称：版本号,不然是push不上去的</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3、上传镜像</span></span><br><span class="line">[root@hchost tomcat]# docker push zzrfhc/tomcat_jdk:1.0</span><br><span class="line">The push refers to repository [docker.io/zzrfhc/tomcat_jdk]</span><br><span class="line">6b08eaced85b: Pushing [&gt;                                                  ]  1.078MB/79.96MB</span><br><span class="line">4019bb2beee4: Pushing [&gt;                                                  ]   2.16MB/134.9MB</span><br><span class="line">ed6278e9867b: Pushing [===&gt;                                               ]  1.025MB/15.63MB</span><br><span class="line">df8af12b4375: Pushing [&gt;                                                  ]  1.072MB/352.4MB</span><br><span class="line">9e72b3c12000: Pushed </span><br><span class="line">a11c91bfd866: Pushing [&gt;                                                  ]  544.8kB/194.6MB</span><br></pre></td></tr></table></figure>

<blockquote>
<h3 id="阿里云镜像服务上"><a href="#阿里云镜像服务上" class="headerlink" title="阿里云镜像服务上"></a>阿里云镜像服务上</h3></blockquote>
<ol>
<li><p>登陆阿里云</p>
</li>
<li><p>找到容器镜像服务</p>
</li>
<li><p>创建命名空间</p>
<p>容器镜像服务 &#x3D;&#x3D;&#x3D;&gt; 命名空间 &#x3D;&#x3D;&#x3D;&gt; 创建命名空间</p>
<p><img src="/Docker.assets/1596681994816.png" alt="1596681994816"></p>
</li>
<li><p>创建容器镜像</p>
<p>容器镜像服务 &#x3D;&#x3D;&#x3D;&gt; 镜像仓库 &#x3D;&#x3D;&#x3D;&gt; 创建镜像仓库</p>
<p><img src="/Docker.assets/1596682153269.png" alt="1596682153269"></p>
</li>
<li><p>上传镜像</p>
<ol>
<li><strong>登录阿里云Docker Registry</strong></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker login --username=zzrfhc registry.cn-shanghai.aliyuncs.com</span><br></pre></td></tr></table></figure>

<p>用于登录的用户名为阿里云账号全名，密码为开通服务时设置的密码。</p>
<p>您可以在访问凭证页面修改凭证密码。</p>
<ol start="2">
<li><strong>从Registry中拉取镜像</strong></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker pull registry.cn-shanghai.aliyuncs.com/zzrfhc_docker/hc_docker:[镜像版本号]</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>将镜像推送到Registry</strong></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker login --username=zzrfhc registry.cn-shanghai.aliyuncs.com</span><br><span class="line">$ sudo docker tag [ImageId] registry.cn-shanghai.aliyuncs.com/zzrfhc_docker/hc_docker:[镜像版本号]</span><br><span class="line">$ sudo docker push registry.cn-shanghai.aliyuncs.com/zzrfhc_docker/hc_docker:[镜像版本号]</span><br></pre></td></tr></table></figure>

<p>请根据实际镜像信息替换示例中的[ImageId]和[镜像版本号]参数。</p>
<ol start="4">
<li><strong>选择合适的镜像仓库地址</strong></li>
</ol>
<p>从ECS推送镜像时，可以选择使用镜像仓库内网地址。推送速度将得到提升并且将不会损耗您的公网流量。</p>
<p>如果您使用的机器位于VPC网络，请使用 registry-vpc.cn-shanghai.aliyuncs.com 作为Registry的域名登录，并作为镜像命名空间前缀。</p>
<ol start="5">
<li><strong>示例</strong></li>
</ol>
<p>使用”docker tag”命令重命名镜像，并将它通过专有网络地址推送至Registry。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker imagesREPOSITORY                                                         TAG                 IMAGE ID            CREATED             VIRTUAL SIZEregistry.aliyuncs.com/acs/agent                                    0.7-dfb6816         37bb9c63c8b2        7 days ago          37.89 MB$ sudo docker tag 37bb9c63c8b2 registry-vpc.cn-shanghai.aliyuncs.com/acs/agent:0.7-dfb6816</span><br></pre></td></tr></table></figure>

<p>使用”docker images”命令找到镜像，将该镜像名称中的域名部分变更为Registry专有网络地址。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker push registry-vpc.cn-shanghai.aliyuncs.com/acs/agent:0.7-dfb6816</span><br></pre></td></tr></table></figure>

<blockquote>
<p>把自己制作的tomcat镜像上传到阿里云</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1、登陆</span></span><br><span class="line">[root@hchost tomcat]# docker login --username=zzrfhc registry.cn-shanghai.aliyuncs.com</span><br><span class="line">[root@hchost tomcat]# docker login --username=zzrfhc registry.cn-shanghai.aliyuncs.com/zzrfhc_docker/hc_docker</span><br><span class="line">Password: </span><br><span class="line">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2、命名tag</span></span><br><span class="line">[root@hchost tomcat]# docker tag 93052c402a3e registry.cn-shanghai.aliyuncs.com/zzrfhc_docker/hc_docker/tomcat_jdk:1.0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3、上传镜像</span></span><br><span class="line">[root@hchost ~]# docker push registry.cn-shanghai.aliyuncs.com/zzrfhc_docker/hc_docker/tomcat_jdk:1.0</span><br><span class="line">The push refers to repository [registry.cn-shanghai.aliyuncs.com/zzrfhc_docker/hc_docker/tomcat_jdk]</span><br><span class="line">6b08eaced85b: Pushing [&gt;                                                  ]    535kB/79.96MB</span><br><span class="line">4019bb2beee4: Pushing [&gt;                                                  ]  1.081MB/134.9MB</span><br><span class="line">ed6278e9867b: Pushing [==&gt;                                                ]  867.3kB/15.63MB</span><br><span class="line">df8af12b4375: Pushing [&gt;                                                  ]  1.072MB/352.4MB</span><br><span class="line">9e72b3c12000: Pushed </span><br><span class="line">a11c91bfd866: Pushing [&gt;                                                  ]  1.071MB/194.6MB</span><br></pre></td></tr></table></figure></li>
</ol>
<blockquote>
<p>镜像上传到腾讯云</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、登陆</span></span><br><span class="line">docker login --username=100015827964 ccr.ccs.tencentyun.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、拉取</span></span><br><span class="line">docker pull ccr.ccs.tencentyun.com/zzrfhc_docker/hc_docker:[tag]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、推送</span></span><br><span class="line">docker login --username=100015827964 ccr.ccs.tencentyun.com</span><br><span class="line">docker tag [ImageId] ccr.ccs.tencentyun.com/zzrfhc_docker/hc_docker:[tag]</span><br><span class="line">docker push ccr.ccs.tencentyun.com/zzrfhc_docker/hc_docker:[tag]</span><br><span class="line"></span><br><span class="line">docker tag $(docker images|grep pod|awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span>) ccr.ccs.tencentyun.com/zzrfhc_docker/pod-infrastructure:laster</span><br><span class="line"></span><br><span class="line">docker push $(docker images|grep pod|awk <span class="string">&#x27;&#123;print $1&quot;:&quot;$2&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure>





<h3 id="5-6-docker-仓库（registry）"><a href="#5-6-docker-仓库（registry）" class="headerlink" title="5.6 docker 仓库（registry）"></a>5.6 docker 仓库（registry）</h3><h4 id="5-6-1-创建仓库"><a href="#5-6-1-创建仓库" class="headerlink" title="5.6.1 创建仓库"></a>5.6.1 创建仓库</h4><p>1、创建仓库</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 5000:5000 --restart=always --name registry -v /opt/myregistry:/var/lib/registry  registry </span><br></pre></td></tr></table></figure>

<p>2、修改配置文件，使之支持http</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]<span class="comment"># cat  /etc/docker/daemon.json </span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://a5dwl7z9.mirror.aliyuncs.com&quot;</span>],</span><br><span class="line">  <span class="string">&quot;insecure-registries&quot;</span>: [<span class="string">&quot;i8023.icu:5000&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重启docker让修改生效</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]<span class="comment"># systemctl restart  docker.service</span></span><br></pre></td></tr></table></figure>

<p>3、修改镜像标签</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]<span class="comment"># docker tag  busybox:latest  i8023.icu:5000/clsn/busybox:1.0</span></span><br><span class="line">[root@docker01 ~]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY                      TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">centos6-ssh                     latest              3c2b1e57a0f5        18 hours ago        393MB</span><br><span class="line">httpd                           2.4                 2e202f453940        6 days ago          179MB</span><br><span class="line">10.0.0.100:5000/clsn/busybox    1.0                 5b0d59026729        8 days ago          1.15MB</span><br></pre></td></tr></table></figure>

<p>4、将新打标签的镜像上传镜像到仓库</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]<span class="comment"># docker push   i8023.icu:5000/clsn/busybox</span></span><br></pre></td></tr></table></figure>

<h4 id="5-6-2-带basic认证的仓库"><a href="#5-6-2-带basic认证的仓库" class="headerlink" title="5.6.2 带basic认证的仓库"></a>5.6.2 带basic认证的仓库</h4><p>1、安装加密工具</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 clsn]<span class="comment"># yum install httpd-tools  -y</span></span><br></pre></td></tr></table></figure>

<p>2、设置认证密码</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /opt/registry-var/auth/ -p</span><br><span class="line">htpasswd  -Bbn clsn 123456  &gt; /opt/registry-var/auth/htpasswd</span><br></pre></td></tr></table></figure>

<p>3、启动容器，在启动时传入认证参数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 5000:5000 -v /opt/registry-var/auth/:/auth/ -e <span class="string">&quot;REGISTRY_AUTH=htpasswd&quot;</span> -e <span class="string">&quot;REGISTRY_AUTH_HTPASSWD_REALM=Registry Realm&quot;</span> -e REGISTRY_AUTH_HTPASSWD_PATH=/auth/htpasswd registry</span><br></pre></td></tr></table></figure>

<p>4、使用验证用户测试</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 登陆用户</span></span><br><span class="line">[root@docker01 ~]<span class="comment"># docker login 10.0.0.100:5000 </span></span><br><span class="line">Username: clsn  </span><br><span class="line">Password: 123456</span><br><span class="line">Login Succeeded</span><br><span class="line"><span class="comment"># 推送镜像到仓库</span></span><br><span class="line">[root@docker01 ~]<span class="comment"># docker push 10.0.0.100:5000/clsn/busybox </span></span><br><span class="line">The push refers to repository [10.0.0.100:5000/clsn/busybox]</span><br><span class="line">4febd3792a1f: Pushed </span><br><span class="line">1.0: digest: sha256:4cee1979ba0bf7db9fc5d28fb7b798ca69ae95a47c5fecf46327720df4ff352d size: 527</span><br><span class="line"><span class="comment">#认证文件的保存位置</span></span><br><span class="line">[root@docker01 ~]<span class="comment"># cat .docker/config.json </span></span><br></pre></td></tr></table></figure>

<h3 id="5-7-企业级镜像仓库harbor"><a href="#5-7-企业级镜像仓库harbor" class="headerlink" title="5.7 企业级镜像仓库harbor"></a>5.7 企业级镜像仓库harbor</h3><p>1、安装docker、docker-compose</p>
<p>下载 harbor</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt &amp;&amp; https://storage.googleapis.com/harbor-releases/harbor-offline-installer-v1.3.0.tgz</span><br><span class="line">tar xf harbor-offline-installer-v1.3.0.tgz</span><br></pre></td></tr></table></figure>

<p>2、修改主机及web界面密码</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 harbor]<span class="comment"># vim harbor.cfg </span></span><br><span class="line">    ···</span><br><span class="line">    hostname = 10.0.0.100</span><br><span class="line">    harbor_admin_password = Harbor12345</span><br><span class="line">    ···</span><br></pre></td></tr></table></figure>

<p>3、执行安装脚本</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 harbor]<span class="comment"># ./install.sh</span></span><br></pre></td></tr></table></figure>

<p><img src="/Docker.assets/1609396672359.png" alt="1609396672359"></p>
<p>4、镜像推送到仓库的指定项目</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@docker02 ~]<span class="comment"># docker  tag centos:6.8  10.0.0.100/clsn/centos6.8:1.0</span></span><br><span class="line">[root@docker02 ~]<span class="comment">#  </span></span><br><span class="line">[root@docker02 ~]<span class="comment"># docker images </span></span><br><span class="line">REPOSITORY                  TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">busybox                     latest              5b0d59026729        8 days ago          1.15MB</span><br><span class="line">10.0.0.100/clsn/centos6.8   1.0                 6704d778b3ba        2 months ago        195MB</span><br><span class="line">centos                      6.8                 6704d778b3ba        2 months ago        195MB</span><br><span class="line">[root@docker02 ~]<span class="comment"># docker login 10.0.0.100</span></span><br><span class="line">Username: admin</span><br><span class="line">Password: </span><br><span class="line">Login Succeeded</span><br></pre></td></tr></table></figure>

<p>5、推送镜像</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@docker02 ~]<span class="comment"># docker push 10.0.0.100/clsn/centos6.8 </span></span><br><span class="line">The push refers to repository [10.0.0.100/clsn/centos6.8]</span><br><span class="line">e00c9229b481: Pushing  13.53MB/194.5MB</span><br></pre></td></tr></table></figure>





<h3 id="5-8-小结："><a href="#5-8-小结：" class="headerlink" title="5.8 小结："></a>5.8 小结：</h3><p><img src="/Docker.assets/1596769371079.png" alt="1596769371079"></p>
<h2 id="6、Docker-网络"><a href="#6、Docker-网络" class="headerlink" title="6、Docker 网络"></a>6、Docker 网络</h2><h3 id="6-1-理解Docker0"><a href="#6-1-理解Docker0" class="headerlink" title="6.1 理解Docker0"></a>6.1 理解Docker0</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker 是如何处理容器访问的</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动一个tomcat容器</span></span><br><span class="line">[root@hchost ~]# docker run -d -P --name tomcat01 tomcat</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看容器的内部网络地址，发现容器启动的时候会得到一个 eth0@if97 IP地址，docker分配的。</span></span><br><span class="line">[root@hchost ~]# docker exec -it tomcat01 ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">96: eth0@if97: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">宿主机和创建的容器可以互相ping通</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>原理</p>
</blockquote>
<ol>
<li><p>我们每启动一个docker容器，docker就会给docker容器分配一个ip，我们只要安装了docker，就会有一个网卡docker0，桥接模式，使用的技术是veth-pair技术！</p>
</li>
<li><p>再启动一个容器，发现又多了一对网卡</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">我们发现这个容器带来网卡，都是一对对的</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">veth-pair 就是一对的虚拟设备接口，他们都是成对出现的，一般连着协议，一段被此相连</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">正因为有这个特性，veth-pair 充当一个桥染，连接各种虚拟网络设备的</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Openstac,Docker容器之间的连接，OSV的连接，都是使用evth-pair技术</span></span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;测试发现两个容器间也是可以 ping 通的&#x3D;&#x3D;，都是通过桥接到docker0。</p>
</li>
<li><p>通过图形看两个容器间的通信</p>
<p><img src="/Docker.assets/1596807838579.png" alt="1596807838579"></p>
<p>tomcat01 和 tomcat02 之间互ping，其实是共用的一个路由器，即通过Docker0的，，大概是两种方式，一个是记录到路由表，一个是采用广播的方式。 </p>
<p>所有的容器不指定网络的情况下，都是docker0路由的，docker会给我们的容器分配一个默认的可用IP。</p>
</li>
</ol>
<blockquote>
<p>小结</p>
</blockquote>
<p>​	docker 使用的是Linux桥接，宿主机中是一个Docker容器的网桥 docker0</p>
<p><img src="/Docker.assets/1596808697231.png" alt="1596808697231"></p>
<p>​	Docker中的所有的网络接口都是虚拟的。虚拟的转发效率高!（内网传递文件）</p>
<p>​	只要容器删除，对应的网桥就没有了</p>
<h3 id="6-2-自定义网络"><a href="#6-2-自定义网络" class="headerlink" title="6.2 自定义网络"></a>6.2 自定义网络</h3><blockquote>
<p>查看所有的docker网络</p>
</blockquote>
<p><img src="/Docker.assets/1596819001634.png" alt="1596819001634"></p>
<p><strong>网络模式</strong></p>
<ul>
<li><p>bridge：桥接 docker(默认，自己创建也使用bridge模式）</p>
</li>
<li><p>none：不配置网络</p>
</li>
<li><p>host：和宿主机共享网络</p>
</li>
<li><p>container：容器网络连通！（用的少！局限很大，不建议）</p>
</li>
</ul>
<p><strong>测试</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">我们直接启动的命令，默认是有 --net bridge  这个就是我们的docker0</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下面两个是一样的</span></span><br><span class="line">docker run -d -P --name tomcat01 tomcat</span><br><span class="line">docker run -d -P --name tomcat01 --net bridge tomcat</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker0特点，默认，域名不能访问，--<span class="built_in">link</span>可以打通连接！</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">我们可以自定义一个网络</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--driver bridge			默认的桥接</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--subnet 192.168.0.0/16	子网掩码，IP地址可以从192.168.0.2 到 192.168.255.254</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--gateway 192.168.0.1		网关</span></span><br><span class="line">[root@hchost ~]# docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet</span><br><span class="line">48ceabfc6269dbc1c5421a458dcaa2c9222ec37af976e2c7d188f1cc45f50229</span><br><span class="line">[root@hchost ~]# docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">3c3c9f3b789c        bridge              bridge              local</span><br><span class="line">68621de96c42        host                host                local</span><br><span class="line">48ceabfc6269        mynet               bridge              local</span><br><span class="line">f51bc489a915        none                null                local</span><br></pre></td></tr></table></figure>

<p>查看自己创建的网络</p>
<p><img src="/Docker.assets/1596820194247.png" alt="1596820194247"></p>
<p>创建两个容器，查看网络配置</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">[root@hchost ~]# docker network inspect mynet</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;mynet&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;48ceabfc6269dbc1c5421a458dcaa2c9222ec37af976e2c7d188f1cc45f50229&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2020-08-08T01:03:53.282207022+08:00&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;192.168.0.0/16&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;192.168.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;</span><br><span class="line">            &quot;376a9ab5ae880e98d6b7eeaaff720818ea8c3f1e48c48ff062a740bf2bdb5722&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat02&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;dd5c473d404d192aae4bb29065e557f4ba21dfc1b9bf4255bb16bf8fdf1ae4f1&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:03&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.3/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;9132c85ae598773568c55b4ea666aef73f92c43862aff403e826c3ed6286f3e5&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat01&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;8cefa99faaf39ff02e33566a21a0b6c4f0cd4eb4b2f5e2c45ee685c050304813&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:02&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.2/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">再次测试 ping连接，不使用--<span class="built_in">link</span>也可以ping通</span></span><br><span class="line">[root@hchost ~]# docker exec -it tomcat01 ping 192.168.0.3</span><br><span class="line">PING 192.168.0.3 (192.168.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.0.3: icmp_seq=1 ttl=64 time=0.077 ms</span><br><span class="line">64 bytes from 192.168.0.3: icmp_seq=2 ttl=64 time=0.046 ms</span><br><span class="line">^C</span><br><span class="line">--- 192.168.0.3 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 received, 0% packet loss, time 999ms</span><br><span class="line">rtt min/avg/max/mdev = 0.046/0.061/0.077/0.017 ms</span><br><span class="line"></span><br><span class="line">[root@hchost ~]# docker exec -it tomcat01 ping tomcat02</span><br><span class="line">PING tomcat02 (192.168.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat02.mynet (192.168.0.3): icmp_seq=1 ttl=64 time=0.042 ms</span><br><span class="line">64 bytes from tomcat02.mynet (192.168.0.3): icmp_seq=2 ttl=64 time=0.048 ms</span><br><span class="line">^C</span><br><span class="line">--- tomcat02 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 received, 0% packet loss, time 1000ms</span><br><span class="line">rtt min/avg/max/mdev = 0.042/0.045/0.048/0.003 ms</span><br><span class="line"></span><br><span class="line">[root@hchost ~]# docker exec -it tomcat02 ping tomcat01</span><br><span class="line">PING tomcat01 (192.168.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat01.mynet (192.168.0.2): icmp_seq=1 ttl=64 time=0.041 ms</span><br><span class="line">64 bytes from tomcat01.mynet (192.168.0.2): icmp_seq=2 ttl=64 time=0.045 ms</span><br><span class="line">^C</span><br><span class="line">--- tomcat01 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 received, 0% packet loss, time 7ms</span><br><span class="line">rtt min/avg/max/mdev = 0.041/0.043/0.045/0.002 ms</span><br></pre></td></tr></table></figure>

<p>我们自定义的网络docker都已经帮我们维护好了对应的关系，推荐我们平时这样使用网络！</p>
<p><strong>好处：</strong><br>redis-不同的集群使用不同的网络，保证集群是安全和健康的</p>
<p>mysql-不同的集群使用不同的网络，保证集群是安全和健康的</p>
<h3 id="6-3-网络连通"><a href="#6-3-网络连通" class="headerlink" title="6.3 网络连通"></a>6.3 网络连通</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Usage:  docker network connect [OPTIONS] NETWORK CONTAINER</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试打通 tomcat01 mynet</span></span><br><span class="line">[root@hchost ~]# docker network connect mynet tomcat01</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看mynet信息</span></span><br></pre></td></tr></table></figure>

<p><img src="/Docker.assets/1596821620390.png" alt="1596821620390"></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">连通之后就是将tomcat01放到mynet网络下</span><br><span class="line"></span><br><span class="line">即所谓 的 一个容器，两个IP地址，如 阿里云，有 公网IP和内网IP</span><br></pre></td></tr></table></figure>

<p><strong>正常网卡和网卡直接是不能打通的，但是容器和网卡直接可以</strong></p>
<p><img src="/Docker.assets/1596821971711.png" alt="1596821971711"></p>
<p>结论：假设要跨网络操作别人，就需要使用docker network connect 连通…</p>
<h3 id="6-4-实战：部署Redis集群"><a href="#6-4-实战：部署Redis集群" class="headerlink" title="6.4 实战：部署Redis集群"></a>6.4 实战：部署Redis集群</h3><p>启动6个容器，3主3从，Master-Slave</p>
<p><img src="/Docker.assets/1596822549928.png" alt="1596822549928"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建网卡</span></span><br><span class="line">docker network create redis --subnet 172.38.0.0/16</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">通过脚本创建六个redis配置</span></span><br><span class="line">for port in $(seq 1 6); \</span><br><span class="line">do \</span><br><span class="line">mkdir -p /mydata/redis/node-$&#123;port&#125;/conf</span><br><span class="line">touch /mydata/redis/node-$&#123;port&#125;/conf/redis.conf</span><br><span class="line">cat &lt;&lt; EOF &gt;/mydata/redis/node-$&#123;port&#125;/conf/redis.conf</span><br><span class="line">port 6379</span><br><span class="line">bind 0.0.0.0</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">cluster-announce-ip 172.38.0.1$&#123;port&#125;</span><br><span class="line">cluster-announce-port 6379</span><br><span class="line">cluster-announce-bus-port 16379</span><br><span class="line">appendonly yes</span><br><span class="line">EOF</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">for port in $(seq 1 6); \</span><br><span class="line">do \</span><br><span class="line">docker run -p 637$&#123;port&#125;:6379 -p 1637$&#123;port&#125;:16379 --name redis-$&#123;port&#125; \</span><br><span class="line">-v /mydata/redis/node-$&#123;port&#125;/data:/data \</span><br><span class="line">-v /mydata/redis/node-$&#123;port&#125;/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.1$&#123;port&#125; redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf \</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">docker run -p 6371:6379 -p 16371:16379 --name redis-1 \</span><br><span class="line">-v /mydata/redis/node-1/data:/data \</span><br><span class="line">-v /mydata/redis/node-1/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.11 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line">[root@hchost /]# for port in $(seq 1 6); \</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="keyword">do</span> \</span></span><br><span class="line"><span class="language-bash">&gt; <span class="built_in">mkdir</span> -p /mydata/redis/node-<span class="variable">$&#123;port&#125;</span>/conf</span> </span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="built_in">touch</span> /mydata/redis/node-<span class="variable">$&#123;port&#125;</span>/conf/redis.conf</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt;/mydata/redis/node-$&#123;port&#125;/conf/redis.conf</span></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="string">port 6379</span></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="string">bind 0.0.0.0</span></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="string">cluster-enabled yes</span></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="string">cluster-config-file nodes.conf</span></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="string">cluster-node-timeout 5000</span></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="string">cluster-announce-ip 172.38.0.1$&#123;port&#125;</span></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="string">cluster-announce-port 6379</span></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="string">cluster-announce-bus-port 16379</span></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="string">appendonly yes</span></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="string">EOF</span></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="keyword">done</span></span></span><br><span class="line"></span><br><span class="line">[root@hchost conf]# for port in $(seq 1 6); \</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="keyword">do</span> \</span></span><br><span class="line"><span class="language-bash">&gt; docker run -p 637<span class="variable">$&#123;port&#125;</span>:6379 -p 1637<span class="variable">$&#123;port&#125;</span>:16379 --name redis-<span class="variable">$&#123;port&#125;</span> -v /mydata/redis/node-<span class="variable">$&#123;port&#125;</span>/data:/data -v /mydata/redis/node-<span class="variable">$&#123;port&#125;</span>/conf/redis.conf:/etc/redis/redis.conf -d --net redis --ip 172.38.0.1<span class="variable">$&#123;port&#125;</span> redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="keyword">done</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入集群，随便进一个即可，redis 是用的sh</span></span><br><span class="line">[root@hchost conf]# docker exec -it redis-1 /bin/sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建集群</span> </span><br><span class="line">redis-cli --cluster create 172.38.0.11:6379 172.38.0.12:6379 172.38.0.13:6379 172.38.0.14:6379 172.38.0.15:6379 172.38.0.16:6379 --cluster-replicas 1</span><br><span class="line"></span><br><span class="line">/data # redis-cli --cluster create 172.38.0.11:6379 172.38.0.12:6379 172.38.0.13:6379 172.38.0.14:6379 172.38.0.15:6379 172.38.0.16:6379 --cluster-replicas 1</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Performing <span class="built_in">hash</span> slots allocation on 6 nodes...</span></span><br><span class="line">Master[0] -&gt; Slots 0 - 5460</span><br><span class="line">Master[1] -&gt; Slots 5461 - 10922</span><br><span class="line">Master[2] -&gt; Slots 10923 - 16383</span><br><span class="line">Adding replica 172.38.0.15:6379 to 172.38.0.11:6379</span><br><span class="line">Adding replica 172.38.0.16:6379 to 172.38.0.12:6379</span><br><span class="line">Adding replica 172.38.0.14:6379 to 172.38.0.13:6379</span><br><span class="line">M: 6851ddbc71ce9ecceb50b4b9ca017cf1e730225f 172.38.0.11:6379</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">M: ef00325f6245362096b1c09b79efd5e624be1441 172.38.0.12:6379</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">M: 41bc1a806a949289e807cd3e4e5277d20a0c7f60 172.38.0.13:6379</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">S: 2647b2c74f1a819337e7af3a7e8972bf59a044ef 172.38.0.14:6379</span><br><span class="line">   replicates 41bc1a806a949289e807cd3e4e5277d20a0c7f60</span><br><span class="line">S: 6d02717d00ac2529fc14a5779bc1d150cdd32d6e 172.38.0.15:6379</span><br><span class="line">   replicates 6851ddbc71ce9ecceb50b4b9ca017cf1e730225f</span><br><span class="line">S: 7f49b4f3fcc19882f82430d3f4121f276a3531d9 172.38.0.16:6379</span><br><span class="line">   replicates ef00325f6245362096b1c09b79efd5e624be1441</span><br><span class="line">Can I set the above configuration? (type &#x27;yes&#x27; to accept): yes</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Nodes configuration updated</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Assign a different config epoch to each node</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Sending CLUSTER MEET messages to <span class="built_in">join</span> the cluster</span></span><br><span class="line">Waiting for the cluster to join</span><br><span class="line">...</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Performing Cluster Check (using node 172.38.0.11:6379)</span></span><br><span class="line">M: 6851ddbc71ce9ecceb50b4b9ca017cf1e730225f 172.38.0.11:6379</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 2647b2c74f1a819337e7af3a7e8972bf59a044ef 172.38.0.14:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 41bc1a806a949289e807cd3e4e5277d20a0c7f60</span><br><span class="line">M: ef00325f6245362096b1c09b79efd5e624be1441 172.38.0.12:6379</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 7f49b4f3fcc19882f82430d3f4121f276a3531d9 172.38.0.16:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates ef00325f6245362096b1c09b79efd5e624be1441</span><br><span class="line">M: 41bc1a806a949289e807cd3e4e5277d20a0c7f60 172.38.0.13:6379</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 6d02717d00ac2529fc14a5779bc1d150cdd32d6e 172.38.0.15:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 6851ddbc71ce9ecceb50b4b9ca017cf1e730225f</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Check <span class="keyword">for</span> open slots...</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Check slots coverage...</span></span><br><span class="line">[OK] All 16384 slots covered.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入集群  redis-cli是单机  -c 是集群</span></span><br><span class="line">/data # redis-cli -c</span><br><span class="line">127.0.0.1:6379&gt; </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看集群信息  cluster info</span></span><br><span class="line">127.0.0.1:6379&gt; cluster info</span><br><span class="line">cluster_state:ok</span><br><span class="line">cluster_slots_assigned:16384</span><br><span class="line">cluster_slots_ok:16384</span><br><span class="line">cluster_slots_pfail:0</span><br><span class="line">cluster_slots_fail:0</span><br><span class="line">cluster_known_nodes:6</span><br><span class="line">cluster_size:3</span><br><span class="line">cluster_current_epoch:6</span><br><span class="line">cluster_my_epoch:1</span><br><span class="line">cluster_stats_messages_ping_sent:2331</span><br><span class="line">cluster_stats_messages_pong_sent:2349</span><br><span class="line">cluster_stats_messages_sent:4680</span><br><span class="line">cluster_stats_messages_ping_received:2344</span><br><span class="line">cluster_stats_messages_pong_received:2331</span><br><span class="line">cluster_stats_messages_meet_received:5</span><br><span class="line">cluster_stats_messages_received:4680</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看节点</span></span><br><span class="line">127.0.0.1:6379&gt; cluster nodes</span><br><span class="line">2647b2c74f1a819337e7af3a7e8972bf59a044ef 172.38.0.14:6379@16379 slave 41bc1a806a949289e807cd3e4e5277d20a0c7f60 0 1596858049589 4 connected</span><br><span class="line">ef00325f6245362096b1c09b79efd5e624be1441 172.38.0.12:6379@16379 master - 0 1596858049000 2 connected 5461-10922</span><br><span class="line">7f49b4f3fcc19882f82430d3f4121f276a3531d9 172.38.0.16:6379@16379 slave ef00325f6245362096b1c09b79efd5e624be1441 0 1596858050000 6 connected</span><br><span class="line">41bc1a806a949289e807cd3e4e5277d20a0c7f60 172.38.0.13:6379@16379 master - 0 1596858050000 3 connected 10923-16383</span><br><span class="line">6d02717d00ac2529fc14a5779bc1d150cdd32d6e 172.38.0.15:6379@16379 slave 6851ddbc71ce9ecceb50b4b9ca017cf1e730225f 0 1596858050791 5 connected</span><br><span class="line">6851ddbc71ce9ecceb50b4b9ca017cf1e730225f 172.38.0.11:6379@16379 myself,master - 0 1596858049000 1 connected 0-5460</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">看到是分配到12主机上</span></span><br><span class="line">172.38.0.13:6379&gt; set c d</span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash">Redirected to slot [7365] located at 172.38.0.12:6379</span></span><br><span class="line">OK</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">停止12容器，获取value,发现从机16处理了</span></span><br><span class="line">127.0.0.1:6379&gt; get c</span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash">Redirected to slot [7365] located at 172.38.0.16:6379</span></span><br><span class="line">&quot;d&quot;</span><br></pre></td></tr></table></figure>





<h2 id="7、Docker-Compose"><a href="#7、Docker-Compose" class="headerlink" title="7、Docker Compose"></a>7、Docker Compose</h2><h3 id="7-1-简介"><a href="#7-1-简介" class="headerlink" title="7.1 简介"></a>7.1 简介</h3><p>&#x3D;&#x3D;轻松高效的管理多个容器&#x3D;&#x3D;</p>
<blockquote>
<p>官网文档   <a target="_blank" rel="noopener" href="https://docs.docker.com/compose/">https://docs.docker.com/compose/</a> </p>
</blockquote>
<p>Compose is a tool for defining and running multi-container Docker applications. With Compose, you use a YAML file to configure your application’s services. Then, with a single command, you create and start all the services from your configuration. To learn more about all the features of Compose, see <a target="_blank" rel="noopener" href="https://docs.docker.com/compose/#features">the list of features</a>.</p>
<p>Compose works in all environments: production, staging, development, testing, as well as CI workflows. You can learn more about each case in <a target="_blank" rel="noopener" href="https://docs.docker.com/compose/#common-use-cases">Common Use Cases</a>.</p>
<p>Using Compose is basically a three-step process:</p>
<ol>
<li>Define your app’s environment with a <code>Dockerfile</code> so it can be reproduced anywhere.<ul>
<li>Dockerfile 保证我们的容器在任何地方可以运行</li>
</ul>
</li>
<li>Define the services that make up your app in <code>docker-compose.yml</code> so they can be run together in an isolated environment.</li>
<li>Run <code>docker-compose up</code> and Compose starts and runs your entire app.</li>
</ol>
<ul>
<li><p>使用Compose包含三个最基本步骤：</p>
<p>1、定义Dockerfile文件，该文件定义了应用环境（镜像的构建）</p>
<p>2、定义docker-compose.yml文件，该文件定义了组成应用的服务</p>
<p>3、运行docker-compose up命令</p>
<p># 启动所有服务</p>
<p>$ docker-compose up</p>
<p># 关闭所有服务</p>
<p>$ docker-compose stop</p>
</li>
</ul>
<p><strong>作用：批量容器编排。</strong></p>
<blockquote>
<p>自己的理解</p>
</blockquote>
<p>Compose 是 Docker 官方的开源项目。需要安装！</p>
<p>Dockerfile 让程序在任何地方运行，web服务。redis、mysql、nginx….多个容器。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;2.0&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;5000:5000&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">.:/code</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">logvolume01:/var/log</span></span><br><span class="line">    <span class="attr">links:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">logvolume01:</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>Compose：重要的概念</p>
<ul>
<li><p>服务services，容器，应用。(web，redis，mysql…)</p>
</li>
<li><p>项目project，一组关联的容器。博客。web、mysql</p>
</li>
</ul>
<h3 id="7-2-安装"><a href="#7-2-安装" class="headerlink" title="7.2 安装"></a>7.2 安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载，官方的地址估计很慢</span></span><br><span class="line">sudo curl -L &quot;https://github.com/docker/compose/releases/download/1.26.2/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">这个估计快点</span></span><br><span class="line">curl -L https://get.daocloud.io/docker/compose/releases/domnload/1.25.5/docker-compose-`uname-s`-`uname-m` &gt; /usr/local/bin/docker-compose</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果第一步没有下载下来，我们就手动去网址下载即可！</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">地址：https://github.com/docker/compose/releases</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载：docker-compose-Linux-×86.64</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">然后将文件上转到/usr/local/bin/文件夹下，然后将其重命名为docker-compose</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">第二步，修改此文件的权限，增加可执行</span></span><br><span class="line">sudo chmod +x /usr/local/bin/docker-compose</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">第三步，查看是否安装成功</span></span><br><span class="line">docker-compose --version</span><br><span class="line">[root@hchost bin]# docker-compose version</span><br><span class="line">docker-compose version 1.26.2, build eefe0d31</span><br><span class="line">docker-py version: 4.2.2</span><br><span class="line">CPython version: 3.7.7</span><br><span class="line">OpenSSL version: OpenSSL 1.1.0l  10 Sep 2019</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建软连接，加到环境变量中，可以在别的路径下直接使用docker-compose</span></span><br><span class="line">sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">卸载docker-compose</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">To uninstall Docker Compose <span class="keyword">if</span> you installed using curl:</span></span><br><span class="line">sudo rm /usr/local/bin/docker-compose</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">To uninstall Docker Compose <span class="keyword">if</span> you installed using pip:</span></span><br><span class="line">pip uninstall docker-compose</span><br></pre></td></tr></table></figure>

<h3 id="7-3-体验"><a href="#7-3-体验" class="headerlink" title="7.3 体验"></a>7.3 体验</h3><p>地址： <a target="_blank" rel="noopener" href="https://docs.docker.com/compose/gettingstarted/">https://docs.docker.com/compose/gettingstarted/</a> </p>
<p>python应用。计数器。redis！</p>
<p>1、应用app.py	 requirements.txt </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建测试目录</span></span><br><span class="line">[root@hchost home]# mkdir composetest</span><br><span class="line">[root@hchost home]# cd composetest/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建app.py文件</span></span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">import redis</span><br><span class="line">from flask import Flask</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">cache = redis.Redis(host=&#x27;redis&#x27;, port=6379)</span><br><span class="line"></span><br><span class="line">def get_hit_count():</span><br><span class="line">    retries = 5</span><br><span class="line">    while True:</span><br><span class="line">        try:</span><br><span class="line">            return cache.incr(&#x27;hits&#x27;)</span><br><span class="line">        except redis.exceptions.ConnectionError as exc:</span><br><span class="line">            if retries == 0:</span><br><span class="line">                raise exc</span><br><span class="line">            retries -= 1</span><br><span class="line">            time.sleep(0.5)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/&#x27;)</span><br><span class="line">def hello():</span><br><span class="line">    count = get_hit_count()</span><br><span class="line">    return &#x27;Hello World! I have been seen &#123;&#125; times.\n&#x27;.format(count)</span><br><span class="line">    </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建导入包文件 requirements.txt</span></span><br><span class="line">flask</span><br><span class="line">redis</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、Dockerfile 应用打包为镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建Dockerfile</span></span><br><span class="line">FROM python:3.7-alpine</span><br><span class="line">WORKDIR /code</span><br><span class="line">ENV FLASK_APP app.py</span><br><span class="line">ENV FLASK_RUN_HOST 0.0.0.0</span><br><span class="line">RUN apk add --no-cache gcc musl-dev linux-headers</span><br><span class="line">COPY requirements.txt requirements.txt</span><br><span class="line">RUN pip install -r requirements.txt</span><br><span class="line">EXPOSE 5000</span><br><span class="line">COPY . .</span><br><span class="line">CMD [&quot;flask&quot;, &quot;run&quot;]</span><br></pre></td></tr></table></figure>

<p>3、Docker-compose yaml文件（定义整个服务，需要的环境。web、redis)完整的上线服务！</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建docker-compose.yml</span></span><br><span class="line">version: &#x27;3&#x27;</span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    build: .</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;5000:5000&quot;</span><br><span class="line">  redis:</span><br><span class="line">    image: &quot;redis:alpine&quot;</span><br></pre></td></tr></table></figure>

<p>4、启动compose 项目（ docker-compose up )</p>
<p>启动成功后看到对应的服务起来了</p>
<p><img src="/Docker.assets/1597065957680.png" alt="1597065957680"></p>
<p>默认的服务名：文件名_ 服务名_ num</p>
<p>网络也是默认创建好的</p>
<p><img src="/Docker.assets/1597066668743.png" alt="1597066668743"></p>
<p>docker-compose</p>
<p>以前都是单个docker run 启动容器。</p>
<p>docker-compose。通过 docker-compose 编写yaml配置文件、可以通过compose 一键启动所有服务，停止。！</p>
<p><strong>Docker小结：</strong></p>
<p>1、Docker镜像。run&#x3D;&gt;容器</p>
<p>2、DockerFile 构建镜像（服务打包）</p>
<p>3、docker-compose 启动项目（编排、多个微服务&#x2F;环境）</p>
<p>4、Docker网络！</p>
<h3 id="7-4-yaml规则"><a href="#7-4-yaml规则" class="headerlink" title="7.4 yaml规则"></a>7.4 yaml规则</h3><blockquote>
<p>核心		 <a target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/">https://docs.docker.com/compose/compose-file/</a> </p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3层</span></span><br><span class="line">version:&#x27;&#x27;	# 版本 </span><br><span class="line">services:	# 服务 </span><br><span class="line">	服务1：web </span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">服务配置</span> </span><br><span class="line">	images </span><br><span class="line">	build </span><br><span class="line">	network</span><br><span class="line">    ......</span><br><span class="line">	服务2：redis</span><br><span class="line">    ......</span><br><span class="line">	服务3：db</span><br><span class="line">    ......</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">其他配置网络/卷、全局规则</span> </span><br><span class="line">volumes:</span><br><span class="line">networks:</span><br><span class="line">configs:</span><br></pre></td></tr></table></figure>

<p><img src="/Docker.assets/1597067774226.png" alt="1597067774226"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br></pre></td><td class="code"><pre><span class="line">Compose和Docker兼容性：</span><br><span class="line">    Compose 文件格式有3个版本,分别为1, 2.x 和 3.x</span><br><span class="line">    目前主流的为 3.x 其支持 docker 1.13.0 及其以上的版本</span><br><span class="line"> </span><br><span class="line">常用参数：</span><br><span class="line">    version           # 指定 compose 文件的版本</span><br><span class="line">    services          # 定义所有的 service 信息, services 下面的第一级别的 key 既是一个 service 的名称</span><br><span class="line"> </span><br><span class="line">        build                 # 指定包含构建上下文的路径, 或作为一个对象，该对象具有 context 和指定的 dockerfile 文件以及 args 参数值</span><br><span class="line">            context               # context: 指定 Dockerfile 文件所在的路径</span><br><span class="line">            dockerfile            # dockerfile: 指定 context 指定的目录下面的 Dockerfile 的名称(默认为 Dockerfile)</span><br><span class="line">            args                  # args: Dockerfile 在 build 过程中需要的参数 (等同于 docker container build --build-arg 的作用)</span><br><span class="line">            cache_from            # v3.2中新增的参数, 指定缓存的镜像列表 (等同于 docker container build --cache_from 的作用)</span><br><span class="line">            labels                # v3.3中新增的参数, 设置镜像的元数据 (等同于 docker container build --labels 的作用)</span><br><span class="line">            shm_size              # v3.5中新增的参数, 设置容器 /dev/shm 分区的大小 (等同于 docker container build --shm-size 的作用)</span><br><span class="line"> </span><br><span class="line">        command               # 覆盖容器启动后默认执行的命令, 支持 shell 格式和 [] 格式</span><br><span class="line"> </span><br><span class="line">        configs               # 不知道怎么用</span><br><span class="line"> </span><br><span class="line">        cgroup_parent         # 不知道怎么用</span><br><span class="line"> </span><br><span class="line">        container_name        # 指定容器的名称 (等同于 docker run --name 的作用)</span><br><span class="line"> </span><br><span class="line">        credential_spec       # 不知道怎么用</span><br><span class="line"> </span><br><span class="line">        deploy                # v3 版本以上, 指定与部署和运行服务相关的配置, deploy 部分是 docker stack 使用的, docker stack 依赖 docker swarm</span><br><span class="line">            endpoint_mode         # v3.3 版本中新增的功能, 指定服务暴露的方式</span><br><span class="line">                vip                   # Docker 为该服务分配了一个虚拟 IP(VIP), 作为客户端的访问服务的地址</span><br><span class="line">                dnsrr                 # DNS轮询, Docker 为该服务设置 DNS 条目, 使得服务名称的 DNS 查询返回一个 IP 地址列表, 客户端直接访问其中的一个地址</span><br><span class="line">            labels                # 指定服务的标签，这些标签仅在服务上设置</span><br><span class="line">            mode                  # 指定 deploy 的模式</span><br><span class="line">                global                # 每个集群节点都只有一个容器</span><br><span class="line">                replicated            # 用户可以指定集群中容器的数量(默认)</span><br><span class="line">            placement             # 不知道怎么用</span><br><span class="line">            replicas              # deploy 的 mode 为 replicated 时, 指定容器副本的数量</span><br><span class="line">            resources             # 资源限制</span><br><span class="line">                limits                # 设置容器的资源限制</span><br><span class="line">                    cpus: &quot;0.5&quot;           # 设置该容器最多只能使用 50% 的 CPU </span><br><span class="line">                    memory: 50M           # 设置该容器最多只能使用 50M 的内存空间 </span><br><span class="line">                reservations          # 设置为容器预留的系统资源(随时可用)</span><br><span class="line">                    cpus: &quot;0.2&quot;           # 为该容器保留 20% 的 CPU</span><br><span class="line">                    memory: 20M           # 为该容器保留 20M 的内存空间</span><br><span class="line">            restart_policy        # 定义容器重启策略, 用于代替 restart 参数</span><br><span class="line">                condition             # 定义容器重启策略(接受三个参数)</span><br><span class="line">                    none                  # 不尝试重启</span><br><span class="line">                    on-failure            # 只有当容器内部应用程序出现问题才会重启</span><br><span class="line">                    any                   # 无论如何都会尝试重启(默认)</span><br><span class="line">                delay                 # 尝试重启的间隔时间(默认为 0s)</span><br><span class="line">                max_attempts          # 尝试重启次数(默认一直尝试重启)</span><br><span class="line">                window                # 检查重启是否成功之前的等待时间(即如果容器启动了, 隔多少秒之后去检测容器是否正常, 默认 0s)</span><br><span class="line">            update_config         # 用于配置滚动更新配置</span><br><span class="line">                parallelism           # 一次性更新的容器数量</span><br><span class="line">                delay                 # 更新一组容器之间的间隔时间</span><br><span class="line">                failure_action        # 定义更新失败的策略</span><br><span class="line">                    continue              # 继续更新</span><br><span class="line">                    rollback              # 回滚更新</span><br><span class="line">                    pause                 # 暂停更新(默认)</span><br><span class="line">                monitor               # 每次更新后的持续时间以监视更新是否失败(单位: ns|us|ms|s|m|h) (默认为0)</span><br><span class="line">                max_failure_ratio     # 回滚期间容忍的失败率(默认值为0)</span><br><span class="line">                order                 # v3.4 版本中新增的参数, 回滚期间的操作顺序</span><br><span class="line">                    stop-first            #旧任务在启动新任务之前停止(默认)</span><br><span class="line">                    start-first           #首先启动新任务, 并且正在运行的任务暂时重叠</span><br><span class="line">            rollback_config       # v3.7 版本中新增的参数, 用于定义在 update_config 更新失败的回滚策略</span><br><span class="line">                parallelism           # 一次回滚的容器数, 如果设置为0, 则所有容器同时回滚</span><br><span class="line">                delay                 # 每个组回滚之间的时间间隔(默认为0)</span><br><span class="line">                failure_action        # 定义回滚失败的策略</span><br><span class="line">                    continue              # 继续回滚</span><br><span class="line">                    pause                 # 暂停回滚</span><br><span class="line">                monitor               # 每次回滚任务后的持续时间以监视失败(单位: ns|us|ms|s|m|h) (默认为0)</span><br><span class="line">                max_failure_ratio     # 回滚期间容忍的失败率(默认值0)</span><br><span class="line">                order                 # 回滚期间的操作顺序</span><br><span class="line">                    stop-first            # 旧任务在启动新任务之前停止(默认)</span><br><span class="line">                    start-first           # 首先启动新任务, 并且正在运行的任务暂时重叠</span><br><span class="line"> </span><br><span class="line">            注意：</span><br><span class="line">                支持 docker-compose up 和 docker-compose run 但不支持 docker stack deploy 的子选项</span><br><span class="line">                security_opt  container_name  devices  tmpfs  stop_signal  links    cgroup_parent</span><br><span class="line">                network_mode  external_links  restart  build  userns_mode  sysctls</span><br><span class="line"> </span><br><span class="line">        devices               # 指定设备映射列表 (等同于 docker run --device 的作用)</span><br><span class="line"> </span><br><span class="line">        depends_on            # 定义容器启动顺序 (此选项解决了容器之间的依赖关系， 此选项在 v3 版本中 使用 swarm 部署时将忽略该选项)</span><br><span class="line">            示例：</span><br><span class="line">                docker-compose up 以依赖顺序启动服务，下面例子中 redis 和 db 服务在 web 启动前启动</span><br><span class="line">                默认情况下使用 docker-compose up web 这样的方式启动 web 服务时，也会启动 redis 和 db 两个服务，因为在配置文件中定义了依赖关系</span><br><span class="line"> </span><br><span class="line">                version: &#x27;3&#x27;</span><br><span class="line">                services:</span><br><span class="line">                    web:</span><br><span class="line">                        build: .</span><br><span class="line">                        depends_on:</span><br><span class="line">                            - db      </span><br><span class="line">                            - redis  </span><br><span class="line">                    redis:</span><br><span class="line">                        image: redis</span><br><span class="line">                    db:</span><br><span class="line">                        image: postgres                             </span><br><span class="line"> </span><br><span class="line">        dns                   # 设置 DNS 地址(等同于 docker run --dns 的作用)</span><br><span class="line"> </span><br><span class="line">        dns_search            # 设置 DNS 搜索域(等同于 docker run --dns-search 的作用)</span><br><span class="line"> </span><br><span class="line">        tmpfs                 # v2 版本以上, 挂载目录到容器中, 作为容器的临时文件系统(等同于 docker run --tmpfs 的作用, 在使用 swarm 部署时将忽略该选项)</span><br><span class="line"> </span><br><span class="line">        entrypoint            # 覆盖容器的默认 entrypoint 指令 (等同于 docker run --entrypoint 的作用)</span><br><span class="line"> </span><br><span class="line">        env_file              # 从指定文件中读取变量设置为容器中的环境变量, 可以是单个值或者一个文件列表, 如果多个文件中的变量重名则后面的变量覆盖前面的变量, environment 的值覆盖 env_file 的值</span><br><span class="line">            文件格式：</span><br><span class="line">                RACK_ENV=development </span><br><span class="line"> </span><br><span class="line">        environment           # 设置环境变量， environment 的值可以覆盖 env_file 的值 (等同于 docker run --env 的作用)</span><br><span class="line"> </span><br><span class="line">        expose                # 暴露端口, 但是不能和宿主机建立映射关系, 类似于 Dockerfile 的 EXPOSE 指令</span><br><span class="line"> </span><br><span class="line">        external_links        # 连接不在 docker-compose.yml 中定义的容器或者不在 compose 管理的容器(docker run 启动的容器, 在 v3 版本中使用 swarm 部署时将忽略该选项)</span><br><span class="line"> </span><br><span class="line">        extra_hosts           # 添加 host 记录到容器中的 /etc/hosts 中 (等同于 docker run --add-host 的作用)</span><br><span class="line"> </span><br><span class="line">        healthcheck           # v2.1 以上版本, 定义容器健康状态检查, 类似于 Dockerfile 的 HEALTHCHECK 指令</span><br><span class="line">            test                  # 检查容器检查状态的命令, 该选项必须是一个字符串或者列表, 第一项必须是 NONE, CMD 或 CMD-SHELL, 如果其是一个字符串则相当于 CMD-SHELL 加该字符串</span><br><span class="line">                NONE                  # 禁用容器的健康状态检测</span><br><span class="line">                CMD                   # test: [&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost&quot;]</span><br><span class="line">                CMD-SHELL             # test: [&quot;CMD-SHELL&quot;, &quot;curl -f http://localhost || exit 1&quot;] 或者　test: curl -f https://localhost || exit 1</span><br><span class="line">            interval: 1m30s       # 每次检查之间的间隔时间</span><br><span class="line">            timeout: 10s          # 运行命令的超时时间</span><br><span class="line">            retries: 3            # 重试次数</span><br><span class="line">            start_period: 40s     # v3.4 以上新增的选项, 定义容器启动时间间隔</span><br><span class="line">            disable: true         # true 或 false, 表示是否禁用健康状态检测和　test: NONE 相同</span><br><span class="line"> </span><br><span class="line">        image                 # 指定 docker 镜像, 可以是远程仓库镜像、本地镜像</span><br><span class="line"> </span><br><span class="line">        init                  # v3.7 中新增的参数, true 或 false 表示是否在容器中运行一个 init, 它接收信号并传递给进程</span><br><span class="line"> </span><br><span class="line">        isolation             # 隔离容器技术, 在 Linux 中仅支持 default 值</span><br><span class="line"> </span><br><span class="line">        labels                # 使用 Docker 标签将元数据添加到容器, 与 Dockerfile 中的 LABELS 类似</span><br><span class="line"> </span><br><span class="line">        links                 # 链接到其它服务中的容器, 该选项是 docker 历史遗留的选项, 目前已被用户自定义网络名称空间取代, 最终有可能被废弃 (在使用 swarm 部署时将忽略该选项)</span><br><span class="line"> </span><br><span class="line">        logging               # 设置容器日志服务</span><br><span class="line">            driver                # 指定日志记录驱动程序, 默认 json-file (等同于 docker run --log-driver 的作用)</span><br><span class="line">            options               # 指定日志的相关参数 (等同于 docker run --log-opt 的作用)</span><br><span class="line">                max-size              # 设置单个日志文件的大小, 当到达这个值后会进行日志滚动操作</span><br><span class="line">                max-file              # 日志文件保留的数量</span><br><span class="line"> </span><br><span class="line">        network_mode          # 指定网络模式 (等同于 docker run --net 的作用, 在使用 swarm 部署时将忽略该选项)         </span><br><span class="line"> </span><br><span class="line">        networks              # 将容器加入指定网络 (等同于 docker network connect 的作用), networks 可以位于 compose 文件顶级键和 services 键的二级键</span><br><span class="line">            aliases               # 同一网络上的容器可以使用服务名称或别名连接到其中一个服务的容器</span><br><span class="line">            ipv4_address      # IP V4 格式</span><br><span class="line">            ipv6_address      # IP V6 格式</span><br><span class="line"> </span><br><span class="line">            示例:</span><br><span class="line">                version: &#x27;3.7&#x27;</span><br><span class="line">                services: </span><br><span class="line">                    test: </span><br><span class="line">                        image: nginx:1.14-alpine</span><br><span class="line">                        container_name: mynginx</span><br><span class="line">                        command: ifconfig</span><br><span class="line">                        networks: </span><br><span class="line">                            app_net:                                # 调用下面 networks 定义的 app_net 网络</span><br><span class="line">                            ipv4_address: 172.16.238.10</span><br><span class="line">                networks:</span><br><span class="line">                    app_net:</span><br><span class="line">                        driver: bridge</span><br><span class="line">                        ipam:</span><br><span class="line">                            driver: default</span><br><span class="line">                            config:</span><br><span class="line">                                - subnet: 172.16.238.0/24</span><br><span class="line"> </span><br><span class="line">        pid: &#x27;host&#x27;           # 共享宿主机的 进程空间(PID)</span><br><span class="line"> </span><br><span class="line">        ports                 # 建立宿主机和容器之间的端口映射关系, ports 支持两种语法格式</span><br><span class="line">            SHORT 语法格式示例:</span><br><span class="line">                - &quot;3000&quot;                            # 暴露容器的 3000 端口, 宿主机的端口由 docker 随机映射一个没有被占用的端口</span><br><span class="line">                - &quot;3000-3005&quot;                       # 暴露容器的 3000 到 3005 端口, 宿主机的端口由 docker 随机映射没有被占用的端口</span><br><span class="line">                - &quot;8000:8000&quot;                       # 容器的 8000 端口和宿主机的 8000 端口建立映射关系</span><br><span class="line">                - &quot;9090-9091:8080-8081&quot;</span><br><span class="line">                - &quot;127.0.0.1:8001:8001&quot;             # 指定映射宿主机的指定地址的</span><br><span class="line">                - &quot;127.0.0.1:5000-5010:5000-5010&quot;   </span><br><span class="line">                - &quot;6060:6060/udp&quot;                   # 指定协议</span><br><span class="line"> </span><br><span class="line">            LONG 语法格式示例:(v3.2 新增的语法格式)</span><br><span class="line">                ports:</span><br><span class="line">                    - target: 80                    # 容器端口</span><br><span class="line">                      published: 8080               # 宿主机端口</span><br><span class="line">                      protocol: tcp                 # 协议类型</span><br><span class="line">                      mode: host                    # host 在每个节点上发布主机端口,  ingress 对于群模式端口进行负载均衡</span><br><span class="line"> </span><br><span class="line">        secrets               # 不知道怎么用</span><br><span class="line"> </span><br><span class="line">        security_opt          # 为每个容器覆盖默认的标签 (在使用 swarm 部署时将忽略该选项)</span><br><span class="line"> </span><br><span class="line">        stop_grace_period     # 指定在发送了 SIGTERM 信号之后, 容器等待多少秒之后退出(默认 10s)</span><br><span class="line"> </span><br><span class="line">        stop_signal           # 指定停止容器发送的信号 (默认为 SIGTERM 相当于 kill PID; SIGKILL 相当于 kill -9 PID; 在使用 swarm 部署时将忽略该选项)</span><br><span class="line"> </span><br><span class="line">        sysctls               # 设置容器中的内核参数 (在使用 swarm 部署时将忽略该选项)</span><br><span class="line"> </span><br><span class="line">        ulimits               # 设置容器的 limit</span><br><span class="line"> </span><br><span class="line">        userns_mode           # 如果Docker守护程序配置了用户名称空间, 则禁用此服务的用户名称空间 (在使用 swarm 部署时将忽略该选项)</span><br><span class="line"> </span><br><span class="line">        volumes               # 定义容器和宿主机的卷映射关系, 其和 networks 一样可以位于 services 键的二级键和 compose 顶级键, 如果需要跨服务间使用则在顶级键定义, 在 services 中引用</span><br><span class="line">            SHORT 语法格式示例:</span><br><span class="line">                volumes:</span><br><span class="line">                    - /var/lib/mysql                # 映射容器内的 /var/lib/mysql 到宿主机的一个随机目录中</span><br><span class="line">                    - /opt/data:/var/lib/mysql      # 映射容器内的 /var/lib/mysql 到宿主机的 /opt/data</span><br><span class="line">                    - ./cache:/tmp/cache            # 映射容器内的 /var/lib/mysql 到宿主机 compose 文件所在的位置</span><br><span class="line">                    - ~/configs:/etc/configs/:ro    # 映射容器宿主机的目录到容器中去, 权限只读</span><br><span class="line">                    - datavolume:/var/lib/mysql     # datavolume 为 volumes 顶级键定义的目录, 在此处直接调用</span><br><span class="line"> </span><br><span class="line">            LONG 语法格式示例:(v3.2 新增的语法格式)</span><br><span class="line">                version: &quot;3.2&quot;</span><br><span class="line">                services:</span><br><span class="line">                    web:</span><br><span class="line">                        image: nginx:alpine</span><br><span class="line">                        ports:</span><br><span class="line">                            - &quot;80:80&quot;</span><br><span class="line">                        volumes:</span><br><span class="line">                            - type: volume                  # mount 的类型, 必须是 bind、volume 或 tmpfs</span><br><span class="line">                                source: mydata              # 宿主机目录</span><br><span class="line">                                target: /data               # 容器目录</span><br><span class="line">                                volume:                     # 配置额外的选项, 其 key 必须和 type 的值相同</span><br><span class="line">                                    nocopy: true                # volume 额外的选项, 在创建卷时禁用从容器复制数据</span><br><span class="line">                            - type: bind                    # volume 模式只指定容器路径即可, 宿主机路径随机生成; bind 需要指定容器和数据机的映射路径</span><br><span class="line">                                source: ./static</span><br><span class="line">                                target: /opt/app/static</span><br><span class="line">                                read_only: true             # 设置文件系统为只读文件系统</span><br><span class="line">                volumes:</span><br><span class="line">                    mydata:                                 # 定义在 volume, 可在所有服务中调用</span><br><span class="line"> </span><br><span class="line">        restart               # 定义容器重启策略(在使用 swarm 部署时将忽略该选项, 在 swarm 使用 restart_policy 代替 restart)</span><br><span class="line">            no                    # 禁止自动重启容器(默认)</span><br><span class="line">            always                # 无论如何容器都会重启</span><br><span class="line">            on-failure            # 当出现 on-failure 报错时, 容器重新启动</span><br><span class="line"> </span><br><span class="line">        其他选项：</span><br><span class="line">            domainname, hostname, ipc, mac_address, privileged, read_only, shm_size, stdin_open, tty, user, working_dir</span><br><span class="line">            上面这些选项都只接受单个值和 docker run 的对应参数类似</span><br><span class="line"> </span><br><span class="line">        对于值为时间的可接受的值：</span><br><span class="line">            2.5s</span><br><span class="line">            10s</span><br><span class="line">            1m30s</span><br><span class="line">            2h32m</span><br><span class="line">            5h34m56s</span><br><span class="line">            时间单位: us, ms, s, m， h</span><br><span class="line">        对于值为大小的可接受的值：</span><br><span class="line">            2b</span><br><span class="line">            1024kb</span><br><span class="line">            2048k</span><br><span class="line">            300m</span><br><span class="line">            1gb</span><br><span class="line">            单位: b, k, m, g 或者 kb, mb, gb</span><br><span class="line">    networks          # 定义 networks 信息</span><br><span class="line">        driver                # 指定网络模式, 大多数情况下, 它 bridge 于单个主机和 overlay Swarm 上</span><br><span class="line">            bridge                # Docker 默认使用 bridge 连接单个主机上的网络</span><br><span class="line">            overlay               # overlay 驱动程序创建一个跨多个节点命名的网络</span><br><span class="line">            host                  # 共享主机网络名称空间(等同于 docker run --net=host)</span><br><span class="line">            none                  # 等同于 docker run --net=none</span><br><span class="line">        driver_opts           # v3.2以上版本, 传递给驱动程序的参数, 这些参数取决于驱动程序</span><br><span class="line">        attachable            # driver 为 overlay 时使用, 如果设置为 true 则除了服务之外，独立容器也可以附加到该网络; 如果独立容器连接到该网络，则它可以与其他 Docker 守护进程连接到的该网络的服务和独立容器进行通信</span><br><span class="line">        ipam                  # 自定义 IPAM 配置. 这是一个具有多个属性的对象, 每个属性都是可选的</span><br><span class="line">            driver                # IPAM 驱动程序, bridge 或者 default</span><br><span class="line">            config                # 配置项</span><br><span class="line">                subnet                # CIDR格式的子网，表示该网络的网段</span><br><span class="line">        external              # 外部网络, 如果设置为 true 则 docker-compose up 不会尝试创建它, 如果它不存在则引发错误</span><br><span class="line">        name                  # v3.5 以上版本, 为此网络设置名称</span><br><span class="line">文件格式示例：</span><br><span class="line">    version: &quot;3&quot;</span><br><span class="line">    services:</span><br><span class="line">      redis:</span><br><span class="line">        image: redis:alpine</span><br><span class="line">        ports:</span><br><span class="line">          - &quot;6379&quot;</span><br><span class="line">        networks:</span><br><span class="line">          - frontend</span><br><span class="line">        deploy:</span><br><span class="line">          replicas: 2</span><br><span class="line">          update_config:</span><br><span class="line">            parallelism: 2</span><br><span class="line">            delay: 10s</span><br><span class="line">          restart_policy:</span><br><span class="line">            condition: on-failure</span><br><span class="line">      db:</span><br><span class="line">        image: postgres:9.4</span><br><span class="line">        volumes:</span><br><span class="line">          - db-data:/var/lib/postgresql/data</span><br><span class="line">        networks:</span><br><span class="line">          - backend</span><br><span class="line">        deploy:</span><br><span class="line">          placement:</span><br><span class="line">            constraints: [node.role == manager]</span><br></pre></td></tr></table></figure>



<h3 id="7-5-开源项目"><a href="#7-5-开源项目" class="headerlink" title="7.5 开源项目"></a>7.5 开源项目</h3><h4 id="博客"><a href="#博客" class="headerlink" title="博客"></a>博客</h4><blockquote>
<p> <a target="_blank" rel="noopener" href="https://docs.docker.com/compose/wordpress/">https://docs.docker.com/compose/wordpress/</a> </p>
</blockquote>
<p>compose应用。&#x3D;&gt;一键启动！</p>
<p>1、下载项目（docker-.compose.yaml)</p>
<p>2、如果需要文件。Dcokerfile</p>
<p>3、文件准备齐全（直接一键启动项目！）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1、创建项目路径</span></span><br><span class="line">mkdir my_wordpress/</span><br><span class="line">cd my_wordpress/</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2、编写docker-compose.yml文件</span></span><br><span class="line">version: &#x27;3.3&#x27;</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">   db:</span><br><span class="line">     image: mysql:5.7</span><br><span class="line">     volumes:</span><br><span class="line">       - db_data:/var/lib/mysql</span><br><span class="line">     restart: always</span><br><span class="line">     environment:</span><br><span class="line">       MYSQL_ROOT_PASSWORD: somewordpress</span><br><span class="line">       MYSQL_DATABASE: wordpress</span><br><span class="line">       MYSQL_USER: wordpress</span><br><span class="line">       MYSQL_PASSWORD: wordpress</span><br><span class="line"></span><br><span class="line">   wordpress:</span><br><span class="line">     depends_on:</span><br><span class="line">       - db</span><br><span class="line">     image: wordpress:latest</span><br><span class="line">     ports:</span><br><span class="line">       - &quot;8000:80&quot;</span><br><span class="line">     restart: always</span><br><span class="line">     environment:</span><br><span class="line">       WORDPRESS_DB_HOST: db:3306</span><br><span class="line">       WORDPRESS_DB_USER: wordpress</span><br><span class="line">       WORDPRESS_DB_PASSWORD: wordpress</span><br><span class="line">       WORDPRESS_DB_NAME: wordpress</span><br><span class="line">volumes:</span><br><span class="line">    db_data: &#123;&#125;</span><br></pre></td></tr></table></figure>



<p>掌握：docker基础，原理、网络、服务、集群、错误排查、日志。</p>
<p>后台启动：</p>
<p>docker-compose up -d</p>
<h2 id="8、Docker-Swarm"><a href="#8、Docker-Swarm" class="headerlink" title="8、Docker Swarm"></a>8、Docker Swarm</h2><blockquote>
<p> <a target="_blank" rel="noopener" href="https://docs.docker.com/develop/">https://docs.docker.com/develop/</a> </p>
</blockquote>
<h3 id="8-1-工作模式"><a href="#8-1-工作模式" class="headerlink" title="8.1 工作模式"></a>8.1 工作模式</h3><p><img src="/Docker.assets/1597137052715.png" alt="1597137052715"></p>
<p>分为管理节点和工作节点</p>
<p>raft 一致性算法</p>
<p>操作都是在 manager</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@hchost ~]# docker swarm init</span><br><span class="line">Swarm initialized: current node (w4ityhkbi3b6v7un65ir2v1zg) is now a manager.</span><br><span class="line"></span><br><span class="line">To add a worker to this swarm, run the following command:</span><br><span class="line"></span><br><span class="line">    docker swarm join --token SWMTKN-1-3cjava2g47qg1qrfpbam689q3p55gic6jon1uw9d3ltbjdrcou-eu2i4snpt0ykr0s7hf86dbebz 172.19.68.100:2377</span><br><span class="line"></span><br><span class="line">To add a manager to this swarm, run &#x27;docker swarm join-token manager&#x27; and follow the instructions.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">移除当前节点</span></span><br><span class="line">[root@hchost ~]# docker swarm leave -f</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置当前容器为主manager</span></span><br><span class="line">[root@hchost ~]# docker swarm init --advertise-addr 172.19.68.100</span><br><span class="line">Swarm initialized: current node (ieyuox2c9rw39zub89yfu1pb7) is now a manager.</span><br><span class="line"></span><br><span class="line">To add a worker to this swarm, run the following command:</span><br><span class="line"></span><br><span class="line">    docker swarm join --token SWMTKN-1-4sh98ospadbtb6n30zyhv5mlpzkovxboz29ks95omwlbg1l57r-cagajdxv7l7heuenez2eugbus 172.19.68.100:2377</span><br><span class="line"></span><br><span class="line">To add a manager to this swarm, run &#x27;docker swarm join-token manager&#x27; and follow the instructions.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>例如，在hchost01上运行如下命令，是把hchost01作为worker加入到hchost下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker swarm join --token SWMTKN-1-4sh98ospadbtb6n30zyhv5mlpzkovxboz29ks95omwlbg1l57r-cagajdxv7l7heuenez2eugbus 172.19.68.100:2377</span><br></pre></td></tr></table></figure>

<p>查看当前节点的信息	</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@hchost ~]# docker node ls</span><br><span class="line">ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION</span><br><span class="line">ieyuox2c9rw39zub89yfu1pb7 *   hchost              Ready               Active              Leader              19.03.12</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取令牌</span></span><br><span class="line">docker swarm join-token manager</span><br><span class="line">docker swarm join-token worker</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">主节点上运行这个命令后生成令牌，其他节点运行令牌可加入主节点，成为manager或者worker</span></span><br></pre></td></tr></table></figure>

<p><img src="/Docker.assets/1597203103851.png" alt="1597203103851"></p>
<p>Reachable  是加入主节点的manager</p>
<h3 id="8-2-Raft协议"><a href="#8-2-Raft协议" class="headerlink" title="8.2 Raft协议"></a>8.2 Raft协议</h3><p>双主双从：假设一个节点挂了！其他节点是否可以用！</p>
<p>Raft协议：保证大多数节点存活才可以用。只要&gt;1，熊群至少大于3台！</p>
<p>实验：</p>
<p>将docker1机器停止。宕机！双主，另外一个主节点也不能使用了！</p>
<p>灰度发布：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@hchost ~]# docker service create -p 8888:80 --name my-nginx nginx</span><br><span class="line">5k0edejorgrfip917xb61u6fd</span><br><span class="line">overall progress: 1 out of 1 tasks </span><br><span class="line">1/1: running   [==================================================&gt;] </span><br><span class="line">verify: Service converged </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker run 容器启动，不具备扩缩容</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker service 服务！ 具备扩缩容，滚动更新！</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看服务，副本REPLICAS只有一个</span></span><br><span class="line">[root@hchost ~]# docker service ps my-nginx</span><br><span class="line">ID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE           ERROR               PORTS</span><br><span class="line">op6lv9ft2l9c        my-nginx.1          nginx:latest        hchost              Running             Running 4 minutes ago                       </span><br><span class="line">[root@hchost ~]# docker service ls</span><br><span class="line">ID                  NAME                MODE                REPLICAS            IMAGE               PORTS</span><br><span class="line">5k0edejorgrf        my-nginx            replicated          1/1                 nginx:latest        *:8888-&gt;80/tcp</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">动态扩缩容</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">命令一</span></span><br><span class="line">docker service update --replicas 3 my-nginx</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">命令二</span></span><br><span class="line">docker service scale my-nginx=5</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">移除服务</span></span><br><span class="line">[root@hchost ~]# docker service rm my-nginx</span><br><span class="line">my-nginx</span><br></pre></td></tr></table></figure>

<h3 id="8-3-概念总结"><a href="#8-3-概念总结" class="headerlink" title="8.3 概念总结"></a>8.3 概念总结</h3><p><strong>swarm</strong></p>
<p>集群的管理和编排。</p>
<p><strong>docker</strong></p>
<p>可以初始化一个swarm集群，其他节点可以加入。（管理、工作者）</p>
<p><strong>Node</strong></p>
<p>就是一个docker节点。多个节点就组成了一个网络集群。（管理、工作者）</p>
<p><strong>Service</strong></p>
<p>任务，可以在管理节点或者工作节点来运行。核心。！用户访问！</p>
<p><strong>Task</strong></p>
<p>容器内的命令，细节任务！</p>
<p><img src="/Docker.assets/1597217106549.png" alt="1597217106549"></p>
<h2 id="9、Docker-Stack"><a href="#9、Docker-Stack" class="headerlink" title="9、Docker Stack"></a>9、Docker Stack</h2><p>docker-compose单机部署项目！</p>
<p>Docker Stack部署，集群部署！</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">单机</span> </span><br><span class="line">docker-compose up-d wordpress.yaml </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">集群</span> </span><br><span class="line">docker stack deploy wordpgess.yam1</span><br></pre></td></tr></table></figure>











<h2 id="10、Docker-问题汇总"><a href="#10、Docker-问题汇总" class="headerlink" title="10、Docker 问题汇总"></a>10、Docker 问题汇总</h2><h3 id="10-1-image-has-dependent-child-images"><a href="#10-1-image-has-dependent-child-images" class="headerlink" title="10.1 image has dependent child images"></a>10.1 image has dependent child images</h3><blockquote>
<h4 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h4></blockquote>
<p>发现其实是因为TAG的问题，即有其他 image FROM 了这个 image，可以使用下面的命令列出所有在指定 image 之后创建的 image 的父 image</p>
<blockquote>
<h4 id="方案"><a href="#方案" class="headerlink" title="方案"></a>方案</h4></blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">先查询依赖</span></span><br><span class="line">docker image inspect --format=&#x27;&#123;&#123;.RepoTags&#125;&#125; &#123;&#123;.Id&#125;&#125; &#123;&#123;.Parent&#125;&#125;&#x27; $(docker image ls -q --filter since=XXX)    # XXX指镜像ID</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">然后根据根据TAG删除容器</span></span><br><span class="line">docker rmi REPOSITORY:TAG</span><br></pre></td></tr></table></figure>



<blockquote>
<p> <code>docker system prune</code> 命令将删除所有停止的容器，所有悬挂的镜像和所有未使用的网络 </p>
</blockquote>
<p>如果您还想删除所有未使用的卷，请传递<code>--volumes</code>标志：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker system prune --volumes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除孤立的容器</span></span><br><span class="line">docker containers prune</span><br></pre></td></tr></table></figure>

<h3 id="10-2-已启动容器修改添加端口映射"><a href="#10-2-已启动容器修改添加端口映射" class="headerlink" title="10.2 已启动容器修改添加端口映射"></a>10.2 已启动容器修改添加端口映射</h3><h4 id="1、关闭docker服务"><a href="#1、关闭docker服务" class="headerlink" title="1、关闭docker服务"></a>1、关闭docker服务</h4><p>一定要停止docker服务，不然修改不成功</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop docker</span><br></pre></td></tr></table></figure>

<h4 id="2、修改hostconfig-json"><a href="#2、修改hostconfig-json" class="headerlink" title="2、修改hostconfig.json"></a>2、修改hostconfig.json</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /<span class="keyword">var</span>/lib/docker/containers/<span class="variable constant_">CONTAINER</span> <span class="variable constant_">ID</span>/hostconfig.<span class="property">json</span></span><br><span class="line"># 修改<span class="variable constant_">CONTAINER</span> <span class="variable constant_">ID</span> 为容器id</span><br></pre></td></tr></table></figure>

<p><img src="/Docker.assets/1609382692056.png" alt="1609382692056"></p>
<h4 id="3、修改config-v2-json"><a href="#3、修改config-v2-json" class="headerlink" title="3、修改config.v2.json"></a>3、修改config.v2.json</h4><p><img src="/Docker.assets/1609382835607.png" alt="1609382835607"></p>
<h4 id="4、重启-docker服务"><a href="#4、重启-docker服务" class="headerlink" title="4、重启 docker服务"></a>4、重启 docker服务</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service docker restart</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://anxiaoliao.github.io">Terry Ming</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://anxiaoliao.github.io/2022/09/21/Docker/">https://anxiaoliao.github.io/2022/09/21/Docker/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://anxiaoliao.github.io" target="_blank">Ming's Notes</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%AD%A6%E4%B9%A0/">学习</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2022/09/21/Python%20%E7%88%AC%E8%99%AB/"><img class="next-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Python 爬虫</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/08/31/Git%E6%8F%90%E4%BA%A4%E4%B8%89%E9%83%A8%E6%9B%B2/" title="Git提交三部曲"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-31</div><div class="title">Git提交三部曲</div></div></a></div><div><a href="/2022/09/21/Python%20%E7%88%AC%E8%99%AB/" title="Python 爬虫"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-21</div><div class="title">Python 爬虫</div></div></a></div><div><a href="/2022/09/21/%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BALNMP%E7%8E%AF%E5%A2%83/" title="快速搭建LNMP环境"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-21</div><div class="title">快速搭建LNMP环境</div></div></a></div><div><a href="/2022/09/21/Nginx/" title="Nginx"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-21</div><div class="title">Nginx</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.imgtg.com/2022/08/11/AsLOl.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Terry Ming</div><div class="author-info__description">人到无求品自高</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">7</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">1</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker"><span class="toc-number">1.</span> <span class="toc-text">Docker</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81Docker%E5%AE%89%E8%A3%85"><span class="toc-number">1.1.</span> <span class="toc-text">1、Docker安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-Docker%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%84%E6%88%90"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1 Docker的基本组成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E5%AE%89%E8%A3%85Docker"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.2 安装Docker</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E5%90%AF%E5%8A%A8Docker%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.1.3.</span> <span class="toc-text">1.3  启动Docker服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F"><span class="toc-number">1.1.4.</span> <span class="toc-text">1.4 镜像加速</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86"><span class="toc-number">1.1.5.</span> <span class="toc-text">1.5 底层原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81Docker%E7%9A%84%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.</span> <span class="toc-text">2、Docker的常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%B8%AE%E5%8A%A9%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1 帮助命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E9%95%9C%E5%83%8F%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2 镜像命令</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#docker-pull-%E9%95%9C%E5%83%8F%E5%90%8D-tag"><span class="toc-number">2.</span> <span class="toc-text">docker pull 镜像名[:tag]</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AD%89%E4%BB%B7%E4%BA%8E"><span class="toc-number">3.</span> <span class="toc-text">等价于</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8C%87%E5%AE%9A%E7%89%88%E6%9C%AC%E4%B8%8B%E8%BD%BD"><span class="toc-number">4.</span> <span class="toc-text">指定版本下载</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E5%AE%B9%E5%99%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">4.0.1.</span> <span class="toc-text">2.3 容器命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E5%B8%B8%E7%94%A8%E7%9A%84%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4"><span class="toc-number">4.0.2.</span> <span class="toc-text">2.4 常用的其他命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-1-%E5%90%8E%E5%8F%B0%E5%90%AF%E5%8A%A8%E5%AE%B9%E5%99%A8"><span class="toc-number">4.0.2.1.</span> <span class="toc-text">2.4.1 后台启动容器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-2-%E6%9F%A5%E7%9C%8B%E6%97%A5%E5%BF%97"><span class="toc-number">4.0.2.2.</span> <span class="toc-text">2.4.2 查看日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-3-%E6%9F%A5%E7%9C%8B%E5%AE%B9%E5%99%A8%E4%B8%AD%E8%BF%9B%E7%A8%8B%E4%BF%A1%E6%81%AF-ps"><span class="toc-number">4.0.2.3.</span> <span class="toc-text">2.4.3 查看容器中进程信息  ps</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-4-%E6%9F%A5%E7%9C%8B%E9%95%9C%E5%83%8F%E7%9A%84%E5%85%83%E6%95%B0%E6%8D%AE"><span class="toc-number">4.0.2.4.</span> <span class="toc-text">2.4.4 查看镜像的元数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-5-%E8%BF%9B%E5%85%A5%E5%BD%93%E5%89%8D%E6%AD%A3%E5%9C%A8%E8%BF%90%E8%A1%8C%E7%9A%84%E5%AE%B9%E5%99%A8"><span class="toc-number">4.0.2.5.</span> <span class="toc-text">2.4.5 进入当前正在运行的容器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-6-%E4%BB%8E%E5%AE%B9%E5%99%A8%E5%86%85%E6%8B%B7%E8%B4%9D%E6%96%87%E4%BB%B6%E5%88%B0%E4%B8%BB%E6%9C%BA%E4%B8%8A"><span class="toc-number">4.0.2.6.</span> <span class="toc-text">2.4.6 从容器内拷贝文件到主机上</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-7-%E6%8F%90%E9%AB%98%E6%9D%83%E9%99%90"><span class="toc-number">4.0.2.7.</span> <span class="toc-text">2.4.7 提高权限</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-8-%E6%9F%A5%E8%AF%A2%E5%AE%B9%E5%99%A8IP"><span class="toc-number">4.0.2.8.</span> <span class="toc-text">2.4.8 查询容器IP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-8-%E6%9F%A5%E8%AF%A2%E6%8C%87%E5%AE%9A%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF"><span class="toc-number">4.0.2.9.</span> <span class="toc-text">2.4.8 查询指定配置信息</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-Docker%E5%91%BD%E4%BB%A4%E9%9B%86"><span class="toc-number">4.0.3.</span> <span class="toc-text">2.5 Docker命令集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-%E4%BD%9C%E4%B8%9A%E7%BB%83%E4%B9%A0"><span class="toc-number">4.0.4.</span> <span class="toc-text">2.6 作业练习</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="toc-number">4.0.5.</span> <span class="toc-text">2.7 可视化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81Docker%E9%95%9C%E5%83%8F%E8%AE%B2%E8%A7%A3"><span class="toc-number">4.1.</span> <span class="toc-text">3、Docker镜像讲解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E9%95%9C%E5%83%8F%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">4.1.1.</span> <span class="toc-text">3.1 镜像是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-Docker%E9%95%9C%E5%83%8F%E5%8A%A0%E8%BD%BD%E5%8E%9F%E7%90%86"><span class="toc-number">4.1.2.</span> <span class="toc-text">3.2 Docker镜像加载原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E5%88%86%E5%B1%82%E7%90%86%E8%A7%A3"><span class="toc-number">4.1.3.</span> <span class="toc-text">3.3 分层理解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-commit-%E9%95%9C%E5%83%8F"><span class="toc-number">4.1.4.</span> <span class="toc-text">3.4 commit 镜像</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">4.2.</span> <span class="toc-text">4、容器数据卷</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E4%BB%80%E4%B9%88%E6%98%AF%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">4.2.1.</span> <span class="toc-text">4.1 什么是容器数据卷</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">4.2.2.</span> <span class="toc-text">4.2 使用数据卷</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E5%AE%9E%E6%88%98%EF%BC%9A%E5%AE%89%E8%A3%85Mysql"><span class="toc-number">4.2.3.</span> <span class="toc-text">4.3 实战：安装Mysql</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-%E5%85%B7%E5%90%8D%E6%8C%82%E8%BD%BD%E5%92%8C%E5%8C%BF%E5%90%8D%E6%8C%82%E8%BD%BD"><span class="toc-number">4.2.4.</span> <span class="toc-text">4.4 具名挂载和匿名挂载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-%E5%88%9D%E8%AF%86DockerFile"><span class="toc-number">4.2.5.</span> <span class="toc-text">4.5 初识DockerFile</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-%E6%95%B0%E6%8D%AE%E5%8D%B7%E5%AE%B9%E5%99%A8"><span class="toc-number">4.2.6.</span> <span class="toc-text">4.6 数据卷容器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81DockerFile"><span class="toc-number">4.3.</span> <span class="toc-text">5、DockerFile</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-DockerFile%E4%BB%8B%E7%BB%8D"><span class="toc-number">4.3.1.</span> <span class="toc-text">5.1 DockerFile介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-DockerFile%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B"><span class="toc-number">4.3.2.</span> <span class="toc-text">5.2 DockerFile构建过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-Dockerfile%E7%9A%84%E5%91%BD%E4%BB%A4"><span class="toc-number">4.3.3.</span> <span class="toc-text">5.3 Dockerfile的命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-%E5%AE%9E%E6%88%98%E6%B5%8B%E8%AF%95"><span class="toc-number">4.3.4.</span> <span class="toc-text">5.4 实战测试</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-1-%E5%AE%9E%E6%88%98%EF%BC%9ATomcat%E9%95%9C%E5%83%8F"><span class="toc-number">4.3.4.1.</span> <span class="toc-text">5.4.1 实战：Tomcat镜像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-2-%E5%AE%9E%E6%88%98%EF%BC%9ANginx%E9%95%9C%E5%83%8F"><span class="toc-number">4.3.4.2.</span> <span class="toc-text">5.4.2 实战：Nginx镜像</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-%E5%8F%91%E5%B8%83%E8%87%AA%E5%B7%B1%E7%9A%84%E9%95%9C%E5%83%8F"><span class="toc-number">4.3.5.</span> <span class="toc-text">5.5 发布自己的镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DockerHub"><span class="toc-number">4.3.6.</span> <span class="toc-text">DockerHub</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%BF%E9%87%8C%E4%BA%91%E9%95%9C%E5%83%8F%E6%9C%8D%E5%8A%A1%E4%B8%8A"><span class="toc-number">4.3.7.</span> <span class="toc-text">阿里云镜像服务上</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-6-docker-%E4%BB%93%E5%BA%93%EF%BC%88registry%EF%BC%89"><span class="toc-number">4.3.8.</span> <span class="toc-text">5.6 docker 仓库（registry）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-6-1-%E5%88%9B%E5%BB%BA%E4%BB%93%E5%BA%93"><span class="toc-number">4.3.8.1.</span> <span class="toc-text">5.6.1 创建仓库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-6-2-%E5%B8%A6basic%E8%AE%A4%E8%AF%81%E7%9A%84%E4%BB%93%E5%BA%93"><span class="toc-number">4.3.8.2.</span> <span class="toc-text">5.6.2 带basic认证的仓库</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-7-%E4%BC%81%E4%B8%9A%E7%BA%A7%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93harbor"><span class="toc-number">4.3.9.</span> <span class="toc-text">5.7 企业级镜像仓库harbor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-8-%E5%B0%8F%E7%BB%93%EF%BC%9A"><span class="toc-number">4.3.10.</span> <span class="toc-text">5.8 小结：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81Docker-%E7%BD%91%E7%BB%9C"><span class="toc-number">4.4.</span> <span class="toc-text">6、Docker 网络</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E7%90%86%E8%A7%A3Docker0"><span class="toc-number">4.4.1.</span> <span class="toc-text">6.1 理解Docker0</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E7%BB%9C"><span class="toc-number">4.4.2.</span> <span class="toc-text">6.2 自定义网络</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-%E7%BD%91%E7%BB%9C%E8%BF%9E%E9%80%9A"><span class="toc-number">4.4.3.</span> <span class="toc-text">6.3 网络连通</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-%E5%AE%9E%E6%88%98%EF%BC%9A%E9%83%A8%E7%BD%B2Redis%E9%9B%86%E7%BE%A4"><span class="toc-number">4.4.4.</span> <span class="toc-text">6.4 实战：部署Redis集群</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%E3%80%81Docker-Compose"><span class="toc-number">4.5.</span> <span class="toc-text">7、Docker Compose</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-%E7%AE%80%E4%BB%8B"><span class="toc-number">4.5.1.</span> <span class="toc-text">7.1 简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-%E5%AE%89%E8%A3%85"><span class="toc-number">4.5.2.</span> <span class="toc-text">7.2 安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-%E4%BD%93%E9%AA%8C"><span class="toc-number">4.5.3.</span> <span class="toc-text">7.3 体验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-yaml%E8%A7%84%E5%88%99"><span class="toc-number">4.5.4.</span> <span class="toc-text">7.4 yaml规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE"><span class="toc-number">4.5.5.</span> <span class="toc-text">7.5 开源项目</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%9A%E5%AE%A2"><span class="toc-number">4.5.5.1.</span> <span class="toc-text">博客</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8%E3%80%81Docker-Swarm"><span class="toc-number">4.6.</span> <span class="toc-text">8、Docker Swarm</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.6.1.</span> <span class="toc-text">8.1 工作模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-Raft%E5%8D%8F%E8%AE%AE"><span class="toc-number">4.6.2.</span> <span class="toc-text">8.2 Raft协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-%E6%A6%82%E5%BF%B5%E6%80%BB%E7%BB%93"><span class="toc-number">4.6.3.</span> <span class="toc-text">8.3 概念总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9%E3%80%81Docker-Stack"><span class="toc-number">4.7.</span> <span class="toc-text">9、Docker Stack</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10%E3%80%81Docker-%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB"><span class="toc-number">4.8.</span> <span class="toc-text">10、Docker 问题汇总</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-image-has-dependent-child-images"><span class="toc-number">4.8.1.</span> <span class="toc-text">10.1 image has dependent child images</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E5%9B%A0"><span class="toc-number">4.8.1.1.</span> <span class="toc-text">原因</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%A1%88"><span class="toc-number">4.8.1.2.</span> <span class="toc-text">方案</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-%E5%B7%B2%E5%90%AF%E5%8A%A8%E5%AE%B9%E5%99%A8%E4%BF%AE%E6%94%B9%E6%B7%BB%E5%8A%A0%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84"><span class="toc-number">4.8.2.</span> <span class="toc-text">10.2 已启动容器修改添加端口映射</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E5%85%B3%E9%97%ADdocker%E6%9C%8D%E5%8A%A1"><span class="toc-number">4.8.2.1.</span> <span class="toc-text">1、关闭docker服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E4%BF%AE%E6%94%B9hostconfig-json"><span class="toc-number">4.8.2.2.</span> <span class="toc-text">2、修改hostconfig.json</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E4%BF%AE%E6%94%B9config-v2-json"><span class="toc-number">4.8.2.3.</span> <span class="toc-text">3、修改config.v2.json</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81%E9%87%8D%E5%90%AF-docker%E6%9C%8D%E5%8A%A1"><span class="toc-number">4.8.2.4.</span> <span class="toc-text">4、重启 docker服务</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/09/21/Docker/" title="Docker"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Docker"/></a><div class="content"><a class="title" href="/2022/09/21/Docker/" title="Docker">Docker</a><time datetime="2022-09-21T15:35:40.000Z" title="发表于 2022-09-21 23:35:40">2022-09-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/09/21/Python%20%E7%88%AC%E8%99%AB/" title="Python 爬虫"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Python 爬虫"/></a><div class="content"><a class="title" href="/2022/09/21/Python%20%E7%88%AC%E8%99%AB/" title="Python 爬虫">Python 爬虫</a><time datetime="2022-09-21T09:35:40.000Z" title="发表于 2022-09-21 17:35:40">2022-09-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/09/21/%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BALNMP%E7%8E%AF%E5%A2%83/" title="快速搭建LNMP环境"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="快速搭建LNMP环境"/></a><div class="content"><a class="title" href="/2022/09/21/%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BALNMP%E7%8E%AF%E5%A2%83/" title="快速搭建LNMP环境">快速搭建LNMP环境</a><time datetime="2022-09-21T09:35:40.000Z" title="发表于 2022-09-21 17:35:40">2022-09-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/09/21/Nginx/" title="Nginx"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Nginx"/></a><div class="content"><a class="title" href="/2022/09/21/Nginx/" title="Nginx">Nginx</a><time datetime="2022-09-21T09:35:40.000Z" title="发表于 2022-09-21 17:35:40">2022-09-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/08/31/Git%E6%8F%90%E4%BA%A4%E4%B8%89%E9%83%A8%E6%9B%B2/" title="Git提交三部曲"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Git提交三部曲"/></a><div class="content"><a class="title" href="/2022/08/31/Git%E6%8F%90%E4%BA%A4%E4%B8%89%E9%83%A8%E6%9B%B2/" title="Git提交三部曲">Git提交三部曲</a><time datetime="2022-08-31T02:53:46.000Z" title="发表于 2022-08-31 10:53:46">2022-08-31</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Terry Ming</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"></div><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>